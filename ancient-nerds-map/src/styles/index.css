/* ANCIENT NERDS - Research Platform - Minimalist Futuristic Theme */

:root {
  --primary-red: #c02023;
  --primary-red-hover: #d42426;
  --bg-dark: #000000;
  --bg-card: rgba(0, 20, 25, 0.35);
  --bg-card-solid: rgba(0, 15, 20, 0.7);
  --bg-inner: rgba(0, 30, 35, 0.35);
  --border-color: rgba(0, 180, 180, 0.2);
  --text-primary: #ffffff;
  --text-secondary: #888888;
  --blur-amount: 16px;
}

/* Satellite mode - more opaque backgrounds for better contrast against bright imagery */
body.satellite-mode {
  --bg-card: rgba(0, 15, 20, 0.75);
  --bg-card-solid: rgba(0, 10, 15, 0.88);
  --bg-inner: rgba(0, 20, 25, 0.7);
  --border-color: rgba(0, 180, 180, 0.35);
  --blur-amount: 20px;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html, body {
  font-family: 'Inter', system-ui, -apple-system, sans-serif;
  background: var(--bg-dark);
  color: var(--text-primary);
  overflow: hidden;
  width: 100%;
  height: 100%;
}

/* Global Scrollbar Styling */
::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}

::-webkit-scrollbar-track {
  background: rgba(0, 0, 0, 0.2);
  border-radius: 3px;
}

::-webkit-scrollbar-thumb {
  background: rgba(192, 32, 35, 0.5);
  border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(192, 32, 35, 0.7);
}

/* Firefox scrollbar */
* {
  scrollbar-width: thin;
  scrollbar-color: rgba(192, 32, 35, 0.5) rgba(0, 0, 0, 0.2);
}

#root {
  width: 100%;
  height: 100%;
  overflow: hidden;
}

/* Globe Container - Three.js canvas (below Mapbox for crossfade) */
.globe-container {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  z-index: 1;
  transition: transform 0.25s ease-out;
}

/* Ensure Three.js canvas is transparent to show Mapbox behind */
.globe-container canvas {
  background: transparent !important;
}

/* Mapbox Globe Container - on top of Three.js for crossfade blend */
.mapbox-globe-container {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  z-index: 10;
  pointer-events: none;
  visibility: visible;
  /* Keep at tiny opacity so Mapbox stays warm/rendered, avoids black flash */
  opacity: 0.001;
  transition: opacity 300ms ease-in-out, transform 0.25s ease-out;
}

/* =========================================================================
   MAPBOX PRIMARY MODE - When "Map (experimental)" checkbox is enabled
   Mapbox becomes the interactive globe, Three.js only provides dot overlay
   ========================================================================= */

/* In Mapbox primary mode: Mapbox receives all pointer events and is visible */
body.mapbox-primary-mode .mapbox-globe-container {
  pointer-events: auto;
  cursor: grab;
  visibility: visible !important;
  opacity: 1;
}

body.mapbox-primary-mode .mapbox-globe-container:active {
  cursor: grabbing;
}

/* In Mapbox primary mode: Three.js stays visible underneath for blend */
body.mapbox-primary-mode .globe-container {
  pointer-events: none;
  /* Keep visible - Mapbox fades over it for smooth crossfade */
}

/* Ensure Mapbox canvas is visible */
body.mapbox-primary-mode .mapbox-globe-container canvas {
  visibility: visible;
  opacity: 1;
}

/* Mapbox Offline Warning Banner */
.mapbox-offline-warning {
  position: absolute;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 1000;
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 16px;
  background: rgba(245, 158, 11, 0.95);
  border: 1px solid rgba(217, 119, 6, 0.8);
  border-radius: 8px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
  color: #000;
  font-size: 13px;
  font-weight: 500;
}

.mapbox-offline-warning svg {
  flex-shrink: 0;
  color: #92400e;
}

.mapbox-offline-warning span {
  white-space: nowrap;
}

.mapbox-warning-btn {
  padding: 6px 12px;
  background: rgba(0, 0, 0, 0.2);
  border: 1px solid rgba(0, 0, 0, 0.3);
  border-radius: 4px;
  color: #000;
  font-size: 11px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  white-space: nowrap;
}

.mapbox-warning-btn:hover {
  background: rgba(0, 0, 0, 0.3);
}

.mapbox-warning-close {
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: none;
  color: #92400e;
  font-size: 18px;
  font-weight: bold;
  cursor: pointer;
  opacity: 0.7;
  transition: opacity 0.2s ease;
  flex-shrink: 0;
}

.mapbox-warning-close:hover {
  opacity: 1;
}

/* Mapbox Site Markers - styled to match Three.js dots */
.mapbox-site-marker {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  cursor: pointer;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
  /* Glow effect matching Three.js dots */
  box-shadow: 0 0 6px currentColor;
}

.mapbox-site-marker:hover {
  transform: scale(1.5);
  box-shadow: 0 0 12px currentColor, 0 0 20px currentColor;
  z-index: 100;
}

/* Hide cursor when setting proximity on globe */
.globe-container[data-proximity-mode="true"] {
  cursor: none;
}

/* Crosshair cursor for measurement mode */
.globe-container[data-measure-mode="true"] {
  cursor: crosshair;
}

/* Mapbox Overrides */
.mapboxgl-ctrl-group {
  background: var(--bg-card) !important;
  border: 1px solid var(--border-color) !important;
  border-radius: 4px !important;
}

.mapboxgl-ctrl-group button {
  background: transparent !important;
}

.mapboxgl-ctrl-group button:hover {
  background: rgba(192, 32, 35, 0.1) !important;
}

.mapboxgl-ctrl-group button .mapboxgl-ctrl-icon {
  filter: invert(1) brightness(0.8);
}

.mapboxgl-ctrl-attrib {
  background: rgba(0, 15, 20, 0.85) !important;
  color: #555 !important;
  font-size: 10px !important;
}

.mapboxgl-ctrl-attrib a {
  color: var(--primary-red) !important;
}

/* Popup Styling */
.mapboxgl-popup-content {
  background: var(--bg-card) !important;
  backdrop-filter: blur(var(--blur-amount)) !important;
  -webkit-backdrop-filter: blur(var(--blur-amount)) !important;
  border: 1px solid var(--border-color) !important;
  border-radius: 4px !important;
  padding: 0 !important;
  color: var(--text-primary) !important;
  min-width: 280px;
  max-width: 320px;
  overflow: hidden;
}

.mapboxgl-popup-tip {
  display: none !important;
}

.mapboxgl-popup-close-button {
  color: var(--primary-red) !important;
  font-size: 24px !important;
  padding: 8px 12px !important;
  right: 0 !important;
  top: 0 !important;
  z-index: 10;
}

.mapboxgl-popup-close-button:hover {
  background: rgba(192, 32, 35, 0.1) !important;
}

/* Filter Panel */
.filter-panel {
  position: absolute;
  top: 20px;
  left: 20px;
  z-index: 100;
  display: flex;
  flex-direction: column;
  gap: 12px;
  /* Match glass-panel width (280px) + scrollbar (6px) */
  width: 286px;
  max-width: 286px;
  /* Fixed height so percentage-based children work properly */
  height: calc((100vh - 40px) / var(--hud-scale, 1));
  overflow: hidden;
  /* Allow clicks through empty space (gaps between panels) */
  pointer-events: none;
}

/* Re-enable pointer events on actual panel content */
.filter-panel > * {
  pointer-events: auto;
}

/* Filter panel no longer scrolls - children handle their own scrolling */

.panel-header {
  padding: 0;
  flex-shrink: 0;
}

/* Offline Mode Button in Settings */
.offline-mode-btn {
  display: flex;
  align-items: center;
  gap: 8px;
  width: 100%;
  margin-top: 8px;
  padding: 8px 12px;
  background: rgba(0, 180, 180, 0.08);
  border: 1px solid rgba(0, 180, 180, 0.25);
  border-radius: 6px;
  color: var(--text-secondary);
  font-size: 11px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.offline-mode-btn:hover {
  background: rgba(0, 180, 180, 0.15);
  border-color: rgba(0, 180, 180, 0.4);
  color: var(--text-primary);
}

/* LED Indicator */
.offline-led {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  transition: all 0.3s ease;
}

/* Green pulsing LED when online */
.offline-led.online {
  background: #4ade80;
  box-shadow: 0 0 8px rgba(74, 222, 128, 0.7);
  animation: led-pulse 2s ease-in-out infinite;
}

/* Red LED when offline */
.offline-led.offline {
  background: #ef4444;
  box-shadow: 0 0 6px rgba(239, 68, 68, 0.6);
}

@keyframes led-pulse {
  0%, 100% {
    box-shadow: 0 0 4px rgba(74, 222, 128, 0.5);
  }
  50% {
    box-shadow: 0 0 12px rgba(74, 222, 128, 0.9);
  }
}

/* Loading state for offline mode button */
.offline-mode-btn.loading-state {
  cursor: default;
  pointer-events: none;
}

/* Loading LED - faster pulse to indicate activity */
.offline-led.loading {
  background: #4ade80;
  box-shadow: 0 0 8px rgba(74, 222, 128, 0.7);
  animation: led-loading-pulse 0.8s ease-in-out infinite;
}

@keyframes led-loading-pulse {
  0%, 100% {
    opacity: 0.4;
    box-shadow: 0 0 4px rgba(74, 222, 128, 0.4);
  }
  50% {
    opacity: 1;
    box-shadow: 0 0 14px rgba(74, 222, 128, 1);
  }
}

/* Database Status Indicator - same style as Online Mode */
.database-status-indicator {
  display: flex;
  align-items: center;
  gap: 8px;
  width: 100%;
  margin-top: 4px;
  padding: 8px 12px;
  background: rgba(74, 222, 128, 0.08);
  border: 1px solid rgba(74, 222, 128, 0.25);
  border-radius: 6px;
  color: var(--text-secondary);
  font-family: 'Inter', system-ui, -apple-system, sans-serif;
  font-size: 11px;
  font-weight: normal;
  letter-spacing: normal;
  cursor: default;
}

.database-led {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  flex-shrink: 0;
  transition: all 0.3s ease;
}

/* Green pulsing LED when connected */
.database-led.connected {
  background: #4ade80;
  box-shadow: 0 0 8px rgba(74, 222, 128, 0.7);
  animation: db-led-pulse 2s ease-in-out infinite;
}

/* Orange LED when using static files */
.database-led.disconnected {
  background: #f59e0b;
  box-shadow: 0 0 6px rgba(245, 158, 11, 0.6);
}

/* Red LED when API is not reachable */
.database-led.error {
  background: #ef4444;
  box-shadow: 0 0 6px rgba(239, 68, 68, 0.6);
}

@keyframes db-led-pulse {
  0%, 100% {
    box-shadow: 0 0 4px rgba(74, 222, 128, 0.5);
  }
  50% {
    box-shadow: 0 0 12px rgba(74, 222, 128, 0.9);
  }
}

/* Connectors Status Indicator */
.connectors-status-indicator {
  display: flex;
  align-items: center;
  gap: 8px;
  width: 100%;
  margin-top: 4px;
  padding: 8px 12px;
  background: rgba(74, 222, 128, 0.08);
  border: 1px solid rgba(74, 222, 128, 0.25);
  border-radius: 6px;
  color: var(--text-secondary);
  font-family: 'Inter', system-ui, -apple-system, sans-serif;
  font-size: 11px;
  font-weight: normal;
  letter-spacing: normal;
  cursor: pointer;
  transition: all 0.2s ease;
}

.connectors-status-indicator:hover {
  background: rgba(74, 222, 128, 0.15);
  border-color: rgba(74, 222, 128, 0.4);
  color: var(--text-primary);
}

.connectors-led {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  flex-shrink: 0;
}

.connectors-led.connected {
  background: #4ade80;
  box-shadow: 0 0 8px rgba(74, 222, 128, 0.7);
  animation: led-pulse 2s ease-in-out infinite;
}

.connectors-led.warning {
  background: #fbbf24;
  box-shadow: 0 0 6px rgba(251, 191, 36, 0.6);
}

.connectors-led.error {
  background: #ef4444;
  box-shadow: 0 0 6px rgba(239, 68, 68, 0.6);
}

.connectors-led.unknown {
  background: #6b7280;
  box-shadow: 0 0 4px rgba(107, 114, 128, 0.5);
}

.connectors-count {
  margin-left: auto;
  opacity: 0.7;
}

@keyframes led-pulse {
  0%, 100% {
    box-shadow: 0 0 4px rgba(74, 222, 128, 0.5);
  }
  50% {
    box-shadow: 0 0 12px rgba(74, 222, 128, 0.9);
  }
}

/* Connector Status Modal */
.connector-status-modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.75);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  backdrop-filter: blur(4px);
}

.connector-status-modal {
  position: relative;
  background: var(--bg-card-solid);
  backdrop-filter: blur(var(--blur-amount));
  -webkit-backdrop-filter: blur(var(--blur-amount));
  border: 1px solid var(--border-color);
  border-radius: 8px;
  max-width: 900px;
  width: 90vw;
  height: 80vh;
  display: flex;
  flex-direction: column;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
}

/* Close button on the right side for connector modal */
.connector-status-modal .connector-close-right {
  position: absolute;
  top: 12px;
  right: 12px;
  left: auto;
}

/* Connector name as clickable link */
.connector-link {
  color: var(--text-primary);
  text-decoration: none;
  transition: color 0.15s ease;
}

.connector-link:hover {
  color: var(--primary-red);
  text-decoration: underline;
}

.connector-status-content {
  padding: 24px;
  display: flex;
  flex-direction: column;
  gap: 16px;
  overflow: hidden;
}

.connector-status-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
  flex-wrap: wrap;
}

.connector-status-header h2 {
  margin: 0;
  font-size: 18px;
  font-weight: 600;
  color: var(--text-primary);
  display: flex;
  align-items: center;
  gap: 10px;
}

.connector-status-header .connectors-led {
  width: 12px;
  height: 12px;
}

.connector-status-summary {
  display: flex;
  gap: 12px;
  font-size: 12px;
}

.connector-status-modal-description {
  margin: 4px 0 0 0;
  font-size: 12px;
  line-height: 1.5;
  color: rgba(255, 255, 255, 0.45);
}

.connector-status-summary .summary-item {
  padding: 4px 10px;
  border-radius: 12px;
  font-weight: 500;
  border: 1px solid transparent;
  cursor: pointer;
  transition: border-color 0.2s ease, opacity 0.2s ease;
  font-size: 12px;
}

.connector-status-summary .summary-item:hover {
  opacity: 0.8;
}

.connector-status-summary .summary-item.ok {
  background: rgba(74, 222, 128, 0.15);
  color: #4ade80;
}

.connector-status-summary .summary-item.ok.active {
  border-color: #4ade80;
}

.connector-status-summary .summary-item.warning {
  background: rgba(251, 191, 36, 0.15);
  color: #fbbf24;
}

.connector-status-summary .summary-item.warning.active {
  border-color: #fbbf24;
}

.connector-status-summary .summary-item.error {
  background: rgba(239, 68, 68, 0.15);
  color: #ef4444;
}

.connector-status-summary .summary-item.error.active {
  border-color: #ef4444;
}

.connector-status-summary .summary-item.unknown {
  background: rgba(107, 114, 128, 0.15);
  color: #9ca3af;
}

.connector-status-summary .summary-item.unknown.active {
  border-color: #9ca3af;
}

.connector-status-summary .summary-item.unavailable {
  background: rgba(107, 114, 128, 0.15);
  color: #6b7280;
}

.connector-status-summary .summary-item.unavailable.active {
  border-color: #6b7280;
}

.connector-status-controls {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
}

.connector-status-controls .filter-group {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 12px;
  color: var(--text-secondary);
}

.connector-status-controls .filter-group select {
  background: rgba(0, 20, 25, 0.6);
  border: 1px solid var(--border-color);
  border-radius: 4px;
  padding: 6px 10px;
  color: var(--text-primary);
  font-size: 12px;
  cursor: pointer;
}

.connector-status-controls .refresh-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 14px;
  background: transparent;
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: var(--primary-red);
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease;
}

.connector-status-controls .refresh-btn:hover:not(:disabled) {
  border-color: var(--primary-red);
}

.connector-status-controls .refresh-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.connector-status-controls .refresh-btn .spinner {
  width: 12px;
  height: 12px;
  border: 2px solid var(--border-color);
  border-top-color: var(--primary-red);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.connector-status-error {
  padding: 12px;
  background: rgba(239, 68, 68, 0.1);
  border: 1px solid rgba(239, 68, 68, 0.3);
  border-radius: 6px;
  color: #ef4444;
  font-size: 12px;
}

.connector-status-table-wrapper {
  flex: 1;
  min-height: 0;
  overflow: auto;
  border: 1px solid var(--border-color);
  border-radius: 6px;
  background: var(--bg-inner);
}

.connector-status-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 12px;
}

.connector-status-table th {
  position: sticky;
  top: 0;
  z-index: 10;
  background: rgba(0, 20, 25, 0.98);
  padding: 10px 12px;
  text-align: left;
  font-weight: 600;
  color: var(--text-secondary);
  border-bottom: 1px solid var(--border-color);
  white-space: nowrap;
}

.connector-status-table th.sortable {
  cursor: pointer;
  user-select: none;
  transition: color 0.2s ease;
}

.connector-status-table th.sortable:hover {
  color: var(--text-primary);
}

.connector-status-table th.sorted {
  color: #3b82f6;
}

.connector-status-table th .sort-indicator {
  font-size: 10px;
  margin-left: 2px;
}

.connector-status-table td {
  padding: 10px 12px;
  border-bottom: 1px solid rgba(0, 180, 180, 0.1);
  color: var(--text-secondary);
}

.connector-status-table tbody tr {
  transition: background 0.15s ease;
}

.connector-status-table tbody tr:hover {
  background: rgba(0, 180, 180, 0.08);
}

.connector-status-table .connector-name {
  color: var(--text-primary);
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 8px;
  white-space: nowrap;
}

.connector-status-table .connector-favicon {
  width: 14px;
  height: 14px;
  flex-shrink: 0;
  border-radius: 2px;
  image-rendering: -webkit-optimize-contrast;
}

.connector-status-table .connector-category {
  color: var(--text-muted);
}

.connector-status-table .connector-tabs {
  color: var(--text-muted);
  font-size: 12px;
  max-width: 150px;
}

.connector-status-table .connector-status {
  display: flex;
  align-items: center;
  gap: 6px;
  font-weight: 500;
}

.connector-status-table .connector-status.status-ok {
  color: #4ade80;
}

.connector-status-table .connector-status.status-warning {
  color: #fbbf24;
}

.connector-status-table .connector-status.status-error {
  color: #ef4444;
}

.connector-status-table .connector-status.status-unknown {
  color: #9ca3af;
}

.connector-status-table .connector-status.status-unavailable {
  color: #6b7280;
}

.connector-status-table tr.status-unavailable td {
  opacity: 0.6;
}

.connector-status-table .connector-status .status-icon {
  font-size: 14px;
}

.connector-status-table .connector-error {
  color: #ef4444;
  font-size: 11px;
  max-width: 200px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.connector-status-table .no-results {
  text-align: center;
  color: var(--text-muted);
  padding: 32px;
}

.connector-status-footer {
  text-align: center;
  font-size: 11px;
  color: var(--text-muted);
  padding-top: 8px;
  border-top: 1px solid var(--border-color);
}

/* Test toggle checkbox */
.connector-status-controls .test-toggle {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  color: var(--text-secondary);
  cursor: pointer;
  user-select: none;
}

.connector-status-controls .test-toggle input {
  accent-color: var(--primary-red);
}

/* Run tests button */
.connector-status-controls .run-tests-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 14px;
  background: rgba(74, 222, 128, 0.1);
  border: 1px solid rgba(74, 222, 128, 0.3);
  border-radius: 4px;
  color: #4ade80;
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  transition: background 0.2s ease, border-color 0.2s ease;
}

.connector-status-controls .run-tests-btn:hover:not(:disabled) {
  background: rgba(74, 222, 128, 0.2);
  border-color: #4ade80;
}

.connector-status-controls .run-tests-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Test table wider when showing tests */
.connector-status-table.show-tests {
  min-width: 1100px;
}

/* Test header columns */
.connector-status-table .test-header {
  text-align: center;
  padding: 10px 6px;
  min-width: 36px;
}

.connector-status-table .test-query-header {
  font-size: 14px;
}

/* Test result cells */
.connector-status-table .test-cell {
  text-align: center;
  padding: 8px 6px;
  font-size: 11px;
  font-weight: 500;
  min-width: 36px;
}

.connector-status-table .test-cell.test-none {
  color: var(--text-muted);
}

.connector-status-table .test-cell.test-ok {
  color: #4ade80;
}

.connector-status-table .test-cell.test-zero {
  color: #fbbf24;
}

.connector-status-table .test-cell.test-error {
  color: #ef4444;
}

/* Docs column */
.connector-status-table .connector-docs {
  text-align: center;
}

.connector-status-table .connector-docs a {
  text-decoration: none;
  font-size: 14px;
}

/* Actions column */
.connector-status-table .connector-actions {
  text-align: center;
  padding: 8px 6px;
}

/* Expand button */
.connector-status-table .expand-btn {
  background: none;
  border: none;
  color: var(--text-muted);
  cursor: pointer;
  padding: 0 4px;
  font-size: 10px;
  transition: color 0.2s ease;
}

.connector-status-table .expand-btn:hover {
  color: var(--text-primary);
}

/* Run single test button */
.connector-status-table .run-test-btn {
  background: none;
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: var(--text-secondary);
  cursor: pointer;
  padding: 4px 8px;
  font-size: 10px;
  transition: color 0.2s ease, border-color 0.2s ease;
}

.connector-status-table .run-test-btn:hover:not(:disabled) {
  color: #4ade80;
  border-color: #4ade80;
}

.connector-status-table .run-test-btn:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

/* Small spinner for single row testing */
.connector-status-table .spinner-small {
  display: inline-block;
  width: 10px;
  height: 10px;
  border: 2px solid var(--border-color);
  border-top-color: #4ade80;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

/* Expanded row styling */
.connector-status-table .expanded-row {
  background: rgba(0, 20, 25, 0.5);
}

.connector-status-table .expanded-row td {
  padding: 16px;
  border-bottom: 2px solid var(--border-color);
}

.connector-status-table tbody tr.expanded {
  background: rgba(0, 180, 180, 0.12);
}

/* Sample items grid */
.sample-items-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
}

.query-samples {
  background: rgba(0, 20, 25, 0.4);
  border: 1px solid var(--border-color);
  border-radius: 6px;
  padding: 12px;
  min-width: 200px;
  max-width: 300px;
}

.query-samples h4 {
  margin: 0 0 10px 0;
  font-size: 12px;
  font-weight: 600;
  color: var(--text-primary);
  display: flex;
  align-items: center;
  gap: 6px;
}

.query-samples h4 .result-count {
  font-weight: 400;
  font-size: 11px;
  color: var(--text-muted);
}

.sample-items {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.sample-item {
  display: flex;
  align-items: center;
  gap: 8px;
  text-decoration: none;
  padding: 6px;
  border-radius: 4px;
  transition: background 0.15s ease;
}

.sample-item:hover {
  background: rgba(0, 180, 180, 0.1);
}

.sample-thumbnail {
  width: 40px;
  height: 40px;
  object-fit: cover;
  border-radius: 4px;
  flex-shrink: 0;
  background: var(--bg-inner);
}

.sample-no-thumb {
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--bg-inner);
  border-radius: 4px;
  font-size: 16px;
  flex-shrink: 0;
}

.sample-title {
  font-size: 11px;
  color: var(--text-secondary);
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  line-height: 1.3;
}

.sample-item:hover .sample-title {
  color: var(--text-primary);
}

/* Disclaimer in Settings section */
.disclaimer-settings-link {
  width: 100%;
  margin-top: 6px;
  padding: 4px 0;
  background: none;
  border: none;
  border-top: 1px solid rgba(192, 32, 35, 0.15);
  color: var(--text-muted);
  font-size: 9px;
  cursor: pointer;
  text-align: center;
  opacity: 0.7;
  transition: opacity 0.2s ease, color 0.2s ease;
}

.disclaimer-settings-link:hover {
  opacity: 1;
  color: var(--text-secondary);
}

.logo-wrapper {
  position: relative;
  display: inline-block;
}

.logo-panel {
  padding: 16px;
  display: flex;
  flex-direction: column;
  white-space: nowrap;
}

.beta-badge {
  position: absolute;
  top: 61px;
  right: 17px;
  font-family: 'Orbitron', sans-serif;
  font-size: 7px;
  font-weight: 700;
  color: #ffd700;
  letter-spacing: 1px;
  text-shadow:
    0 0 3px rgba(0, 0, 0, 0.8),
    0 0 6px rgba(0, 0, 0, 0.5);
}

.logo-main {
  font-family: 'Orbitron', sans-serif;
  font-size: 22px;
  font-weight: 700;
  color: var(--primary-red);
  letter-spacing: 3.4px;
  text-shadow:
    0 0 3px rgba(0, 0, 0, 0.8),
    0 0 6px rgba(0, 0, 0, 0.5);
}

.logo-sub {
  font-family: 'Orbitron', sans-serif;
  font-size: 13px;
  font-weight: 500;
  color: var(--text-secondary);
  letter-spacing: 4.6px;
  text-shadow:
    0 0 3px rgba(0, 0, 0, 0.8),
    0 0 6px rgba(0, 0, 0, 0.5);
}

.glass-panel {
  background: var(--bg-card);
  backdrop-filter: blur(var(--blur-amount));
  -webkit-backdrop-filter: blur(var(--blur-amount));
  border: 1px solid var(--border-color);
  border-radius: 8px;
  padding: 16px;
  flex-shrink: 0;
  width: 280px;
}

/* Search Input */
.search-container {
  display: flex;
  align-items: center;
  gap: 8px;
}

.search-input-wrapper {
  position: relative;
  flex: 1;
}

.search-icon {
  position: absolute;
  left: 12px;
  top: 50%;
  transform: translateY(-50%);
  pointer-events: none;
  color: var(--primary-red);
  opacity: 0.7;
}

.search-input {
  width: 100%;
  padding: 10px 32px 10px 36px;
  background: rgba(0, 20, 25, 0.6);
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: var(--text-primary);
  font-size: 14px;
  outline: none;
  transition: border-color 0.2s ease;
}

.search-input::placeholder {
  color: var(--text-secondary);
}

.search-input:focus {
  border-color: var(--primary-red);
}

/* Search Clear Button */
.search-clear-btn {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  padding: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0.7;
  transition: opacity 0.2s ease, color 0.2s ease;
}

.search-clear-btn:hover {
  opacity: 1;
  color: var(--primary-red);
}

/* Search Options Column - stacks rows vertically */
.search-options-column {
  display: flex;
  flex-direction: column;
  gap: 4px;
  margin-top: 8px;
}

/* Search Options Row - contains toggle and random button */
.search-options-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

/* Unified Search Option Toggle */
.search-option-toggle {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 4px 0;
  font-size: 11px;
  color: var(--text-secondary);
  cursor: pointer;
  user-select: none;
  transition: opacity 0.2s ease;
}

.search-option-toggle input[type="checkbox"] {
  appearance: none;
  -webkit-appearance: none;
  width: 12px;
  height: 12px;
  background: rgba(0, 20, 25, 0.6);
  border: 1px solid rgba(192, 32, 35, 0.3);
  border-radius: 2px;
  cursor: pointer;
  position: relative;
  flex-shrink: 0;
  transition: background 0.2s ease, border-color 0.2s ease;
}

.search-option-toggle input[type="checkbox"]:hover {
  border-color: rgba(192, 32, 35, 0.6);
}

.search-option-toggle input[type="checkbox"]:checked {
  background: rgba(192, 32, 35, 0.3);
  border-color: var(--primary-red);
}

.search-option-toggle input[type="checkbox"]:checked::after {
  content: '';
  position: absolute;
  left: 3px;
  top: 0px;
  width: 4px;
  height: 7px;
  border: solid var(--primary-red);
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}

.search-option-toggle span {
  transition: color 0.2s ease;
}

.search-option-toggle:hover span {
  color: var(--text-primary);
}

.search-option-toggle.disabled {
  opacity: 0.4;
  cursor: default;
}

.search-option-toggle.disabled input[type="checkbox"] {
  cursor: default;
}

.search-option-toggle.disabled:hover span {
  color: var(--text-secondary);
}

/* Random Site Button */
.random-site-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 5px 10px;
  font-size: 12px;
  color: var(--text-secondary);
  background: rgba(0, 20, 25, 0.6);
  border: 1px solid rgba(192, 32, 35, 0.3);
  border-radius: 4px;
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
}

.random-site-btn:hover {
  color: var(--text-primary);
  border-color: var(--primary-red);
  background: rgba(192, 32, 35, 0.15);
}

.random-site-btn svg {
  opacity: 0.7;
}

.random-site-btn:hover svg {
  opacity: 1;
  color: var(--primary-red);
}

/* Random Site Button - Icon Only (inside search container) */
.random-site-btn-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 6px;
  background: transparent;
  border: 1px solid rgba(192, 32, 35, 0.3);
  border-radius: 4px;
  color: var(--text-secondary);
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease;
  flex-shrink: 0;
}

.random-site-btn-icon:hover {
  color: var(--primary-red);
  border-color: var(--primary-red);
  background: rgba(192, 32, 35, 0.15);
}

.random-site-btn-icon svg {
  opacity: 0.7;
}

.random-site-btn-icon:hover svg {
  opacity: 1;
}

.random-site-btn-icon.active {
  color: #32CD32;
  border-color: #32CD32;
  background: rgba(50, 205, 50, 0.15);
}

.random-site-btn-icon.active svg {
  opacity: 1;
}

.measure-distance-display {
  font-size: 11px;
  color: #32CD32;
  padding: 4px 8px;
  background: rgba(50, 205, 50, 0.15);
  border: 1px solid rgba(50, 205, 50, 0.3);
  border-radius: 4px;
  white-space: nowrap;
}

/* Search/Proximity Tabs */
.search-proximity-tabs {
  display: flex;
  gap: 0;
  margin-bottom: 12px;
  border: 1px solid var(--border-color);
  border-radius: 4px;
  overflow: hidden;
}

.search-proximity-tabs .tab-btn {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 5px;
  padding: 8px 8px;
  background: transparent;
  border: none;
  color: var(--text-secondary);
  font-size: 11px;
  line-height: 1.2;
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
}

.search-proximity-tabs .tab-btn:not(:last-child) {
  border-right: 1px solid var(--border-color);
}

.search-proximity-tabs .tab-btn:hover {
  background: rgba(192, 32, 35, 0.1);
  color: var(--text-primary);
}

.search-proximity-tabs .tab-btn.active {
  background: rgba(192, 32, 35, 0.15);
  color: var(--primary-red);
}

.search-proximity-tabs .tab-btn.has-value:not(.active) {
  color: var(--primary-red);
  opacity: 0.7;
}

.search-proximity-tabs .tab-btn svg {
  opacity: 0.7;
}

.search-proximity-tabs .tab-btn.active svg,
.search-proximity-tabs .tab-btn:hover svg {
  opacity: 1;
}

/* Search Tab Content */
.search-tab-content {
  display: flex;
  flex-direction: column;
}

/* Proximity Tab Content */
.proximity-tab-content {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

/* Coordinate Inputs */
/* Coordinate input */
.coordinate-input-wrapper {
  margin-top: 8px;
  position: relative;
}

.coordinate-input {
  width: 100%;
  min-width: 220px;
  padding: 10px 36px 10px 12px;
  background: rgba(0, 20, 25, 0.6);
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: var(--text-primary);
  font-size: 13px;
  font-family: 'JetBrains Mono', monospace;
  outline: none;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
  text-align: center;
}

.coordinate-input::placeholder {
  color: var(--text-secondary);
  opacity: 0.5;
}

.coordinate-input:focus {
  border-color: var(--primary-red);
  background: rgba(0, 20, 25, 0.8);
}

.coordinate-input-wrapper:focus-within {
  border-color: var(--primary-red);
}

/* Clear button for coordinates */
.coord-clear-btn {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  display: flex;
  align-items: center;
  justify-content: center;
  width: 20px;
  height: 20px;
  padding: 0;
  background: transparent;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  opacity: 0.6;
  transition: opacity 0.2s ease, color 0.2s ease;
}

.coord-clear-btn:hover {
  opacity: 1;
  color: var(--primary-red);
}

/* Live coordinates from globe hover */
.coordinate-input.live-coords {
  background: rgba(192, 32, 35, 0.15);
  border-color: rgba(192, 32, 35, 0.5);
  color: var(--primary-red);
}

/* Proximity Action Buttons */
.proximity-actions {
  display: flex;
  gap: 8px;
}

.proximity-btn {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  padding: 10px 12px;
  background: rgba(0, 20, 25, 0.6);
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: var(--text-secondary);
  font-size: 11px;
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
}

.proximity-btn:hover {
  border-color: var(--primary-red);
  color: var(--text-primary);
}

.proximity-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.proximity-btn.active {
  background: rgba(192, 32, 35, 0.2);
  border-color: var(--primary-red);
  color: var(--primary-red);
}

.proximity-btn.set-on-globe.active {
  animation: pulse-glow 1.5s ease-in-out infinite;
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 5px rgba(192, 32, 35, 0.3); }
  50% { box-shadow: 0 0 15px rgba(192, 32, 35, 0.6); }
}

.proximity-btn.clear {
  flex: none;
  background: transparent;
  border-color: rgba(192, 32, 35, 0.3);
}

.proximity-btn.clear:hover {
  background: rgba(192, 32, 35, 0.1);
}

/* Location Error */
.location-error {
  margin-top: 6px;
  padding: 6px 10px;
  background: rgba(192, 32, 35, 0.15);
  border: 1px solid rgba(192, 32, 35, 0.3);
  border-radius: 4px;
  color: var(--primary-red);
  font-size: 11px;
  text-align: center;
}

/* Radius Slider Section */
.radius-section {
  display: flex;
  flex-direction: column;
  gap: 6px;
  padding-top: 8px;
  border-top: 1px solid var(--border-color);
}

.radius-label {
  font-size: 11px;
  color: var(--text-secondary);
  display: flex;
  justify-content: space-between;
}

.radius-value {
  color: var(--primary-red);
  font-weight: 500;
}

.radius-slider {
  width: 100%;
  height: 6px;
  -webkit-appearance: none;
  appearance: none;
  background: linear-gradient(to right, rgba(192, 32, 35, 0.3), var(--primary-red));
  border-radius: 3px;
  outline: none;
  cursor: pointer;
}

.radius-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 16px;
  height: 16px;
  background: var(--primary-red);
  border: 2px solid white;
  border-radius: 50%;
  cursor: pointer;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.radius-slider::-moz-range-thumb {
  width: 16px;
  height: 16px;
  background: var(--primary-red);
  border: 2px solid white;
  border-radius: 50%;
  cursor: pointer;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.radius-labels {
  display: flex;
  justify-content: space-between;
  font-size: 10px;
  color: var(--text-secondary);
}

/* Measure Tab Content */
.measure-tab-content {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.measure-controls {
  display: flex;
  gap: 12px;
  align-items: center;
}

.measure-toggle-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 14px;
  background: rgba(0, 20, 25, 0.6);
  border: 1px solid var(--border-color);
  border-radius: 6px;
  color: var(--text-primary);
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.measure-toggle-btn:hover {
  border-color: var(--primary);
  background: rgba(0, 128, 102, 0.1);
}

.measure-toggle-btn.active {
  background: rgba(0, 128, 102, 0.2);
  border-color: var(--primary);
  color: var(--primary);
}

.snap-toggle {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  color: var(--text-secondary);
  cursor: pointer;
}

.snap-toggle input {
  accent-color: var(--primary);
}

.snap-toggle:hover {
  color: var(--text-primary);
}

.unit-toggle {
  display: flex;
  gap: 2px;
  background: rgba(0, 20, 25, 0.6);
  border: 1px solid var(--border-color);
  border-radius: 4px;
  padding: 2px;
}

.unit-btn {
  padding: 4px 10px;
  background: transparent;
  border: none;
  border-radius: 3px;
  color: var(--text-secondary);
  font-size: 11px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
}

.unit-btn:hover {
  color: var(--text-primary);
}

.unit-btn.active {
  background: var(--primary);
  color: white;
}

.measure-status {
  padding: 8px 12px;
  background: rgba(0, 128, 102, 0.1);
  border: 1px solid rgba(0, 128, 102, 0.3);
  border-radius: 4px;
  color: var(--primary);
  font-size: 12px;
  text-align: center;
}

.measurement-list {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.measurements-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 4px 0;
  font-size: 11px;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.clear-all-btn {
  padding: 2px 8px;
  background: transparent;
  border: 1px solid rgba(192, 32, 35, 0.3);
  border-radius: 3px;
  color: var(--primary-red);
  font-size: 10px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.clear-all-btn:hover {
  background: rgba(192, 32, 35, 0.1);
}

.measurement-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 10px;
  background: rgba(0, 20, 25, 0.4);
  border: 1px solid var(--border-color);
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.measurement-item:hover {
  background: rgba(0, 20, 25, 0.6);
  border-color: var(--primary);
}

.measurement-item.selected {
  background: rgba(0, 128, 102, 0.15);
  border-color: var(--primary);
}

.measurement-distance {
  font-size: 14px;
  font-weight: 500;
  color: var(--text-primary);
}

.measurement-miles {
  margin-left: 6px;
  font-size: 11px;
  font-weight: normal;
  color: var(--text-secondary);
}

.measurement-delete-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  background: transparent;
  border: none;
  border-radius: 4px;
  color: var(--text-secondary);
  cursor: pointer;
  transition: all 0.2s ease;
}

.measurement-delete-btn:hover {
  background: rgba(192, 32, 35, 0.15);
  color: var(--primary-red);
}

.measure-help {
  padding: 12px;
  background: rgba(0, 20, 25, 0.3);
  border: 1px dashed var(--border-color);
  border-radius: 4px;
  color: var(--text-secondary);
  font-size: 12px;
  text-align: center;
  line-height: 1.5;
}

/* Search Results List */
.search-results-panel {
  padding: 0 !important;
  flex: 0 1 auto;  /* Size to content, can shrink, NO grow */
  min-height: 40px;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.search-results-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px;
  height: 40px;
  box-sizing: border-box;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-secondary);
  flex-shrink: 0;
}

/* Few results - fit content exactly */
.search-results-panel.few-results {
  flex: 0 0 auto;
}

/* Many results - size to content, can shrink, min 3 items */
.search-results-panel.many-results {
  flex: 0 1 auto;
  min-height: 210px;  /* Show at least 3 results */
}

/* Minimized search results */
.search-results-panel.minimized {
  flex: 0 0 40px;
  min-height: 40px;
  max-height: 40px;
  height: 40px;
}

.search-results-list {
  overflow-y: auto;
  flex: 1 1 auto;  /* Fill remaining space in panel */
}

.search-results-list::-webkit-scrollbar {
  width: 6px;
}

.search-results-list::-webkit-scrollbar-track {
  background: rgba(0, 0, 0, 0.2);
}

.search-results-list::-webkit-scrollbar-thumb {
  background: rgba(192, 32, 35, 0.4);
  border-radius: 3px;
}

.search-results-list::-webkit-scrollbar-thumb:hover {
  background: rgba(192, 32, 35, 0.6);
}

.search-result-item {
  display: flex;
  align-items: center;
  gap: 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
  transition: background 0.15s ease;
}

.search-result-item:last-child {
  border-bottom: none;
}

.search-result-item:hover {
  background: rgba(192, 32, 35, 0.1);
}

.search-result-item.selected {
  background: rgba(192, 32, 35, 0.25);
}

.search-result-item.selected:hover {
  background: rgba(192, 32, 35, 0.3);
}

.search-result-main {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  flex: 1;
  padding: 10px 12px;
  cursor: pointer;
  min-width: 0;
}

.search-result-content {
  flex: 1;
  min-width: 0;
  overflow: hidden;
}

.search-result-title {
  font-size: 13px;
  font-weight: 500;
  color: var(--text-primary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.search-result-meta {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 3px;
  font-size: 11px;
  color: var(--text-secondary);
}

.search-result-location {
  color: var(--text-secondary);
  font-size: 11px;
  display: inline-flex;
  align-items: center;
  gap: 4px;
}

.search-result-flag {
  height: 12px;
  width: auto;
  flex-shrink: 0;
  border-radius: 1px;
}

.search-result-badge {
  font-size: 10px;
  padding: 2px 6px;
  border: 1px solid;
  border-radius: 3px;
  font-weight: 500;
  white-space: nowrap;
}

.search-result-source-line {
  margin: 3px 0;
}

.search-result-badge.search-result-source {
  border-radius: 12px;
  padding: 2px 8px;
}

.search-result-info-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  margin-right: 8px;
  background: rgba(192, 32, 35, 0.2);
  border: 1px solid rgba(192, 32, 35, 0.3);
  border-radius: 6px;
  color: var(--text-secondary);
  cursor: pointer;
  transition: color 0.15s ease, background 0.15s ease, border-color 0.15s ease, opacity 0.15s ease;
  flex-shrink: 0;
}

.search-result-info-btn:hover {
  background: rgba(192, 32, 35, 0.4);
  border-color: var(--primary-red);
  color: var(--text-primary);
}

.search-results-empty {
  padding: 20px 12px;
  font-size: 13px;
  color: var(--text-secondary);
  text-align: center;
}

/* Age Range Slider */
.age-range-slider {
  position: relative;
  height: 40px;
  margin: 12px 0 8px;
  padding: 0 8px;
}

.age-range-track {
  position: absolute;
  top: 8px;
  left: 8px;
  right: 8px;
  height: 6px;
  background: linear-gradient(to right, #ff0000, #ff4400, #ff6600, #ff9900, #ffcc00, #ffff00);
  border-radius: 3px;
}

.age-zero-marker {
  position: absolute;
  top: 4px;
  left: calc(8px + (100% - 16px) * 0.7692);
  width: 1px;
  height: 14px;
  background: rgba(255, 255, 255, 0.4);
  pointer-events: none;
  z-index: 1;
}

.age-slider {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 22px;
  -webkit-appearance: none;
  appearance: none;
  background: transparent;
  pointer-events: none;
  margin: 0;
  padding: 0 8px;
}

.age-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 16px;
  height: 16px;
  background: var(--primary-red);
  border: 2px solid white;
  border-radius: 50%;
  cursor: pointer;
  pointer-events: auto;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.age-slider::-moz-range-thumb {
  width: 16px;
  height: 16px;
  background: var(--primary-red);
  border: 2px solid white;
  border-radius: 50%;
  cursor: pointer;
  pointer-events: auto;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.age-range-labels {
  position: absolute;
  bottom: 0;
  left: 8px;
  right: 8px;
  display: flex;
  justify-content: space-between;
  font-size: 11px;
  color: var(--text-secondary);
}

.age-label-min,
.age-label-max {
  background: rgba(0, 20, 25, 0.8);
  padding: 2px 6px;
  border-radius: 3px;
}

/* Filter Section */
.filter-section {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.filter-label {
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--primary-red);
  opacity: 0.8;
}

.filter-mode-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  height: 16px;
  flex-shrink: 0;
}

/* Minimized filter-mode-toggle - same padding, fixed size */
.filter-mode-toggle.minimized,
.filter-mode-toggle.minimized.source-active,
.filter-mode-toggle.minimized.category-active {
  flex: 0 0 40px !important;
  height: 40px !important;
  min-height: 40px !important;
  max-height: 40px !important;
  overflow: hidden;
}

.filter-mode-toggle.minimized .filter-mode-header {
  height: 16px;
}

.filter-mode-header .filter-label {
  display: flex;
  align-items: center;
  gap: 6px;
}

.minimized-info {
  font-size: 10px;
  color: var(--text-secondary);
  text-transform: none;
  letter-spacing: 0;
  opacity: 1;
}

.filter-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.filter-btn {
  padding: 6px 12px;
  background: transparent;
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: var(--text-secondary);
  font-size: 12px;
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
}

.filter-btn:hover {
  border-color: var(--primary-red);
  color: var(--text-primary);
}

.filter-btn.active {
  background: rgba(192, 32, 35, 0.15);
  border-color: var(--primary-red);
  color: var(--primary-red);
}

.color-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  display: inline-block;
  margin-right: 6px;
}

.filter-count {
  margin-left: auto;
  background: var(--primary-red);
  color: #000;
  padding: 2px 8px;
  border-radius: 10px;
  font-size: 11px;
  font-weight: 600;
}

.clear-btn {
  margin-top: 16px;
  padding: 8px 16px;
  background: transparent;
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: var(--text-secondary);
  font-size: 12px;
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
  width: 100%;
}

.clear-btn:hover {
  border-color: var(--primary-red);
  color: var(--primary-red);
}

/* Color Mode Toggle */
.filter-mode-toggle {
  padding: 12px;
  flex: 0 0 auto;  /* Default (Age): size to content, don't grow */
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* Source active: size to content, can shrink */
.filter-mode-toggle.source-active {
  flex: 0 1 auto;
  min-height: 200px;
}

/* Category active: fill available space and allow scrolling */
.filter-mode-toggle.category-active {
  flex: 1 1 0;
  min-height: 220px;
  max-height: 100%;
}

.toggle-buttons {
  display: flex;
  gap: 6px;
  margin-top: 8px;
  flex-shrink: 0;
  flex-wrap: nowrap;
}

.toggle-btn {
  flex: 1;
  padding: 8px 8px;
  background: transparent;
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: var(--text-secondary);
  font-size: 11px;
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
  white-space: nowrap;
}

.toggle-btn:hover {
  border-color: var(--primary-red);
  color: var(--text-primary);
}

.toggle-btn.active {
  background: rgba(192, 32, 35, 0.15);
  border-color: var(--primary-red);
  color: var(--primary-red);
}

/* Filter active indicator (dot next to "Filter By" label) */
.filter-active-indicator {
  display: inline-block;
  width: 6px;
  height: 6px;
  background: var(--primary-red);
  border-radius: 50%;
  margin-left: 6px;
  vertical-align: middle;
  animation: pulse-dot 2s ease-in-out infinite;
}

@keyframes pulse-dot {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

/* Filter dot inside toggle buttons */
.toggle-btn {
  position: relative;
}

.filter-dot {
  position: absolute;
  top: 3px;
  right: 3px;
  width: 5px;
  height: 5px;
  background: var(--primary-red);
  border-radius: 50%;
}

.toggle-btn.active .filter-dot {
  background: var(--primary-red);
}

/* Filter header buttons container */
.filter-header-buttons {
  display: flex;
  align-items: center;
  gap: 4px;
}

/* Filter reset button */
.filter-reset-btn {
  background: transparent;
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 4px;
  padding: 3px 5px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-secondary);
  transition: all 0.2s ease;
}

.filter-reset-btn:hover {
  border-color: var(--primary-red);
  color: var(--primary-red);
  background: rgba(192, 32, 35, 0.1);
}

/* Age Legend */
.age-legend {
  margin-top: 12px;
  padding-top: 12px;
  border-top: 1px solid var(--border-color);
  flex: 0 0 auto;  /* Never grow or shrink */
}

.gradient-bar {
  height: 8px;
  border-radius: 4px;
  background: linear-gradient(90deg,
    #ff0000 0%,
    #ff4400 20%,
    #ff6600 40%,
    #ff9900 60%,
    #ffcc00 80%,
    #ffff00 100%
  );
  margin-bottom: 4px;
}

.gradient-labels {
  display: flex;
  justify-content: space-between;
  font-size: 10px;
  color: var(--text-secondary);
  margin-bottom: 10px;
}

.period-legend {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.period-item {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 11px;
  color: var(--text-secondary);
}

.period-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  flex-shrink: 0;
}

.period-name {
  white-space: nowrap;
}

/* Social + Contribute Wrapper - positioned left of settings panel */
.social-contribute-wrapper {
  position: fixed;
  top: 20px;
  /* 20px base + (160px settings panel width + 12px gap) * scale */
  right: calc(20px + 172px * var(--hud-scale, 1));
  z-index: 100;
  transition: right 0.25s ease-out;
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 6px;
  pointer-events: none; /* Allow globe interaction through empty space */
}

/* Row 1: Social Media Links */
.social-links {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 2px;
  padding: 6px 8px;
  background: var(--bg-card);
  backdrop-filter: blur(var(--blur-amount));
  -webkit-backdrop-filter: blur(var(--blur-amount));
  border: 1px solid var(--border-color);
  border-radius: 6px;
  pointer-events: auto; /* Re-enable for interactive content */
}

/* Row 2: Action Buttons (Contribute, Lyra, Sign In) */
.action-links {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 2px;
  padding: 6px 8px;
  background: var(--bg-card);
  backdrop-filter: blur(var(--blur-amount));
  -webkit-backdrop-filter: blur(var(--blur-amount));
  border: 1px solid var(--border-color);
  border-radius: 6px;
  pointer-events: auto;
}

.social-link {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  color: var(--text-secondary);
  text-decoration: none;
  border-radius: 4px;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
}

.social-link:hover {
  color: var(--primary-red);
  background: rgba(192, 32, 35, 0.15);
}

/* ============================================
   Action Buttons (icon-only) - Contribute, Ask Lyra, Sign In
   Same styling as social links: grey default, red on hover
   ============================================ */

.action-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  padding: 0;
  color: var(--text-secondary);
  background: transparent;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease;
}

.action-btn:hover {
  color: var(--primary-red);
  background: rgba(192, 32, 35, 0.15);
}

/* Contribute Button - active state when picker is open */
.action-btn.contribute-btn.active {
  color: var(--primary-red);
  background: rgba(192, 32, 35, 0.15);
}

/* Disabled Action Buttons (Sign In, News Feed, etc.) */
.action-btn.disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.action-btn.disabled:hover {
  color: var(--text-secondary);
  background: transparent;
}

/* Contribute Modal */
.contribute-modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  padding: 20px;
}

.contribute-modal-overlay.hidden {
  display: none !important;
}

/* Disclaimer Modal */
.disclaimer-modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.85);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  padding: 20px;
}

.disclaimer-modal {
  position: relative;
  background: var(--bg-card-solid);
  backdrop-filter: blur(var(--blur-amount));
  -webkit-backdrop-filter: blur(var(--blur-amount));
  border-radius: 12px;
  border: 1px solid var(--border-color);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
  width: 100%;
  max-width: 700px;
  max-height: 85vh;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

.disclaimer-modal .popup-close {
  position: absolute;
  top: 12px;
  right: 12px;
  z-index: 10;
}

.disclaimer-content {
  padding: 24px;
  overflow-y: auto;
  flex: 1;
}

.disclaimer-content h2 {
  color: var(--primary-red);
  font-size: 20px;
  font-weight: 600;
  margin: 0 0 20px 0;
  letter-spacing: 1px;
  text-transform: uppercase;
}

.disclaimer-section {
  margin-bottom: 8px;
  border: 1px solid var(--border-color);
  border-radius: 8px;
  overflow: hidden;
}

.disclaimer-section-header {
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  background: rgba(192, 32, 35, 0.05);
  border: none;
  color: var(--text-primary);
  font-size: 13px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  cursor: pointer;
  transition: background 0.2s ease;
}

.disclaimer-section-header:hover {
  background: rgba(192, 32, 35, 0.1);
}

.disclaimer-section-header .chevron {
  transition: transform 0.2s ease;
}

.disclaimer-section.open .disclaimer-section-header .chevron {
  transform: rotate(180deg);
}

.disclaimer-section-content {
  padding: 16px;
  font-size: 12px;
  line-height: 1.6;
  color: var(--text-secondary);
  border-top: 1px solid var(--border-color);
}

.disclaimer-section-content p {
  margin: 0 0 12px 0;
}

.disclaimer-section-content p:last-child {
  margin-bottom: 0;
}

.disclaimer-section-content ul {
  margin: 0;
  padding-left: 20px;
}

.disclaimer-section-content li {
  margin-bottom: 8px;
}

.disclaimer-section-content li:last-child {
  margin-bottom: 0;
}

.disclaimer-section-content h4 {
  color: var(--text-primary);
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin: 16px 0 8px 0;
}

.disclaimer-section-content h4:first-child {
  margin-top: 0;
}

.source-licenses .license-group {
  margin-bottom: 12px;
}

.source-licenses .license-group:last-child {
  margin-bottom: 0;
}

.source-licenses a {
  color: var(--primary-red);
  text-decoration: none;
  transition: color 0.2s ease;
}

.source-licenses a:hover {
  color: var(--primary-red-hover);
  text-decoration: underline;
}

.attribution-note {
  font-style: italic;
  margin-top: 16px !important;
  padding-top: 12px;
  border-top: 1px solid var(--border-color);
}

.contact-links {
  display: flex;
  gap: 12px;
  margin-top: 12px;
}

.contact-links a {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 16px;
  background: rgba(192, 32, 35, 0.1);
  border: 1px solid rgba(192, 32, 35, 0.3);
  border-radius: 6px;
  color: var(--primary-red);
  font-size: 12px;
  text-decoration: none;
  transition: all 0.2s ease;
}

.contact-links a:hover {
  background: rgba(192, 32, 35, 0.2);
  border-color: var(--primary-red);
}

.disclaimer-footer {
  margin-top: 20px;
  padding-top: 16px;
  border-top: 1px solid var(--border-color);
  text-align: center;
  font-size: 11px;
  color: var(--text-muted);
}

/* Disclaimer Link in Globe HUD */
.disclaimer-link {
  background: none;
  border: none;
  color: var(--text-muted);
  font-size: 10px;
  padding: 4px 8px;
  cursor: pointer;
  opacity: 0.6;
  transition: opacity 0.2s ease, color 0.2s ease;
  text-decoration: none;
  font-family: inherit;
}

.disclaimer-link:hover {
  opacity: 1;
  color: var(--text-secondary);
}

/* Minimized Modal (when picking coordinates on globe) */
.contribute-modal-minimized {
  position: fixed;
  top: 12px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 1000;
  background: var(--bg-card-solid);
  backdrop-filter: blur(var(--blur-amount));
  -webkit-backdrop-filter: blur(var(--blur-amount));
  border: 1px solid var(--primary-red);
  border-radius: 6px;
  padding: 8px 12px;
  display: flex;
  align-items: center;
  gap: 12px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
}

.mini-coords-display {
  font-size: 13px;
  font-family: 'Orbitron', monospace;
  color: var(--primary-red);
  letter-spacing: 0.5px;
}

.contribute-modal-minimized .popup-close {
  position: static;
  width: 20px;
  height: 20px;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  transition: color 0.2s ease;
  opacity: 0.6;
}

.contribute-modal-minimized .popup-close:hover {
  color: var(--primary-red);
  opacity: 1;
}

.contribute-modal {
  background: var(--bg-card-solid);
  backdrop-filter: blur(var(--blur-amount));
  -webkit-backdrop-filter: blur(var(--blur-amount));
  border: 1px solid var(--border-color);
  border-radius: 8px;
  max-width: 480px;
  width: 100%;
  max-height: calc(100vh - 40px);
  overflow-y: auto;
  position: relative;
  padding: 20px 24px;
}

.contribute-modal .popup-close {
  position: absolute;
  top: 12px;
  right: 12px;
  z-index: 10;
}

.contribute-header {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  margin-bottom: 20px;
}

.contribute-header h2 {
  font-size: 20px;
  color: var(--text-primary);
  margin: 0;
}

/* Reset form button */
.form-reset-btn {
  background: transparent;
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 4px;
  padding: 4px 6px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-secondary);
  transition: all 0.2s ease;
}

.form-reset-btn:hover {
  border-color: var(--primary-red);
  color: var(--primary-red);
  background: rgba(192, 32, 35, 0.1);
}

/* Auto-save indicator in upper left */
.form-saved-indicator {
  position: absolute;
  left: 0;
  top: 50%;
  transform: translateY(-50%);
  font-size: 10px;
  color: rgba(74, 222, 128, 0.7);
  pointer-events: none;
  animation: saved-fade 2s ease-in-out forwards;
}

@keyframes saved-fade {
  0% { opacity: 0; }
  15% { opacity: 1; }
  85% { opacity: 1; }
  100% { opacity: 0; }
}

/* Wrapper for input + checkmark */
.input-with-check {
  position: relative;
}

/* Green border when field has value */
.contribute-input.has-value,
.contribute-textarea.has-value,
.contribute-select.has-value {
  border-color: rgba(74, 222, 128, 0.5);
}

/* Checkmark inside field */
.field-saved-check {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  color: #4ade80;
  font-size: 12px;
  pointer-events: none;
  animation: checkmark-pop 0.3s ease-out;
}

/* For textarea, position at top-right */
.input-with-check:has(.contribute-textarea) .field-saved-check {
  top: 10px;
  transform: none;
}

/* For select dropdown, position left of the arrow */
.field-saved-check.select-check {
  right: 32px;
}

@keyframes checkmark-pop {
  0% { transform: translateY(-50%) scale(0); opacity: 0; }
  50% { transform: translateY(-50%) scale(1.2); }
  100% { transform: translateY(-50%) scale(1); opacity: 1; }
}

/* Contribute Form Styles */
.contribute-form {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.form-row {
  display: flex;
  gap: 12px;
}

.form-row .form-group {
  flex: 1;
}

.form-group label {
  font-size: 13px;
  color: var(--text-secondary);
}

.form-group label .required {
  color: var(--primary-red);
}

.form-group label .optional {
  color: var(--text-secondary);
  opacity: 0.6;
  font-size: 11px;
}

.contribute-input,
.contribute-textarea,
.contribute-select {
  width: 100%;
  height: 36px;
  padding: 0 12px;
  background: rgba(0, 20, 25, 0.6);
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: var(--text-primary);
  font-size: 14px;
  outline: none;
  transition: border-color 0.2s ease;
  box-sizing: border-box;
}

.contribute-textarea {
  height: auto;
  padding: 10px 12px;
  resize: vertical;
  min-height: 60px;
  font-family: inherit;
}

.contribute-input:focus,
.contribute-textarea:focus,
.contribute-select:focus {
  border-color: var(--primary-red);
}

.contribute-input::placeholder,
.contribute-textarea::placeholder {
  color: var(--text-secondary);
  opacity: 0.5;
}

.contribute-select {
  cursor: pointer;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23888' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  padding-right: 36px;
}

.contribute-select option {
  background: #0a1a1f;
  color: var(--text-primary);
}

/* Coordinate Row - input + globe button */
.coordinate-row {
  display: flex;
  gap: 8px;
  align-items: center;
}

.coord-set-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  height: 36px;
  padding: 0 12px;
  background: rgba(0, 20, 25, 0.6);
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: var(--text-secondary);
  font-size: 12px;
  white-space: nowrap;
  cursor: pointer;
  transition: all 0.2s ease;
  flex-shrink: 0;
}

.coord-set-btn:hover {
  border-color: var(--primary-red);
  color: var(--primary-red);
}

.coord-set-btn.active {
  background: rgba(192, 32, 35, 0.2);
  border-color: var(--primary-red);
  color: var(--primary-red);
  animation: pulse-glow 1.5s ease-in-out infinite;
}

@keyframes pulse-glow {
  0%, 100% {
    box-shadow: 0 0 0 0 rgba(192, 32, 35, 0.4);
  }
  50% {
    box-shadow: 0 0 0 6px rgba(192, 32, 35, 0);
  }
}

/* Coordinate Input Wrapper - inside contribute modal */
.coordinate-row .coordinate-input-wrapper {
  position: relative;
  display: flex;
  align-items: center;
  flex: 1;
  margin: 0;
}

.coordinate-input {
  padding-right: 36px;
}

.coordinate-input.live-coords {
  border-color: var(--primary-red);
  animation: pulse-border 1.5s ease-in-out infinite;
}

@keyframes pulse-border {
  0%, 100% { border-color: var(--primary-red); }
  50% { border-color: rgba(192, 32, 35, 0.5); }
}

.coord-clear-btn {
  position: absolute;
  right: 8px;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  opacity: 0.6;
  transition: all 0.2s ease;
}

.coord-clear-btn:hover {
  opacity: 1;
  color: var(--primary-red);
}

/* Coordinate checkmark - positioned before clear button */
.field-saved-check.coord-check {
  right: 36px;  /* Make room for clear button */
}

.map-picker-hint {
  font-size: 12px;
  color: var(--primary-red);
  margin-top: 6px;
  animation: pulse-text 1.5s ease-in-out infinite;
}

@keyframes pulse-text {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.6; }
}

/* Media Upload */
.media-upload-area {
  display: flex;
  align-items: center;
  gap: 12px;
}

.media-upload-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 14px;
  background: rgba(0, 20, 25, 0.6);
  border: 1px dashed var(--border-color);
  border-radius: 4px;
  color: var(--text-secondary);
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.media-upload-btn:hover:not(:disabled) {
  border-color: var(--primary-red);
  color: var(--primary-red);
  border-style: solid;
}

.media-upload-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.media-hint {
  font-size: 11px;
  color: var(--text-secondary);
  opacity: 0.6;
  font-style: italic;
}

/* Turnstile Container - Fixed height to prevent layout shift */
.turnstile-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 65px;
  height: 65px;
}

/* Error Message */
.contribute-error {
  padding: 10px 12px;
  background: rgba(239, 68, 68, 0.15);
  border: 1px solid rgba(239, 68, 68, 0.3);
  border-radius: 4px;
  color: #ef4444;
  font-size: 13px;
  text-align: center;
}

/* Submit Button */
.contribute-submit-btn {
  padding: 12px 24px;
  background: var(--primary-red);
  border: none;
  border-radius: 4px;
  color: white;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.contribute-submit-btn:hover:not(:disabled) {
  background: var(--primary-red-hover);
}

.contribute-submit-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.submit-spinner {
  width: 16px;
  height: 16px;
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Success State */
.contribute-success {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
  padding: 24px 0 8px;
  text-align: center;
}

.contribute-success h3 {
  font-size: 18px;
  color: #4ade80;
  margin: 0;
}

.contribute-success p {
  color: var(--text-secondary);
  margin: 0;
}

.success-buttons {
  display: flex;
  gap: 12px;
  margin-top: 8px;
}

.contribute-another-btn {
  padding: 10px 20px;
  background: transparent;
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: var(--text-secondary);
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.contribute-another-btn:hover {
  border-color: var(--primary-red);
  color: var(--primary-red);
}

.contribute-done-btn {
  padding: 10px 24px;
  background: var(--primary-red);
  border: none;
  border-radius: 4px;
  color: white;
  font-size: 14px;
  cursor: pointer;
  transition: background 0.2s ease;
}

.contribute-done-btn:hover {
  background: var(--primary-red-hover);
}

/* Queued offline contribution styles */
.contribute-queued h3 {
  color: #00b4b4;
}

.queued-hint {
  font-size: 12px;
  color: #707070;
  font-style: italic;
}

.success-socials {
  margin-top: 4px;
  padding-top: 16px;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.socials-invite {
  font-size: 13px;
  line-height: 1.6;
  color: var(--text-secondary);
  margin-bottom: 0;
}

.socials-invite .brand-name {
  color: var(--primary-red);
  font-weight: 600;
}

.socials-links {
  display: flex;
  gap: 16px;
  justify-content: center;
  margin-top: 16px;
}

.socials-links a {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.1);
  color: var(--text-secondary);
  transition: all 0.2s ease;
}

.socials-links a:hover {
  background: var(--primary-red);
  color: white;
  transform: scale(1.1);
}

/* Upper-right Info Panel (FPS + LOD + Settings) - positioned top right corner */
.info-panel-top-right {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 100;
  transition: right 0.25s ease-out;
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding: 10px;
  background: var(--bg-card);
  backdrop-filter: blur(var(--blur-amount));
  -webkit-backdrop-filter: blur(var(--blur-amount));
  border: 1px solid var(--border-color);
  border-radius: 6px;
  font-family: 'Orbitron', monospace;
  pointer-events: auto; /* Re-enable for interactive content */
}

.fps-display-container {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  padding-bottom: 6px;
  border-bottom: 1px solid var(--border-color);
  position: relative;
}

.fps-display {
  font-size: 12px;
  color: var(--primary-red);
  letter-spacing: 1px;
  text-align: center;
  cursor: default;
}

/* Low FPS warning container - no animation inheritance */
.fps-warning {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  position: relative;
  cursor: help;
}

/* The flashing exclamation mark */
.fps-warning-icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 18px;
  height: 18px;
  background: var(--primary-red);
  color: #000;
  font-weight: bold;
  font-size: 14px;
  border-radius: 50%;
  animation: fps-warning-flash 0.8s ease-in-out infinite;
}

@keyframes fps-warning-flash {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.5; transform: scale(0.9); }
}

/* Tooltip styles - no animation inheritance */
.fps-warning-tooltip {
  position: absolute;
  top: calc(100% + 10px);
  right: -10px;
  width: 220px;
  padding: 10px 12px;
  background: rgba(20, 20, 25, 0.95);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  border: 1px solid var(--primary-red);
  border-radius: 8px;
  font-size: 11px;
  font-weight: normal;
  color: var(--text-primary);
  line-height: 1.4;
  z-index: 1000;
  pointer-events: none;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
}

/* Speech bubble arrow */
.fps-warning-tooltip::before {
  content: '';
  position: absolute;
  top: -6px;
  right: 14px;
  width: 10px;
  height: 10px;
  background: rgba(20, 20, 25, 0.95);
  border-left: 1px solid var(--primary-red);
  border-top: 1px solid var(--primary-red);
  transform: rotate(45deg);
}

/* Auto-show tooltip (shown once) */
.fps-warning-tooltip-auto {
  animation: fps-tooltip-fade 5s ease-in-out forwards;
}

@keyframes fps-tooltip-fade {
  0% { opacity: 0; transform: translateY(-5px); }
  10% { opacity: 1; transform: translateY(0); }
  80% { opacity: 1; }
  100% { opacity: 0; }
}

/* Hover tooltip (hidden by default, shown on hover) */
.fps-warning-tooltip-hover {
  opacity: 0;
  transition: opacity 0.2s ease;
}

.fps-warning:hover .fps-warning-tooltip-hover {
  opacity: 1;
}

.lod-section {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.lod-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}

.lod-title {
  font-size: 10px;
  color: var(--text-secondary);
  letter-spacing: 1px;
}

.lod-auto-toggle {
  display: flex;
  align-items: center;
  gap: 4px;
  cursor: pointer;
}

.lod-auto-toggle input[type="checkbox"] {
  appearance: none;
  -webkit-appearance: none;
  width: 12px;
  height: 12px;
  margin: 0;
  background: rgba(0, 20, 25, 0.6);
  border: 1px solid rgba(192, 32, 35, 0.3);
  border-radius: 2px;
  cursor: pointer;
  position: relative;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
}

.lod-auto-toggle input[type="checkbox"]:hover {
  border-color: rgba(192, 32, 35, 0.6);
}

.lod-auto-toggle input[type="checkbox"]:checked {
  background: rgba(192, 32, 35, 0.2);
  border-color: var(--primary-red);
}

.lod-auto-toggle input[type="checkbox"]:checked::after {
  content: '';
  position: absolute;
  left: 3px;
  top: 0px;
  width: 3px;
  height: 7px;
  border: solid var(--primary-red);
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}

.lod-auto-label {
  font-size: 9px;
  color: var(--text-secondary);
  letter-spacing: 0.5px;
}

.lod-buttons {
  display: flex;
  gap: 4px;
}

.lod-btn {
  flex: 1;
  padding: 4px 8px;
  background: transparent;
  border: 1px solid var(--border-color);
  border-radius: 3px;
  color: var(--text-secondary);
  font-family: 'Orbitron', monospace;
  font-size: 10px;
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
}

.lod-btn:hover:not(:disabled) {
  border-color: var(--primary-red);
  color: var(--primary-red);
}

.lod-btn.active {
  background: var(--primary-red);
  border-color: var(--primary-red);
  color: white;
}

.lod-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Options Section */
.options-section {
  margin-top: 4px;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.option-toggle {
  display: flex;
  align-items: center;
  gap: 6px;
  cursor: pointer;
  font-size: 11px;
  color: var(--text-secondary);
  transition: color 0.2s ease;
}

.option-toggle:hover {
  color: var(--text-primary);
}

.option-toggle input[type="checkbox"] {
  appearance: none;
  -webkit-appearance: none;
  width: 12px;
  height: 12px;
  margin: 0;
  background: rgba(0, 20, 25, 0.6);
  border: 1px solid rgba(192, 32, 35, 0.3);
  border-radius: 2px;
  cursor: pointer;
  position: relative;
  transition: background 0.2s ease, border-color 0.2s ease;
  flex-shrink: 0;
}

.option-toggle input[type="checkbox"]:hover {
  border-color: rgba(192, 32, 35, 0.6);
}

.option-toggle input[type="checkbox"]:checked {
  background: rgba(192, 32, 35, 0.2);
  border-color: var(--primary-red);
}

.option-toggle input[type="checkbox"]:checked::after {
  content: '';
  position: absolute;
  left: 3px;
  top: 0px;
  width: 3px;
  height: 7px;
  border: solid var(--primary-red);
  border-width: 0 1.5px 1.5px 0;
  transform: rotate(45deg);
}

.option-toggle span {
  user-select: none;
}

/* Settings Divider */
.settings-divider {
  height: 1px;
  background: rgba(192, 32, 35, 0.2);
  margin: 6px 0;
}

/* Settings Slider Row */
.setting-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  font-size: 10px;
  color: var(--text-secondary);
}

.setting-label {
  white-space: nowrap;
}

.setting-slider {
  width: 60px;
  height: 4px;
  -webkit-appearance: none;
  appearance: none;
  background: rgba(192, 32, 35, 0.2);
  border-radius: 2px;
  cursor: pointer;
}

.setting-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 10px;
  height: 10px;
  background: var(--primary-red);
  border-radius: 50%;
  cursor: pointer;
}

.setting-slider::-moz-range-thumb {
  width: 10px;
  height: 10px;
  background: var(--primary-red);
  border-radius: 50%;
  cursor: pointer;
  border: none;
}

/* HUD Control Buttons */
.hud-buttons {
  display: flex;
  gap: 6px;
  margin-top: 6px;
}

.hud-btn {
  flex: 1;
  padding: 6px;
  background: rgba(0, 20, 25, 0.6);
  border: 1px solid rgba(192, 32, 35, 0.3);
  border-radius: 4px;
  color: var(--text-secondary);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}

.hud-btn:hover:not(.disabled) {
  border-color: var(--primary-red);
  color: var(--text-primary);
}

.hud-btn.disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.hud-btn svg {
  width: 14px;
  height: 14px;
}

/* Screenshot Mode Overlay - matches hud-buttons style */
.screenshot-mode-buttons {
  position: fixed;
  bottom: 20px;
  right: 20px;
  display: flex;
  gap: 6px;
  z-index: 100;
}

.screenshot-mode-btn {
  padding: 8px;
  background: rgba(0, 20, 25, 0.6);
  border: 1px solid rgba(192, 32, 35, 0.3);
  border-radius: 4px;
  color: var(--text-secondary);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}

.screenshot-mode-btn:hover {
  border-color: var(--primary-red);
  color: var(--text-primary);
}

.screenshot-mode-btn svg {
  width: 16px;
  height: 16px;
}

/* Globe Wrapper */
.globe-wrapper {
  width: 100%;
  height: 100%;
  position: relative;
}

/* HUD Scale - Applied globally via --hud-scale on :root */
/* Scale all glass panels and HUD elements */
.filter-panel,
.info-panel-top-right,
.layer-toggle-panel,
.historical-borders-panel,
.zoom-slider-top,
.scale-bar,
.cursor-coords,
.social-contribute-wrapper,
.site-hover-tooltip {
  transform: scale(var(--hud-scale, 1));
  transition: opacity 0.2s ease, transform 0.15s ease;
}

/* Transform origins based on element position */
.filter-panel {
  transform-origin: top left;
}

.info-panel-top-right,
.social-contribute-wrapper {
  transform-origin: top right;
}

.zoom-slider-top {
  transform-origin: bottom right;
}

.layer-toggle-panel,
.historical-borders-panel {
  transform-origin: bottom right;
}

.scale-bar,
.cursor-coords {
  transform-origin: center center;
}

.site-hover-tooltip {
  transform-origin: top left;
  /* Override HUD transition - animation handles appearance, scale should be instant */
  transition: border-color 0.15s ease, box-shadow 0.15s ease;
}

/* Hide all HUD elements when hidden (except tooltips) */
body.hud-hidden .filter-panel,
body.hud-hidden .info-panel-top-right,
body.hud-hidden .layer-toggle-panel,
body.hud-hidden .historical-borders-panel,
body.hud-hidden .zoom-slider-top,
body.hud-hidden .scale-bar,
body.hud-hidden .cursor-coords,
body.hud-hidden .social-contribute-wrapper,
body.hud-hidden .contribute-picker-hint {
  opacity: 0;
  pointer-events: none;
}

/* Screenshot mode - force tooltip to be fully opaque and solid */
body.screenshot-mode .site-hover-tooltip {
  opacity: 1 !important;
  background: rgba(10, 25, 35, 0.95) !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  animation: none !important;
  transition: none !important;
}

/* Hide screenshot buttons during actual screenshot capture */
body.screenshot-mode .screenshot-mode-buttons {
  display: none !important;
}

/* Rotation Toggle Button */
.rotation-toggle {
  position: absolute;
  bottom: 120px;
  right: 10px;
  z-index: 100;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--bg-card);
  backdrop-filter: blur(var(--blur-amount));
  -webkit-backdrop-filter: blur(var(--blur-amount));
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: var(--primary-red);
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
}

.rotation-toggle:hover {
  border-color: var(--primary-red);
}

/* Site Popup */
.site-popup-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  padding: 20px;
}

.site-popup {
  background: var(--bg-card-solid);
  backdrop-filter: blur(var(--blur-amount));
  -webkit-backdrop-filter: blur(var(--blur-amount));
  border: 1px solid var(--border-color);
  border-radius: 8px;
  max-width: 700px;
  width: 100%;
  max-height: 80vh;
  overflow: hidden;
  position: relative;
  padding: 0;
  display: flex;
  flex-direction: column;
  /* Prevent sub-pixel jitter from external reflows */
  backface-visibility: hidden;
}

/* ============= MINIMIZED POPUP BAR ============= */

.popup-minimized-bar {
  height: 32px;
  width: 100%;
  background: rgba(0, 15, 20, 0.95);
  border: 1px solid var(--border-color);
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 0 6px 0 10px;
  border-radius: 4px;
  cursor: pointer;
  user-select: none;
  transition: background 0.15s ease, border-color 0.15s ease;
}

.popup-minimized-bar:hover {
  background: rgba(0, 20, 25, 0.98);
  border-color: var(--primary-red);
}

.popup-minimized-bar:hover .popup-minimized-icon {
  color: var(--primary-red);
}

.popup-minimized-bar:hover .popup-minimized-title {
  color: var(--text-primary);
}

.popup-minimized-icon {
  flex-shrink: 0;
  color: var(--text-muted);
  transition: color 0.15s ease;
}

.popup-minimized-title {
  flex: 1;
  font-size: 12px;
  font-weight: 500;
  color: var(--text-secondary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  transition: color 0.15s ease;
}

.popup-minimized-btn {
  width: 22px;
  height: 22px;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  border: none;
  background: transparent;
  color: var(--text-muted);
  cursor: pointer;
  border-radius: 3px;
  transition: background 0.15s ease, color 0.15s ease;
}

.popup-minimized-btn:hover {
  background: rgba(255, 255, 255, 0.1);
  color: var(--text-primary);
}

.popup-minimized-btn.close-btn:hover {
  background: #e81123;
  color: white;
}

/* ============= END MINIMIZED POPUP BAR ============= */

/* Window controls in map buttons bar */
.map-action-btn.window-ctrl {
  background: rgba(0, 20, 25, 0.9);
}

.map-action-btn.close-btn:hover {
  background: #e81123 !important;
  border-color: #e81123 !important;
  color: white !important;
}

.map-buttons-separator {
  width: 1px;
  height: 20px;
  background: rgba(255, 255, 255, 0.2);
  margin: 0 4px;
}

/* Legacy header buttons - keep for backwards compatibility */
.popup-header-buttons {
  display: none;
}

.popup-open-tab,
.popup-share,
.popup-close {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 20, 25, 0.7);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: white;
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
  text-decoration: none;
}

.popup-open-tab:hover,
.popup-share:hover,
.popup-close:hover {
  border-color: var(--primary-red);
  color: var(--primary-red);
}

.site-popup .popup-image-container {
  position: relative;
  width: 100%;
  margin: 0;
  padding: 0;
  overflow: hidden;
  border-radius: 0;
  line-height: 0;
  flex-shrink: 0;
}

.site-popup .popup-image {
  width: 100%;
  height: 200px;
  margin: 0 !important;
  padding: 0;
  object-fit: cover;
  display: block;
  border-radius: 0;
}

.site-popup .popup-image-attribution {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 20px 12px 8px 12px;
  background: linear-gradient(transparent, rgba(0,0,0,0.95));
  font-size: 11px;
  color: #888;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 8px;
}

.site-popup .popup-image-attribution a {
  color: var(--primary-red);
  text-decoration: none;
}

.site-popup .popup-image-attribution a:hover {
  text-decoration: underline;
}

.popup-main-layout {
  display: flex;
  flex: 1;
  min-height: 0;
  overflow: hidden;
}

.popup-content-side {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow-y: auto;
  overflow-x: hidden;
}

.popup-body {
  padding: 20px;
  padding-top: 8px;
  flex: 1;
  display: flex;
  flex-direction: column;
  position: relative;
  z-index: 2;
  background: rgb(0, 15, 20);
  /* Prevent layout shifts from affecting parent */
  transform: translateZ(0);
}

/* Right side maps container */
.popup-maps-side {
  flex: 0 0 50%;
  display: flex;
  flex-direction: column;
  min-height: 400px;
  overflow: hidden;
}

/* Large popup variant - 90% screen height, 4:3 aspect ratio */
.site-popup.site-popup-large {
  height: min(90vh, 900px);
  width: min(calc(90vh * 4 / 3), 1200px);
  max-width: 95vw;
  max-height: 90vh;
  /* Snap to pixel grid during resize */
  transform: translate3d(0, 0, 0);
  contain: strict;
  backface-visibility: hidden;
  image-rendering: -webkit-optimize-contrast;
}

/* ============= WINDOW MANAGEMENT STYLES ============= */

/* Windowed mode (not standalone) */
.site-popup.windowed {
  position: fixed;
  margin: 0;
  contain: layout style;
  display: flex;
  flex-direction: column;
  z-index: 150; /* Above empire borders window (100) but below modals (1000+) */
}

/* Dragging state */
.site-popup.dragging,
.site-popup.resizing {
  user-select: none;
}

.site-popup.dragging .popup-main-layout,
.site-popup.dragging .popup-gallery-section {
  pointer-events: none;
}

/* Resize handles */
.resize-handle {
  position: absolute;
  z-index: 250;
  background: transparent;
}

.resize-handle.resize-n,
.resize-handle.resize-s {
  height: 10px;
  left: 16px;
  right: 16px;
  cursor: ns-resize;
}

.resize-handle.resize-e,
.resize-handle.resize-w {
  width: 10px;
  top: 16px;
  bottom: 16px;
  cursor: ew-resize;
}

.resize-handle.resize-n { top: -4px; }
.resize-handle.resize-s { bottom: -4px; }
.resize-handle.resize-e { right: -4px; }
.resize-handle.resize-w { left: -4px; }

.resize-handle.resize-ne,
.resize-handle.resize-nw,
.resize-handle.resize-se,
.resize-handle.resize-sw {
  width: 18px;
  height: 18px;
}

.resize-handle.resize-ne { top: -4px; right: -4px; cursor: nesw-resize; }
.resize-handle.resize-nw { top: -4px; left: -4px; cursor: nwse-resize; }
.resize-handle.resize-se { bottom: -4px; right: -4px; cursor: nwse-resize; }
.resize-handle.resize-sw { bottom: -4px; left: -4px; cursor: nesw-resize; }

/* Window controls - fixed at top right corner */
.popup-window-controls {
  position: absolute;
  top: 8px;
  right: 8px;
  display: flex;
  gap: 4px;
  z-index: 200;
}

.popup-window-btn {
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 20, 25, 0.85);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 6px;
  color: #888;
  cursor: pointer;
  transition: background 0.15s ease, color 0.15s ease, border-color 0.15s ease;
  backdrop-filter: blur(8px);
}

.popup-window-btn:hover {
  background: rgba(255, 255, 255, 0.15);
  color: #ccc;
  border-color: rgba(255, 255, 255, 0.2);
}

.popup-window-btn.close-btn:hover {
  background: #e81123;
  color: white;
  border-color: #e81123;
}

/* Standalone mode close button - same style as main popup */
.popup-standalone-close {
  position: fixed;
  top: 8px;
  right: 8px;
  z-index: 1000;
}

/* Maximized state */
.site-popup.maximized {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  width: 100vw !important;
  height: 100vh !important;
  max-width: 100vw !important;
  max-height: 100vh !important;
  border-radius: 0 !important;
}

/* Dimmed/unfocused state - popup becomes semi-transparent */
.site-popup.dimmed {
  opacity: 0.5;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  transition: opacity 0.2s ease, box-shadow 0.2s ease;
}

.site-popup.dimmed:hover {
  opacity: 0.7;
}

.site-popup:not(.dimmed) {
  transition: opacity 0.2s ease, box-shadow 0.2s ease;
}

/* Passthrough overlay - clicks go through to globe */
.site-popup-overlay.passthrough {
  background: transparent;
  pointer-events: none;
}

.site-popup-overlay.passthrough .site-popup {
  pointer-events: auto;
}

/* Minimized state */
.site-popup.minimized {
  width: 280px !important;
  min-width: 280px !important;
  max-width: 280px !important;
  height: 32px !important;
  min-height: 32px !important;
  max-height: 32px !important;
  overflow: hidden;
  background: transparent !important;
  border: none !important;
  box-shadow: none !important;
  border-radius: 4px !important;
}

.site-popup.minimized .popup-main-layout,
.site-popup.minimized .popup-gallery-section {
  display: none !important;
}

/* ============= END WINDOW MANAGEMENT STYLES ============= */

/* Map section common styles */
.map-section {
  display: flex;
  flex-direction: column;
  flex: 1;
  min-height: 0;
  position: relative;
}

/* Action buttons bar at bottom of Google Maps */
.map-buttons-bar {
  position: absolute;
  bottom: 8px;
  right: 8px;
  display: flex;
  gap: 6px;
  z-index: 10;
}

.map-action-btn {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 20, 25, 0.85);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: white;
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
  text-decoration: none;
}

.map-action-btn:hover {
  border-color: var(--primary-red);
  color: var(--primary-red);
  background: rgba(0, 25, 30, 0.95);
}

/* Street View toggle button - Pegman style */
.street-view-toggle {
  background: linear-gradient(135deg, #f4b400, #ea8600);
  border-color: rgba(234, 134, 0, 0.5);
  color: white;
}

.street-view-toggle:hover {
  background: linear-gradient(135deg, #ffca28, #f4b400);
  border-color: #f4b400;
  color: white;
}

.street-view-toggle.active {
  background: linear-gradient(135deg, #4285f4, #1a73e8);
  border-color: rgba(26, 115, 232, 0.5);
  color: white;
}

.street-view-toggle.active:hover {
  background: linear-gradient(135deg, #5a95f5, #4285f4);
  border-color: #4285f4;
  color: white;
}

.street-view-toggle svg {
  filter: drop-shadow(0 1px 1px rgba(0, 0, 0, 0.2));
}

/* Fullscreen toggle button */
.fullscreen-toggle {
  background: rgba(0, 20, 25, 0.85);
}

.fullscreen-toggle.active {
  background: linear-gradient(135deg, #10b981, #059669);
  border-color: rgba(5, 150, 105, 0.5);
  color: white;
}

.fullscreen-toggle.active:hover {
  background: linear-gradient(135deg, #34d399, #10b981);
  border-color: #10b981;
}

/* Map section native fullscreen mode */
.google-map-section:fullscreen,
.google-map-section.fullscreen {
  width: 100vw !important;
  height: 100vh !important;
  background: #000;
  border-radius: 0 !important;
  border: none !important;
}

.google-map-section:fullscreen .google-map-container,
.google-map-section.fullscreen .google-map-container {
  border-radius: 0;
  position: absolute;
  inset: 0;
}

.google-map-section:fullscreen .google-map-container iframe,
.google-map-section.fullscreen .google-map-container iframe {
  width: 100% !important;
  height: 100% !important;
  transform: none !important;
  top: 0 !important;
  left: 0 !important;
  position: absolute !important;
}

.google-map-section:fullscreen .map-buttons-bar,
.google-map-section.fullscreen .map-buttons-bar {
  bottom: 24px;
  right: 24px;
  z-index: 100;
}

.google-map-section:fullscreen .map-loading,
.google-map-section:fullscreen .map-no-data,
.google-map-section.fullscreen .map-loading,
.google-map-section.fullscreen .map-no-data {
  border-radius: 0;
}

/* Hide the dark overlay in fullscreen */
.google-map-section:fullscreen .google-map-container::after,
.google-map-section.fullscreen .google-map-container::after {
  display: none;
}

/* Google Maps section */
.google-map-section {
  border-bottom: 1px solid var(--border-color);
  flex: 1;
  position: relative;
  min-height: 200px;
}


.google-map-container {
  position: absolute;
  inset: 0;
  overflow: hidden;
}

/* Dark haze overlay - fades on hover */
.google-map-container::after {
  content: '';
  position: absolute;
  inset: 0;
  background: rgba(0, 15, 20, 0.30);
  pointer-events: none;
  z-index: 1;
  transition: opacity 0.3s ease;
}

.google-map-container:hover::after {
  opacity: 0;
}

/* Scale iframe larger and center to crop out UI controls */
.google-map-container iframe {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 140%;
  height: 140%;
  transform: translate(-50%, -50%);
  border: none;
}

/* Map loading spinner */
.map-loading {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #000000;
  z-index: 20;
}

.map-no-data {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #0a1a1f 0%, #0d2329 100%);
  gap: 12px;
  color: rgba(255, 255, 255, 0.5);
  font-size: 14px;
}

.map-loading-spinner {
  width: 32px;
  height: 32px;
  border: 2px solid rgba(255, 255, 255, 0.1);
  border-top-color: var(--primary-red);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

/* Hero Header - At top of left content section with vignette */
.popup-hero-header {
  position: relative;
  width: 100%;
  height: 150px;
  overflow: hidden;
  background: rgb(0, 15, 20);
  flex-shrink: 0;
  z-index: 1;
}

.popup-hero-bg {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  object-position: center;
  animation: heroFadeIn 1s ease-out;
}

@keyframes heroFadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* Color tint overlay matching UI background */
.popup-hero-header::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 15, 20, 0.35);
  z-index: 1;
  pointer-events: none;
}

.popup-hero-vignette {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 100px;
  background: linear-gradient(
    to bottom,
    rgba(0, 15, 20, 0) 0%,
    rgba(0, 15, 20, 0.3) 30%,
    rgba(0, 15, 20, 0.7) 60%,
    rgb(0, 15, 20) 100%
  );
  z-index: 3;
  pointer-events: none;
}

.popup-hero-content {
  position: absolute;
  bottom: -24px;
  left: 0;
  right: 0;
  padding: 16px 20px;
  z-index: 4;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

/* Source and badges inside hero */
.popup-hero-content .popup-source {
  align-self: flex-start;
  background: rgba(0, 15, 20, 0.7);
  backdrop-filter: blur(4px);
  margin-bottom: 0;
}

.popup-hero-content .popup-badges {
  margin-bottom: 4px;
}

.popup-hero-content .popup-badge {
  background: rgba(0, 15, 20, 0.7);
  backdrop-filter: blur(4px);
}

.popup-title-row {
  display: flex;
  align-items: baseline;
  gap: 6px;
  margin-bottom: 8px;
}

.popup-title-overlay {
  font-family: 'Orbitron', sans-serif;
  font-size: 26px;
  font-weight: 700;
  color: #ffffff;
  text-shadow:
    -1px -1px 0 #000,
    1px -1px 0 #000,
    -1px 1px 0 #000,
    1px 1px 0 #000,
    0 0 8px rgba(0, 0, 0, 0.8);
  letter-spacing: 1px;
  margin: 0;
  line-height: 1.2;
}

.title-action-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 2px;
  background: none;
  border: none;
  color: #ffffff;
  cursor: pointer;
  opacity: 0.5;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
  text-shadow:
    -1px -1px 0 #000,
    1px -1px 0 #000,
    -1px 1px 0 #000,
    1px 1px 0 #000;
}

.title-action-btn:hover {
  opacity: 1;
  color: var(--primary-red);
}

.title-action-btn.copied,
.site-popup .popup-title-row .title-action-btn.copied {
  opacity: 1;
  color: #22c55e;
}

.title-action-btn.copied svg,
.site-popup .popup-title-row .title-action-btn.copied svg {
  stroke: #22c55e;
}

.popup-hero-credit {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-top: 6px;
  font-size: 10px;
  color: rgba(255, 255, 255, 0.7);
}

.popup-hero-credit a {
  color: #888888;
  text-decoration: none;
}

.popup-hero-credit a:hover {
  color: #aaaaaa;
  text-decoration: underline;
}

.site-popup .popup-title {
  font-family: 'Orbitron', sans-serif;
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 12px;
  color: var(--text-primary);
  letter-spacing: 1px;
}

.site-popup .popup-location {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 13px;
  color: var(--text-secondary);
  margin-bottom: 8px;
  flex-shrink: 0;
}

.site-popup .popup-location .country-flag {
  height: 15px;
  width: auto;
  vertical-align: middle;
  flex-shrink: 0;
  border-radius: 1px;
}

.site-popup .popup-coordinates {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 13px;
  color: var(--text-secondary);
  margin-bottom: 8px;
  flex-shrink: 0;
}

.site-popup .popup-coordinates .coords-actions {
  display: flex;
  gap: 2px;
  margin-left: 6px;
}

.site-popup .popup-coordinates .coords-action-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 2px;
  background: none;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  opacity: 0.5;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
}

.site-popup .popup-coordinates .coords-action-btn:hover {
  opacity: 1;
  color: var(--primary-red);
}

.site-popup .popup-coordinates .coords-action-btn.copied {
  opacity: 1;
  color: #22c55e;
}

.site-popup .popup-badges {
  display: flex;
  gap: 8px;
  margin-bottom: 12px;
  flex-wrap: wrap;
  flex-shrink: 0;
  /* Prevent sub-pixel jitter */
  transform: translateZ(0);
}

.popup-badge {
  padding: 4px 10px;
  border-radius: 4px;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  background: transparent;
  border: 1px solid;
  /* Prevent sub-pixel jitter */
  transform: translateZ(0);
}

.site-popup .popup-description {
  font-size: 13px;
  line-height: 1.6;
  color: var(--text-secondary);
  flex: 1 1 0;
  min-height: 0;
  max-height: none;
  overflow-y: auto;
  margin-bottom: 12px;
}

.site-popup .popup-link {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 10px 16px;
  background: transparent;
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: var(--primary-red);
  font-size: 13px;
  text-decoration: none;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
}

.site-popup .popup-link:hover {
  border-color: var(--primary-red);
}

/* Toggle Button */
.toggle-filters-btn {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 16px;
  background: var(--bg-card);
  backdrop-filter: blur(var(--blur-amount));
  -webkit-backdrop-filter: blur(var(--blur-amount));
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: var(--primary-red);
  font-size: 13px;
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
}

.toggle-filters-btn:hover {
  border-color: var(--primary-red);
}

/* Site Count */
.site-count {
  font-size: 12px;
  color: var(--text-secondary);
  padding: 8px 12px;
  background: var(--bg-inner);
  border-radius: 6px;
  text-align: center;
  flex-shrink: 0;
  width: 280px;
  box-sizing: border-box;
}

.site-count span {
  color: var(--primary-red);
  font-weight: 600;
}

/* Animated Counter - GPU accelerated, minimal repaints */
.animated-counter {
  color: var(--primary-red);
  font-weight: 600;
  font-family: 'Orbitron', monospace;
  letter-spacing: 0.5px;
}

/* Loading state - pulse animation */
.animated-counter.loading {
  animation: counter-pulse 1.5s ease-in-out infinite;
}

@keyframes counter-pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

/* Loading dots animation */
.animated-counter .loading-dots {
  display: inline-block;
  margin-left: 2px;
}

.animated-counter .loading-dots span {
  animation: dot-bounce 1.4s ease-in-out infinite;
  display: inline-block;
}

.animated-counter .loading-dots span:nth-child(1) { animation-delay: 0s; }
.animated-counter .loading-dots span:nth-child(2) { animation-delay: 0.2s; }
.animated-counter .loading-dots span:nth-child(3) { animation-delay: 0.4s; }

@keyframes dot-bounce {
  0%, 60%, 100% { opacity: 0.3; }
  30% { opacity: 1; }
}

/* Popup Content */
.popup-content {
  padding: 16px;
}

.popup-image {
  width: calc(100% + 32px);
  margin: -16px -16px 16px -16px;
  height: 140px;
  object-fit: cover;
}

.popup-title {
  font-family: 'Orbitron', sans-serif;
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 8px;
  color: var(--text-primary);
  letter-spacing: 1px;
}

.popup-location {
  font-size: 12px;
  color: var(--text-secondary);
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.popup-badges {
  display: flex;
  gap: 8px;
  margin-bottom: 12px;
  flex-wrap: wrap;
}

.badge {
  padding: 4px 10px;
  border-radius: 4px;
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.badge-category {
  background: transparent;
  border: 1px solid var(--border-color);
  color: var(--text-secondary);
}

.badge-period {
  background: transparent;
  border: 1px solid var(--border-color);
  color: var(--text-secondary);
}

.popup-description {
  font-size: 13px;
  line-height: 1.5;
  color: var(--text-secondary);
  max-height: 100px;
  overflow-y: auto;
}

.popup-description.loading {
  font-style: italic;
  color: rgba(136, 136, 136, 0.7);
}

.popup-description.empty {
  font-style: italic;
  color: rgba(136, 136, 136, 0.5);
}

.popup-description::-webkit-scrollbar {
  width: 4px;
}

.popup-description::-webkit-scrollbar-track {
  background: rgba(192, 32, 35, 0.1);
  border-radius: 2px;
}

.popup-description::-webkit-scrollbar-thumb {
  background: var(--primary-red);
  border-radius: 2px;
}

/* Site Metadata - source-specific fields (earthquakes, volcanoes, etc.) */
.site-metadata {
  margin: 12px 0;
  padding: 12px;
  background: rgba(0, 0, 0, 0.2);
  border-radius: 8px;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.site-metadata-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 8px 16px;
}

.site-metadata-field {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.site-metadata-label {
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: rgba(255, 255, 255, 0.5);
}

.site-metadata-value {
  font-size: 13px;
  color: rgba(255, 255, 255, 0.9);
  font-weight: 500;
}

/* Single column on narrow containers */
@media (max-width: 400px) {
  .site-metadata-grid {
    grid-template-columns: 1fr;
  }
}

.popup-link {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  margin-top: 12px;
  padding: 8px 12px;
  background: transparent;
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: var(--primary-red);
  font-size: 12px;
  text-decoration: none;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
}

.popup-link:hover {
  border-color: var(--primary-red);
}

/* Loading State */
.loading-overlay {
  position: absolute;
  inset: 0;
  background: var(--bg-dark);
  z-index: 1000;
  opacity: 1;
  transition: opacity 0.8s ease-out;
}

.loading-overlay.fading {
  opacity: 0;
}

.loading-spinner-container {
  /* Position at exact viewport center */
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  /* Match globe at warp start scale (0.3) */
  width: calc(80vh * 0.33);
  height: calc(80vh * 0.33);
  display: flex;
  align-items: center;
  justify-content: center;
}

.loading-spinner {
  position: absolute;
  width: 100%;
  height: 100%;
  border: 3px solid rgba(192, 32, 35, 0.2);
  border-top-color: var(--primary-red);
  border-radius: 50%;
  /* Start invisible, fade in after logo is shown */
  /* Spin at 2s to match globe-ring-spin for seamless transition */
  opacity: 0;
  animation: spin 2s linear infinite, loading-fade-in 0.5s ease-out 0.3s forwards;
}

.loading-logo {
  /* Match globe logo size: logo is 60% of globe, ring is 10% bigger than globe
     So logo = 60% / 1.1 = 54.5% of ring/spinner */
  width: 54.5%;
  height: 54.5%;
  object-fit: contain;
  z-index: 1;
  filter: drop-shadow(0 0 8px rgba(192, 32, 35, 0.7));
  /* Shrink from 140% to 100% over 5s loading time */
  animation: logo-shrink 5s ease-out forwards, logo-glow 2s ease-in-out infinite;
}

@keyframes logo-shrink {
  0% {
    transform: scale(1.4);
  }
  100% {
    transform: scale(1);
  }
}

@keyframes logo-glow {
  0%, 100% {
    filter: drop-shadow(0 0 4px rgba(192, 32, 35, 0.5));
  }
  50% {
    filter: drop-shadow(0 0 16px rgba(192, 32, 35, 0.9));
  }
}

.loading-text {
  /* Position below the centered spinner (80vh * 0.33 / 2 = radius from center) */
  position: fixed;
  top: calc(50% + 80vh * 0.33 / 2 + 24px);
  left: 50%;
  transform: translateX(-50%);
  font-family: 'Orbitron', sans-serif;
  color: var(--primary-red);
  font-size: 14px;
  letter-spacing: 2px;
  /* Fade in after spinner */
  opacity: 0;
  animation: loading-fade-in 0.5s ease-out 0.5s forwards;
}

.loading-speed {
  /* Position below loading text */
  position: fixed;
  top: calc(50% + 80vh * 0.33 / 2 + 54px);
  left: 50%;
  transform: translateX(-50%);
  font-family: 'Orbitron', sans-serif;
  color: #00ff88;
  font-size: 13px;
  letter-spacing: 1px;
  text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
  display: flex;
  gap: 16px;
  justify-content: center;
  align-items: center;
  /* Fade in after text */
  opacity: 0;
  animation: loading-fade-in 0.5s ease-out 0.7s forwards;
}

.loading-speed .loading-total {
  color: #888;
  font-size: 12px;
  text-shadow: none;
}

.loading-hint {
  /* Position below loading speed */
  position: fixed;
  top: calc(50% + 80vh * 0.33 / 2 + 84px);
  left: 50%;
  transform: translateX(-50%);
  font-family: 'Inter', sans-serif;
  color: var(--text-secondary);
  font-size: 11px;
  letter-spacing: 0.5px;
  /* Fade in last */
  opacity: 0;
  animation: loading-fade-in 0.5s ease-out 0.9s forwards;
}

/* Fade in animation for loading screen elements */
@keyframes loading-fade-in {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* Hint should only reach 70% opacity */
.loading-hint {
  animation: loading-fade-in-hint 0.5s ease-out 0.9s forwards;
}

@keyframes loading-fade-in-hint {
  from { opacity: 0; }
  to { opacity: 0.7; }
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Loading Cursor Overlay - for site detail loading */
.loading-cursor-overlay {
  position: fixed;
  inset: 0;
  z-index: 500;
  cursor: wait;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 15, 20, 0.4);
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
}

.loading-cursor-spinner {
  width: 40px;
  height: 40px;
  border: 2px solid rgba(192, 32, 35, 0.2);
  border-top-color: var(--primary-red);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

/* Vertical Zoom Slider - bottom right, top at screen center */
.zoom-slider-top {
  position: fixed;
  top: 50%;
  bottom: 20px;
  right: 20px;
  z-index: 100;
  transition: right 0.25s ease-out;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  padding: 12px 10px;
  background: var(--bg-card);
  backdrop-filter: blur(var(--blur-amount));
  -webkit-backdrop-filter: blur(var(--blur-amount));
  border: 1px solid var(--border-color);
  border-radius: 6px;
}

.zoom-percent-display {
  font-size: 11px;
  font-weight: 600;
  color: var(--primary-red);
  background: rgba(192, 32, 35, 0.1);
  padding: 2px 6px;
  border-radius: 3px;
  width: 38px;
  text-align: center;
  font-variant-numeric: tabular-nums;
  white-space: nowrap;
}

.zoom-btn {
  width: 28px;
  height: 28px;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: 1px solid var(--border-color);
  border-radius: 3px;
  color: var(--primary-red);
  font-size: 18px;
  font-weight: bold;
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
}

.zoom-btn:hover {
  background: rgba(192, 32, 35, 0.15);
  border-color: var(--primary-red);
}

.zoom-range-vertical {
  writing-mode: vertical-lr;
  direction: rtl;
  width: 8px;
  height: 100%;
  -webkit-appearance: none;
  appearance: none;
  background: linear-gradient(
    to bottom,
    rgba(76, 175, 80, 0.4) 0%,
    rgba(76, 175, 80, 0.4) 34%,
    rgba(192, 32, 35, 0.4) 34%,
    rgba(192, 32, 35, 0.4) 100%
  );
  border-radius: 3px;
  outline: none;
  cursor: pointer;
  position: relative;
  z-index: 2;
}

.zoom-range-vertical::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 16px;
  height: 16px;
  background: #c02023;
  border: 1px solid #a01a1c;
  border-radius: 2px;
  cursor: pointer;
  position: relative;
  z-index: 10;
}

.zoom-range-vertical::-moz-range-thumb {
  width: 16px;
  height: 16px;
  background: #c02023;
  border: 1px solid #a01a1c;
  border-radius: 2px;
  cursor: pointer;
  position: relative;
  z-index: 10;
}

.zoom-slider-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  gap: 2px;
  flex: 1;
  min-height: 0;
}

.zoom-slider-labels {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  padding: 24px 0 56px 0;
}

.zoom-label {
  writing-mode: vertical-rl;
  text-orientation: mixed;
  transform: rotate(180deg);
  font-size: 9px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 1px;
  white-space: nowrap;
}

.zoom-label-map {
  color: rgba(76, 175, 80, 0.8);
}

.zoom-label-3d {
  color: rgba(192, 32, 35, 0.8);
}

.zoom-slider-container {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%;
}

.zoom-66-marker {
  position: absolute;
  left: -4px;
  right: -4px;
  top: 34%; /* 66% from bottom = 34% from top */
  height: 2px;
  background: #888888;
  pointer-events: none;
  z-index: 1;
  transition: all 0.15s ease-out;
}

/* Layer Toggle Panel */
.layer-toggle-panel {
  position: fixed;
  bottom: 20px;
  /* Scale gap with HUD: 20px base + (60px slider + 12px gap) * scale */
  right: calc(20px + 72px * var(--hud-scale, 1));
  z-index: 100;
  transition: right 0.25s ease-out;
  padding: 12px;
  background: var(--bg-card);
  backdrop-filter: blur(var(--blur-amount));
  -webkit-backdrop-filter: blur(var(--blur-amount));
  border: 1px solid var(--border-color);
  border-radius: 4px;
  min-width: 180px;
  width: 180px;
}

.panel-label {
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--primary-red);
  margin-bottom: 8px;
}

.panel-label-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 8px;
}

.panel-label-row .panel-label {
  margin-bottom: 0;
}

.panel-minimize-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 18px;
  height: 18px;
  padding: 0;
  background: rgba(0, 20, 25, 0.6);
  border: 1px solid rgba(192, 32, 35, 0.3);
  border-radius: 2px;
  color: var(--text-secondary);
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
}

.panel-minimize-btn:hover {
  color: var(--primary-red);
  border-color: var(--primary-red);
  background: rgba(192, 32, 35, 0.15);
}

.base-layer-section {
  margin-bottom: 12px;
  padding-bottom: 12px;
  border-bottom: 1px solid rgba(192, 32, 35, 0.2);
}

.lod-toggle {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
  cursor: pointer;
  padding: 6px 8px;
  border-radius: 2px;
  background: transparent;
  border: 1px solid rgba(192, 32, 35, 0.2);
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
}

.lod-toggle:hover {
  background: rgba(192, 32, 35, 0.1);
  border-color: rgba(192, 32, 35, 0.4);
}

.lod-toggle input[type="checkbox"] {
  appearance: none;
  -webkit-appearance: none;
  width: 14px;
  height: 14px;
  background: rgba(0, 20, 25, 0.6);
  border: 1px solid rgba(192, 32, 35, 0.3);
  border-radius: 2px;
  cursor: pointer;
  position: relative;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
}

.lod-toggle input[type="checkbox"]:hover {
  border-color: rgba(192, 32, 35, 0.6);
}

.lod-toggle input[type="checkbox"]:checked {
  background: rgba(192, 32, 35, 0.2);
  border-color: var(--primary-red);
}

.lod-toggle input[type="checkbox"]:checked::after {
  content: '';
  position: absolute;
  left: 4px;
  top: 1px;
  width: 4px;
  height: 8px;
  border: solid var(--primary-red);
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}

.lod-label {
  font-size: 11px;
  color: var(--text-secondary);
}

.lod-toggle input:checked + .lod-label {
  color: var(--primary-red);
}

.base-layer-buttons {
  display: flex;
  gap: 6px;
}

.base-btn:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.base-btn:disabled:hover {
  border-color: var(--border-color);
  color: var(--text-secondary);
}

.base-btn {
  flex: 1;
  padding: 8px 12px;
  background: transparent;
  border: 1px solid rgba(192, 32, 35, 0.2);
  border-radius: 2px;
  color: var(--text-secondary);
  font-size: 11px;
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
}

.base-btn:hover {
  border-color: rgba(192, 32, 35, 0.4);
  color: var(--text-primary);
}

.base-btn.active {
  background: rgba(192, 32, 35, 0.15);
  border-color: var(--primary-red);
  color: var(--primary-red);
}

.vector-layers-section {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.base-maps-section {
  margin-bottom: 8px;
  padding-bottom: 8px;
  border-bottom: 1px solid rgba(192, 32, 35, 0.15);
}

/* Label size slider */
.label-size-slider {
  margin: 2px 0 4px 22px;
  width: 100px;
}

.label-size-slider .size-slider {
  width: 100%;
  height: 3px;
  -webkit-appearance: none;
  appearance: none;
  background: rgba(136, 136, 153, 0.3);
  border-radius: 2px;
  outline: none;
  cursor: pointer;
}

.label-size-slider .size-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 8px;
  height: 8px;
  background: #888899;
  border-radius: 2px;
  cursor: pointer;
}

.label-size-slider .size-slider::-moz-range-thumb {
  width: 8px;
  height: 8px;
  background: #888899;
  border-radius: 2px;
  cursor: pointer;
  border: none;
}

.subsection-label {
  font-size: 9px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-secondary);
  margin-bottom: 4px;
  padding-left: 8px;
  opacity: 0.7;
}

.layer-toggle {
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  padding: 6px 8px;
  border-radius: 6px;
  transition: background 0.2s ease;
}

.layer-toggle:hover {
  background: rgba(192, 32, 35, 0.1);
}

.layer-toggle input[type="checkbox"] {
  appearance: none;
  -webkit-appearance: none;
  width: 14px;
  height: 14px;
  background: rgba(0, 20, 25, 0.6);
  border: 1px solid rgba(192, 32, 35, 0.3);
  border-radius: 2px;
  cursor: pointer;
  position: relative;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
  flex-shrink: 0;
}

.layer-toggle input[type="checkbox"]:hover {
  border-color: rgba(192, 32, 35, 0.6);
}

.layer-toggle input[type="checkbox"]:checked {
  background: rgba(192, 32, 35, 0.2);
  border-color: var(--primary-red);
}

.layer-toggle input[type="checkbox"]:checked::after {
  content: '';
  position: absolute;
  left: 4px;
  top: 1px;
  width: 4px;
  height: 8px;
  border: solid var(--primary-red);
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}

.layer-color-indicator {
  width: 10px;
  height: 10px;
  border-radius: 3px;
  flex-shrink: 0;
}

.layer-label {
  font-size: 11px;
  color: var(--text-secondary);
  flex: 1;
  white-space: nowrap;
}

.layer-toggle input:checked + .layer-color-indicator + .layer-label {
  color: var(--text-primary);
}

/* Disabled layer toggle */
.layer-toggle.disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.layer-toggle.disabled:hover {
  background: transparent;
}

.layer-toggle.disabled input[type="checkbox"] {
  cursor: not-allowed;
}

/* Label Type Sub-toggles */
.label-type-toggles {
  display: flex;
  flex-wrap: wrap;
  gap: 4px 8px;
  padding: 6px 8px 6px 20px;
  margin-top: -2px;
  background: rgba(0, 0, 0, 0.15);
  border-radius: 4px;
}

.label-type-toggle {
  display: flex;
  align-items: center;
  gap: 4px;
  cursor: pointer;
  padding: 2px 4px;
  border-radius: 3px;
  transition: background 0.15s;
}

.label-type-toggle:hover {
  background: rgba(192, 32, 35, 0.1);
}

.label-type-toggle input[type="checkbox"] {
  appearance: none;
  -webkit-appearance: none;
  width: 10px;
  height: 10px;
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: 2px;
  background: transparent;
  cursor: pointer;
  position: relative;
  flex-shrink: 0;
}

.label-type-toggle input[type="checkbox"]:checked {
  background: rgba(192, 32, 35, 0.2);
  border-color: var(--primary-red);
}

.label-type-toggle input[type="checkbox"]:checked::after {
  content: '';
  position: absolute;
  left: 2px;
  top: 0px;
  width: 4px;
  height: 6px;
  border: solid var(--primary-red);
  border-width: 0 1.5px 1.5px 0;
  transform: rotate(45deg);
}

.label-type-indicator {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  flex-shrink: 0;
}

.label-type-label {
  font-size: 10px;
  color: var(--text-secondary);
  transition: color 0.15s;
}

.label-type-toggle input:checked + .label-type-indicator + .label-type-label {
  color: var(--text-primary);
}

/* Labels row with expand button */
.labels-row {
  display: flex;
  align-items: center;
  gap: 4px;
}

.labels-row .layer-toggle {
  flex: 1;
}

.label-expand-btn {
  background: transparent;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  padding: 4px 6px;
  font-size: 8px;
  border-radius: 3px;
  transition: all 0.15s;
}

.label-expand-btn:hover {
  background: rgba(192, 32, 35, 0.1);
  color: var(--primary-red);
}

/* Label type groups */
.label-type-group {
  width: 100%;
  display: flex;
  flex-wrap: wrap;
  gap: 4px 8px;
  margin-bottom: 6px;
}

.label-type-group:last-child {
  margin-bottom: 0;
}

.label-type-group-title {
  width: 100%;
  font-size: 9px;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 2px;
  opacity: 0.7;
}

/* Disabled label type toggle */
.label-type-toggle.disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.label-type-toggle.disabled:hover {
  background: transparent;
}

.loading-indicator {
  font-size: 10px;
  color: var(--primary-red);
  animation: pulse 1s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 0.4; }
  50% { opacity: 1; }
}

/* Sea Level Control Section */
.sea-level-section {
  margin-top: 12px;
  padding-top: 12px;
  border-top: 1px solid rgba(192, 32, 35, 0.2);
}

.sea-level-controls {
  margin-top: 8px;
  padding: 8px;
  background: var(--bg-inner);
  border-radius: 8px;
}

.sea-level-value {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  margin-bottom: 8px;
}

.sea-level-btn {
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 20, 25, 0.6);
  border: 1px solid rgba(192, 32, 35, 0.3);
  border-radius: 2px;
  color: var(--primary-red);
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
}

.sea-level-btn:hover:not(:disabled) {
  background: rgba(192, 32, 35, 0.15);
  border-color: var(--primary-red);
}

.sea-level-btn:disabled {
  opacity: 0.3;
  cursor: not-allowed;
}

.sea-level-input {
  font-family: 'Orbitron', monospace;
  font-size: 14px;
  font-weight: 600;
  color: var(--primary-red);
  background: rgba(0, 20, 25, 0.6);
  border: 1px solid rgba(192, 32, 35, 0.3);
  border-radius: 2px;
  width: 60px;
  text-align: center;
  padding: 4px;
  outline: none;
  -moz-appearance: textfield;
}

.sea-level-input::-webkit-outer-spin-button,
.sea-level-input::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

.sea-level-input:focus {
  border-color: var(--primary-red);
}

.sea-level-unit {
  font-family: 'Orbitron', monospace;
  font-size: 14px;
  font-weight: 600;
  color: var(--primary-red);
}

.sea-level-slider {
  width: 100%;
  height: 6px;
  -webkit-appearance: none;
  appearance: none;
  background: rgba(192, 32, 35, 0.2);
  border-radius: 2px;
  outline: none;
  cursor: pointer;
}

.sea-level-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 14px;
  height: 14px;
  background: var(--primary-red);
  border-radius: 2px;
  cursor: pointer;
  transition: box-shadow 0.2s ease;
}

.sea-level-slider::-webkit-slider-thumb:hover {
  box-shadow: 0 0 6px rgba(192, 32, 35, 0.6);
}

.sea-level-slider::-moz-range-thumb {
  width: 14px;
  height: 14px;
  background: var(--primary-red);
  border-radius: 2px;
  cursor: pointer;
  border: none;
}

.sea-level-presets {
  display: flex;
  gap: 8px;
  margin-top: 10px;
}

.preset-btn {
  flex: 1;
  padding: 6px 10px;
  background: rgba(0, 20, 25, 0.4);
  border: 1px solid var(--border-color);
  border-radius: 6px;
  color: var(--text-secondary);
  font-size: 10px;
  font-weight: 500;
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
}

.preset-btn:hover {
  border-color: rgba(192, 32, 35, 0.4);
  color: var(--text-primary);
}

.preset-btn.active {
  background: rgba(192, 32, 35, 0.15);
  border-color: var(--primary-red);
  color: var(--primary-red);
}

.replace-coastlines-toggle {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-top: 10px;
  padding-top: 10px;
  border-top: 1px solid var(--border-color);
  cursor: pointer;
  font-size: 11px;
  color: var(--text-secondary);
  transition: color 0.2s ease;
}

.replace-coastlines-toggle:hover {
  color: var(--text-primary);
}

.replace-coastlines-toggle input[type="checkbox"] {
  appearance: none;
  -webkit-appearance: none;
  width: 14px;
  height: 14px;
  background: rgba(0, 20, 25, 0.6);
  border: 1px solid rgba(192, 32, 35, 0.3);
  border-radius: 2px;
  cursor: pointer;
  position: relative;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
  flex-shrink: 0;
}

.replace-coastlines-toggle input[type="checkbox"]:hover {
  border-color: rgba(192, 32, 35, 0.6);
}

.replace-coastlines-toggle input[type="checkbox"]:checked {
  background: rgba(192, 32, 35, 0.2);
  border-color: var(--primary-red);
}

.replace-coastlines-toggle input[type="checkbox"]:checked::after {
  content: '';
  position: absolute;
  left: 4px;
  top: 1px;
  width: 4px;
  height: 8px;
  border: solid var(--primary-red);
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}


/* Historical Borders Section */
.historical-borders-section {
  margin-top: 12px;
  padding-top: 8px;
  border-top: 1px solid rgba(192, 32, 35, 0.2);
}

.subsection-header {
  font-size: 10px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--primary-red);
  opacity: 0.8;
  margin-bottom: 8px;
}

.empire-region {
  margin-top: 4px;
}

.region-header {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 4px 8px;
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--primary-red);
  cursor: pointer;
  opacity: 0.8;
  transition: opacity 0.2s ease;
}

.region-header:hover {
  opacity: 1;
}

.expand-icon {
  font-size: 8px;
}

.empire-list {
  padding-left: 12px;
}

.empire-row {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 4px 6px;
  border-radius: 2px;
  background: transparent;
  border: 1px solid transparent;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease;
}

.empire-row:hover {
  background: rgba(192, 32, 35, 0.05);
  border-color: rgba(192, 32, 35, 0.15);
}

.empire-toggle {
  display: flex;
  align-items: center;
  gap: 6px;
  flex: 1;
  cursor: pointer;
  min-width: 0;
}

.empire-toggle input[type="checkbox"] {
  appearance: none;
  -webkit-appearance: none;
  width: 14px;
  height: 14px;
  background: rgba(0, 20, 25, 0.6);
  border: 1px solid rgba(192, 32, 35, 0.3);
  border-radius: 2px;
  cursor: pointer;
  position: relative;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease;
  flex-shrink: 0;
}

.empire-toggle input[type="checkbox"]:hover {
  border-color: rgba(192, 32, 35, 0.6);
}

.empire-toggle input[type="checkbox"]:checked {
  background: rgba(192, 32, 35, 0.2);
  border-color: var(--primary-red);
}

.empire-toggle input[type="checkbox"]:checked::after {
  content: '';
  position: absolute;
  left: 4px;
  top: 1px;
  width: 4px;
  height: 8px;
  border: solid var(--primary-red);
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}

.empire-toggle input[type="checkbox"]:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.empire-color {
  width: 8px;
  height: 8px;
  border-radius: 2px;
  flex-shrink: 0;
}

.empire-name {
  font-size: 11px;
  color: var(--text-secondary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.empire-period {
  font-size: 9px;
  color: var(--text-secondary);
  opacity: 0.6;
  margin-left: auto;
  flex-shrink: 0;
  white-space: nowrap;
}

.age-sync-btn {
  width: 18px;
  height: 18px;
  border: none;
  background: transparent;
  color: var(--text-secondary);
  opacity: 0.4;
  cursor: pointer;
  font-size: 12px;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: opacity 0.2s ease, color 0.2s ease;
  flex-shrink: 0;
}

.age-sync-btn:hover:not(:disabled) {
  opacity: 0.8;
}

.age-sync-btn.active {
  color: var(--primary-red);
  opacity: 1;
}

.age-sync-btn:disabled {
  opacity: 0.2;
  cursor: not-allowed;
}

/* Historical Borders Panel - Separate panel to the left of Map Layers */
.historical-borders-panel {
  position: fixed;
  bottom: 20px;
  /* Position to the left of layer-toggle-panel (180px + 12px gap) */
  right: calc(20px + 72px * var(--hud-scale, 1) + 192px);
  z-index: 100;
  transition: right 0.25s ease-out;
  padding: 12px;
  background: var(--bg-card);
  backdrop-filter: blur(var(--blur-amount));
  -webkit-backdrop-filter: blur(var(--blur-amount));
  border: 1px solid var(--border-color);
  border-radius: 4px;
  min-width: 200px;
  width: 200px;
  max-height: calc(100vh - 100px);
  overflow-y: auto;
  scrollbar-width: thin;
  scrollbar-color: rgba(192, 32, 35, 0.3) transparent;
  transform: scale(var(--hud-scale, 1));
  transform-origin: bottom right;
  transition: opacity 0.2s ease, transform 0.15s ease;
}

.historical-borders-panel::-webkit-scrollbar {
  width: 4px;
}

.historical-borders-panel::-webkit-scrollbar-thumb {
  background: rgba(192, 32, 35, 0.3);
  border-radius: 2px;
}

.historical-borders-panel::-webkit-scrollbar-thumb:hover {
  background: rgba(192, 32, 35, 0.5);
}

/* ============================================
   Empire Borders Window - New compact window
   ============================================ */
.empire-borders-window {
  position: fixed;
  /* Scale gap: 20px base + (60px zoom + 12px gap + 180px layers + 12px gap) * scale = 20px + 264px * scale */
  right: calc(20px + 264px * var(--hud-scale, 1));
  bottom: 20px;
  z-index: 100;
  width: 280px;
  min-height: 150px;
  max-height: calc(100vh - 100px);

  background: var(--bg-card);
  backdrop-filter: blur(var(--blur-amount));
  -webkit-backdrop-filter: blur(var(--blur-amount));
  border: 1px solid var(--border-color);
  border-radius: 4px;

  display: flex;
  flex-direction: column;

  transform: scale(var(--hud-scale, 1));
  transform-origin: bottom right;
  transition: opacity 0.2s ease, transform 0.15s ease;
}

.empire-borders-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 12px;
  border-bottom: 1px solid var(--border-color);
  flex-shrink: 0;
}

.empire-borders-header .panel-label {
  margin-bottom: 0;
}

.panel-close-btn {
  background: transparent;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  padding: 4px;
  border-radius: 4px;
  transition: color 0.15s;
  display: flex;
  align-items: center;
  justify-content: center;
}

.panel-close-btn:hover {
  color: var(--primary-red);
}

/* Empire options row (Labels + By Period toggles + quick buttons) */
.empire-options-row {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 6px 8px;
  border-bottom: 1px solid var(--border-color);
  flex-shrink: 0;
}

.empire-options-row .layer-toggle {
  padding: 4px 6px;
  gap: 6px;
}

.empire-options-row .layer-label {
  font-size: 10px;
}

.empire-quick-btns {
  display: flex;
  gap: 3px;
  margin-left: auto;
}

.empire-quick-btns .filter-btn {
  padding: 3px 6px;
  font-size: 9px;
  border-radius: 3px;
}

/* Global timeline row (slider when By Period enabled) */
.global-timeline-row {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 12px;
  border-bottom: 1px solid var(--border-color);
  flex-shrink: 0;
}

/* Resize handle - horizontal bar for vertical resizing */
.empire-borders-resize-handle {
  height: 6px;
  cursor: ns-resize;
  background: linear-gradient(180deg, transparent, rgba(192, 32, 35, 0.1));
  flex-shrink: 0;
  border-bottom: 1px solid var(--border-color);
}

.empire-borders-resize-handle:hover {
  background: linear-gradient(180deg, transparent, rgba(192, 32, 35, 0.3));
}

.global-timeline-slider {
  flex: 1;
  height: 4px;
  min-width: 60px;
  -webkit-appearance: none;
  appearance: none;
  background: rgba(192, 32, 35, 0.2);
  border-radius: 2px;
  cursor: pointer;
}

.global-timeline-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 12px;
  height: 12px;
  background: var(--primary-red);
  border-radius: 50%;
  cursor: pointer;
}

.global-timeline-slider::-moz-range-thumb {
  width: 12px;
  height: 12px;
  background: var(--primary-red);
  border-radius: 50%;
  cursor: pointer;
  border: none;
}

.global-timeline-year {
  font-family: 'Orbitron', monospace;
  font-size: 10px;
  color: var(--primary-red);
  width: 60px;
  text-align: right;
  flex-shrink: 0;
}

/* Inline year display for empire sliders */
.empire-year-display {
  font-family: 'Orbitron', monospace;
  font-size: 9px;
  color: var(--primary-red);
  width: 50px;
  text-align: right;
  flex-shrink: 0;
}

/* Empire list - scrollable container */
.empire-borders-list {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  padding: 8px 12px;
  scrollbar-width: thin;
  scrollbar-color: rgba(192, 32, 35, 0.3) transparent;
}

.empire-borders-list::-webkit-scrollbar {
  width: 4px;
}

.empire-borders-list::-webkit-scrollbar-thumb {
  background: rgba(192, 32, 35, 0.3);
  border-radius: 2px;
}

.empire-borders-list::-webkit-scrollbar-thumb:hover {
  background: rgba(192, 32, 35, 0.5);
}

/* Compact region grouping */
.empire-region-compact {
  margin-bottom: 8px;
}

.region-header-compact {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-secondary);
  cursor: pointer;
  padding: 4px 0;
  transition: color 0.15s;
}

.region-header-compact:hover {
  color: var(--text-primary);
}

.region-chevron {
  width: 12px;
  text-align: center;
  font-weight: bold;
  color: var(--primary-red);
  font-size: 12px;
}

.empire-list-compact {
  padding-left: 4px;
}

/* Inline empire row - all elements on one line */
.empire-row-inline {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 4px 0 4px 14px;
  min-height: 24px;
  transition: background 0.15s;
  border-radius: 4px;
  cursor: pointer;
}

.empire-row-inline:hover {
  background: rgba(192, 32, 35, 0.1);
}

.empire-row-inline input[type="checkbox"] {
  appearance: none;
  -webkit-appearance: none;
  width: 14px;
  height: 14px;
  background: rgba(0, 20, 25, 0.6);
  border: 1px solid rgba(192, 32, 35, 0.3);
  border-radius: 2px;
  cursor: pointer;
  position: relative;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease;
  flex-shrink: 0;
}

.empire-row-inline input[type="checkbox"]:hover {
  border-color: rgba(192, 32, 35, 0.6);
}

.empire-row-inline input[type="checkbox"]:checked {
  background: rgba(192, 32, 35, 0.2);
  border-color: var(--primary-red);
}

.empire-row-inline input[type="checkbox"]:checked::after {
  content: '';
  position: absolute;
  left: 4px;
  top: 1px;
  width: 4px;
  height: 8px;
  border: solid var(--primary-red);
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}

.empire-color-dot {
  width: 8px;
  height: 8px;
  border-radius: 2px;
  flex-shrink: 0;
}

.empire-name-truncated {
  flex: 1;
  font-size: 11px;
  color: var(--text-secondary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  min-width: 0;
  max-width: 110px;
  transition: color 0.2s ease;
}

.empire-row-inline.active .empire-name-truncated {
  color: var(--text-primary);
}

/* Inline year slider - compact */
.empire-year-slider-inline {
  width: 60px;
  height: 4px;
  flex-shrink: 0;
  -webkit-appearance: none;
  appearance: none;
  background: rgba(192, 32, 35, 0.2);
  border-radius: 2px;
  cursor: pointer;
}

.empire-year-slider-inline::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 10px;
  height: 10px;
  background: var(--primary-red);
  border-radius: 50%;
  cursor: pointer;
  margin-top: -3px;
}

.empire-year-slider-inline::-moz-range-thumb {
  width: 10px;
  height: 10px;
  background: var(--primary-red);
  border: none;
  border-radius: 50%;
  cursor: pointer;
}

.empire-year-slider-inline::-webkit-slider-runnable-track {
  height: 4px;
  background: rgba(192, 32, 35, 0.2);
  border-radius: 2px;
}

.empire-year-slider-inline::-moz-range-track {
  height: 4px;
  background: rgba(192, 32, 35, 0.2);
  border-radius: 2px;
}

/* Loading indicator inline */
.loading-dots {
  font-size: 10px;
  color: var(--primary-red);
  flex-shrink: 0;
  animation: pulse 1s infinite;
}

/* Hide empire borders window on mobile */
@media (max-width: 768px) {
  .empire-borders-window {
    display: none;
  }
}

/* HUD hiding for empire borders window */
body.hud-hidden .empire-borders-window {
  opacity: 0;
  pointer-events: none;
}

.empire-row-container {
  margin-bottom: 4px;
}

/* Empire Year (Temporal) Controls */
.empire-year-controls {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 4px 8px 4px 24px;
  margin-top: 2px;
}

.empire-year-value {
  font-family: 'Orbitron', monospace;
  font-size: 10px;
  color: var(--primary-red);
  min-width: 70px;
  text-align: right;
}

.empire-year-slider {
  flex: 1;
  height: 4px;
  -webkit-appearance: none;
  appearance: none;
  background: rgba(192, 32, 35, 0.2);
  border-radius: 2px;
  cursor: pointer;
}

.empire-year-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 10px;
  height: 10px;
  background: var(--primary-red);
  border-radius: 50%;
  cursor: pointer;
  transition: transform 0.1s ease;
}

.empire-year-slider::-webkit-slider-thumb:hover {
  transform: scale(1.2);
}

.empire-year-slider::-moz-range-thumb {
  width: 10px;
  height: 10px;
  background: var(--primary-red);
  border: none;
  border-radius: 50%;
  cursor: pointer;
}

/* Interactive Source Legend */
.source-legend-interactive {
  margin-top: 12px;
  padding-top: 12px;
  border-top: 1px solid var(--border-color);
  flex: 1 1 auto;  /* Grow/shrink with parent */
  min-height: 60px;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.source-legend-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
  flex-shrink: 0;
}

.source-legend-title {
  font-size: 11px;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.source-legend-actions {
  display: flex;
  gap: 4px;
}

.legend-action-btn {
  padding: 2px 8px;
  background: var(--bg-inner);
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: var(--text-secondary);
  font-size: 10px;
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
}

.legend-action-btn:hover {
  border-color: var(--primary-red);
  color: var(--primary-red);
}

.source-legend-list {
  display: flex;
  flex-direction: column;
  gap: 2px;
  flex: 1 1 auto;  /* Grow to fill available space like other legend lists */
  min-height: 30px;
  overflow-y: auto;
  padding-right: 4px;
}

.source-legend-list::-webkit-scrollbar {
  width: 4px;
}

.source-legend-list::-webkit-scrollbar-track {
  background: rgba(192, 32, 35, 0.05);
  border-radius: 2px;
}

.source-legend-list::-webkit-scrollbar-thumb {
  background: rgba(192, 32, 35, 0.3);
  border-radius: 2px;
}

.source-legend-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 8px;
  background: transparent;
  border: 1px solid transparent;
  border-radius: 4px;
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
  text-align: left;
  width: 100%;
}

.source-legend-item:hover {
  background: rgba(192, 32, 35, 0.1);
  border-color: rgba(192, 32, 35, 0.2);
}

.source-legend-item.active {
  opacity: 1;
}

.source-legend-item.inactive {
  opacity: 0.4;
}

.source-legend-item.inactive:hover {
  opacity: 0.7;
}

.source-legend-dot {
  width: 10px;
  height: 10px;
  border-radius: 2px;
  flex-shrink: 0;
  transition: background 0.2s ease;
}

.source-legend-name {
  flex: 1;
  font-size: 11px;
  color: var(--text-primary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.source-legend-item.inactive .source-legend-name {
  color: var(--text-secondary);
}

.source-legend-count {
  font-size: 10px;
  color: var(--text-secondary);
  padding: 1px 5px;
  background: rgba(0, 25, 30, 0.5);
  border-radius: 8px;
}

/* Source loading state */
.source-legend-item.loading {
  opacity: 0.6;
  cursor: wait;
}

.source-legend-item.loading .source-legend-dot {
  animation: pulse 1.2s ease-in-out infinite;
}

.source-legend-loading {
  font-size: 10px;
  color: var(--text-secondary);
  padding: 1px 5px;
}

.loading-dots {
  display: inline-flex;
  gap: 1px;
}

.loading-dots span {
  animation: loadingDot 1.4s ease-in-out infinite;
}

.loading-dots span:nth-child(1) { animation-delay: 0s; }
.loading-dots span:nth-child(2) { animation-delay: 0.2s; }
.loading-dots span:nth-child(3) { animation-delay: 0.4s; }

@keyframes loadingDot {
  0%, 60%, 100% { opacity: 0.3; }
  30% { opacity: 1; }
}

/* Source divider between primary and secondary sources */
.source-legend-divider {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 0;
  margin: 4px 0;
}

.source-legend-divider .divider-line {
  flex: 1;
  height: 1px;
  background: linear-gradient(90deg, transparent, rgba(128, 128, 128, 0.4), transparent);
}

.source-legend-divider .divider-label {
  font-size: 9px;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  white-space: nowrap;
}

/* Load All Sources Button (in divider) */
.load-all-sources-btn {
  padding: 2px 8px;
  background: rgba(192, 32, 35, 0.15);
  border: 1px solid rgba(192, 32, 35, 0.3);
  border-radius: 4px;
  color: rgba(192, 32, 35, 0.8);
  font-size: 9px;
  cursor: pointer;
  transition: all 0.2s ease;
  white-space: nowrap;
}

.load-all-sources-btn:hover {
  background: rgba(192, 32, 35, 0.25);
  border-color: rgba(192, 32, 35, 0.5);
  color: var(--primary-red);
}

/* Not-loaded source styling */
.source-legend-item.not-loaded {
  opacity: 0.6;
  border-style: dashed;
}

.source-legend-item.not-loaded:hover {
  opacity: 1;
  border-color: rgba(192, 32, 35, 0.4);
}

.source-legend-load-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  color: rgba(192, 32, 35, 0.6);
  margin-left: auto;
}

.source-legend-item.not-loaded:hover .source-legend-load-icon {
  color: var(--primary-red);
}

/* Offline unavailable state - greyed out when in offline mode and not cached */
.source-legend-item.offline-unavailable {
  opacity: 0.35;
  border-style: dashed;
  border-color: #555;
  cursor: not-allowed;
}

.source-legend-item.offline-unavailable:hover {
  opacity: 0.4;
  background: transparent;
  border-color: #666;
}

.source-legend-item.offline-unavailable .source-legend-dot {
  background: #444 !important;
}

.source-legend-item.offline-unavailable .source-legend-name,
.source-legend-item.offline-unavailable .source-legend-count {
  color: #666;
}

/* Empire toggle offline unavailable */
.empire-toggle.offline-unavailable {
  opacity: 0.35;
}

.empire-toggle.offline-unavailable label {
  cursor: not-allowed;
}

.empire-toggle.offline-unavailable input[type="checkbox"] {
  cursor: not-allowed;
}

/* ==========================================================================
   Empire Minimap (in popup)
   ========================================================================== */

.empire-minimap-section {
  display: flex;
  flex-direction: column;
  height: 100%;
  background: rgba(0, 15, 20, 0.6);
}

.empire-minimap-container {
  flex: 1;
  min-height: 200px;
  position: relative;
  overflow: hidden;
}

.empire-minimap {
  width: 100%;
  height: 100%;
}

/* Style Mapbox attribution for minimap - must remain visible per Mapbox ToS */
.empire-minimap-container .mapboxgl-ctrl-attrib {
  background: rgba(0, 15, 20, 0.7) !important;
  font-size: 9px !important;
  padding: 2px 4px !important;
}

.empire-minimap-container .mapboxgl-ctrl-attrib a {
  color: #888 !important;
}

.empire-minimap-container .mapboxgl-ctrl-logo {
  opacity: 0.7;
}

/* Layer toggle offline unavailable */
.layer-toggle.offline-unavailable,
.base-btn.offline-unavailable {
  opacity: 0.35;
  cursor: not-allowed;
}

/* Mapbox mode unavailable - greyed out for Three.js-only features */
.layer-toggle.mapbox-unavailable,
.subsection-label.mapbox-unavailable {
  opacity: 0.35;
  cursor: not-allowed;
}

.layer-toggle.mapbox-unavailable input {
  cursor: not-allowed;
}

/* Category Legend */
.category-legend {
  margin-top: 12px;
  padding-top: 12px;
  border-top: 1px solid var(--border-color);
  flex: 0 0 auto;  /* Never grow or shrink */
  display: flex;
  flex-direction: column;
}

.category-legend-title {
  font-size: 11px;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 8px;
  flex-shrink: 0;
}

.category-legend-list {
  display: flex;
  flex-direction: column;
  gap: 4px;
  overflow-y: auto;
  overflow-x: hidden;
  flex: 1 1 auto;
  padding-right: 4px;
}

.category-legend-list::-webkit-scrollbar {
  width: 6px;
}

.category-legend-list::-webkit-scrollbar-track {
  background: rgba(192, 32, 35, 0.1);
  border-radius: 3px;
}

.category-legend-list::-webkit-scrollbar-thumb {
  background: rgba(192, 32, 35, 0.4);
  border-radius: 3px;
}

.category-legend-badge {
  flex: 0 0 auto;
  padding: 3px 8px;
  border-radius: 4px;
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.3px;
  background: transparent;
  border: 1px solid;
  white-space: nowrap;
}

/* Interactive Category Legend - same as country-legend-interactive */
.category-legend-interactive {
  margin-top: 12px;
  padding-top: 12px;
  border-top: 1px solid var(--border-color);
  display: flex;
  flex-direction: column;
  flex: 1 1 auto;
  min-height: 60px;
  overflow: hidden;
}

.category-legend-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
  flex-shrink: 0;
}

.category-legend-interactive .category-legend-title {
  font-size: 11px;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 0;
}

.category-legend-actions {
  display: flex;
  gap: 4px;
}

/* Legend filter input - shared by category and country */
.legend-filter-container {
  position: relative;
  margin-bottom: 8px;
  flex-shrink: 0;
}

.legend-filter-input {
  width: 100%;
  padding: 6px 28px 6px 10px;
  background: var(--bg-inner);
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: var(--text-primary);
  font-size: 11px;
  outline: none;
  transition: border-color 0.2s ease;
}

.legend-filter-input:focus {
  border-color: var(--primary-red);
}

.legend-filter-input::placeholder {
  color: var(--text-secondary);
  opacity: 0.6;
}

.legend-filter-clear {
  position: absolute;
  right: 6px;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  padding: 2px;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0.6;
  transition: opacity 0.2s ease;
}

.legend-filter-clear:hover {
  opacity: 1;
  color: var(--primary-red);
}


/* Category grouping - same as continent-group */
.category-group {
  width: 100%;
  margin-bottom: 8px;
}

.category-group:last-child {
  margin-bottom: 0;
}

.category-group-label {
  font-size: 10px;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 4px;
  padding-bottom: 2px;
  border-bottom: 1px solid var(--border-color);
  opacity: 0.7;
}

.category-group-items {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.category-legend-item {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 3px 8px;
  background: transparent;
  border: 1px solid;
  border-radius: 4px;
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.3px;
  white-space: nowrap;
}

.category-legend-item:hover {
  background: rgba(192, 32, 35, 0.1);
}

.category-legend-item.active {
  opacity: 1;
}

.category-legend-item.inactive {
  opacity: 0.4;
  border-color: #666 !important;
  color: #666 !important;
}

.category-legend-item.inactive:hover {
  opacity: 0.7;
}

.category-legend-item.unavailable {
  opacity: 0.25;
  border-style: dashed !important;
}

.category-legend-item.unavailable:hover {
  opacity: 0.4;
}

.category-legend-dot {
  display: none;
}

.category-legend-name {
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.3px;
}

/* Country Legend - Interactive (same pattern as Category) */
.country-legend-interactive {
  margin-top: 12px;
  padding-top: 12px;
  border-top: 1px solid var(--border-color);
  display: flex;
  flex-direction: column;
  flex: 1 1 auto;
  min-height: 60px;
  overflow: hidden;
}

.country-legend-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
  flex-shrink: 0;
}

.country-legend-title {
  font-size: 11px;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.country-legend-actions {
  display: flex;
  gap: 4px;
}

.country-legend-list {
  display: flex;
  flex-direction: column;
  gap: 4px;
  overflow-y: auto;
  overflow-x: hidden;
  flex: 1 1 auto;  /* Fill available space in panel */
  padding-right: 4px;
}

.country-legend-list:not(:has(.continent-group)) {
  flex-direction: row;
  flex-wrap: wrap;
  gap: 6px;
  align-content: flex-start;
}

.country-legend-item {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 4px 8px;
  border-radius: 4px;
  border: 1px solid;
  background: transparent;
  cursor: pointer;
  transition: all 0.15s ease;
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.3px;
  white-space: nowrap;
}

.country-legend-item:hover {
  background: rgba(192, 32, 35, 0.1);
}

.country-legend-item.active {
  opacity: 1;
}

.country-legend-item.inactive {
  opacity: 0.4;
  border-color: #666 !important;
  color: #666 !important;
}

.country-legend-item.inactive:hover {
  opacity: 0.7;
}

.country-legend-item.unavailable {
  opacity: 0.25;
  border-style: dashed !important;
}

.country-legend-item.unavailable:hover {
  opacity: 0.4;
}

/* Country filter row with toggle */
.legend-filter-container.country-filter-row {
  display: flex;
  gap: 6px;
  align-items: center;
}

.country-filter-input-wrapper {
  flex: 1;
  min-width: 0;
  position: relative;
}

.country-filter-input-wrapper .legend-filter-input {
  width: 100%;
  padding-right: 28px;
}

.country-filter-input-wrapper .legend-filter-clear {
  position: absolute;
  right: 6px;
  top: 50%;
  transform: translateY(-50%);
}

/* Toggle button */
.country-display-toggle {
  padding: 4px 8px;
  background: var(--bg-inner);
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: var(--text-secondary);
  font-size: 10px;
  cursor: pointer;
  white-space: nowrap;
  transition: all 0.2s ease;
}

.country-display-toggle:hover {
  border-color: var(--primary-red);
  color: var(--primary-red);
}

/* Flag items in compact flow layout - now inside continent-countries */
.country-legend-list.flag-mode {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.country-flag-item {
  background: transparent;
  border: none;
  border-radius: 3px;
  padding: 1px;
  cursor: pointer;
  transition: all 0.15s ease;
  line-height: 0;
}

.country-flag-item img {
  display: block;
  height: 20px;
  width: auto;
  border-radius: 2px;
}

.country-flag-item:hover {
  background: rgba(192, 32, 35, 0.15);
  transform: scale(1.1);
}

.country-flag-item.active {
  opacity: 1;
}

.country-flag-item.inactive {
  opacity: 0.25;
  filter: grayscale(0.5);
}

.country-flag-item.inactive:hover {
  opacity: 0.6;
  filter: none;
}

.country-flag-item.unavailable {
  opacity: 0.12;
  filter: grayscale(1);
}

/* Continent grouping */
.continent-group {
  width: 100%;
  margin-bottom: 8px;
}

.continent-group:last-child {
  margin-bottom: 0;
}

.continent-label {
  font-size: 10px;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 4px;
  padding-bottom: 2px;
  border-bottom: 1px solid var(--border-color);
  opacity: 0.7;
}

.continent-countries {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.continent-countries.flag-mode {
  gap: 3px;
}

/* Country active: size to content, can shrink, min to show 2 lines of badges */
.filter-mode-toggle.country-active {
  flex: 0 1 auto;
  min-height: 220px;
}

/* Old source legend (keep for backwards compatibility) */
.source-legend {
  margin-top: 12px;
  padding-top: 12px;
  border-top: 1px solid var(--border-color);
}

.source-legend-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 4px 12px;
}

.source-item {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 10px;
  color: var(--text-secondary);
}

.source-item.more {
  color: var(--text-secondary);
  opacity: 0.7;
}

.source-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
}

.source-name {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Filter Tabs */
.filter-tabs {
  display: flex;
  gap: 4px;
  margin-bottom: 12px;
}

.filter-tab {
  flex: 1;
  padding: 8px 12px;
  background: var(--bg-inner);
  border: 1px solid var(--border-color);
  border-radius: 6px;
  color: var(--text-secondary);
  font-size: 11px;
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
}

.filter-tab:hover {
  border-color: rgba(192, 32, 35, 0.4);
  color: var(--text-primary);
}

.filter-tab.active {
  background: rgba(192, 32, 35, 0.15);
  border-color: var(--primary-red);
  color: var(--primary-red);
}

.tab-count {
  background: var(--primary-red);
  color: #000;
  padding: 1px 6px;
  border-radius: 2px;
  font-size: 9px;
  font-weight: 600;
}

/* Filter Content */
.filter-content {
  display: flex;
  flex-direction: column;
  gap: 10px;
  max-height: 300px;
  overflow-y: auto;
}

.filter-content::-webkit-scrollbar {
  width: 4px;
}

.filter-content::-webkit-scrollbar-track {
  background: rgba(192, 32, 35, 0.05);
  border-radius: 2px;
}

.filter-content::-webkit-scrollbar-thumb {
  background: rgba(192, 32, 35, 0.3);
  border-radius: 2px;
}

/* Filter Actions */
.filter-actions {
  display: flex;
  gap: 8px;
  margin-bottom: 8px;
}

.filter-action-btn {
  padding: 6px 12px;
  background: transparent;
  border: 1px solid rgba(192, 32, 35, 0.2);
  border-radius: 2px;
  color: var(--primary-red);
  font-size: 11px;
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
}

.filter-action-btn:hover {
  background: rgba(192, 32, 35, 0.1);
  border-color: var(--primary-red);
}

/* Source Buttons */
.source-buttons {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.source-buttons .filter-btn {
  display: flex;
  align-items: center;
  gap: 8px;
  width: 100%;
  justify-content: flex-start;
  border-radius: 6px;
  padding: 8px 12px;
}

.source-btn-name {
  flex: 1;
  text-align: left;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.source-count {
  font-size: 10px;
  opacity: 0.7;
  padding: 2px 6px;
  background: rgba(0, 25, 30, 0.5);
  border-radius: 10px;
}

/* Popup Source Badge */
.popup-source {
  display: inline-flex;
  align-items: center;
  align-self: flex-start;
  flex-shrink: 0;
  gap: 6px;
  padding: 6px 12px;
  border: 1px solid;
  border-radius: 16px;
  font-size: 12px;
  margin-bottom: 10px;
  background: var(--bg-inner);
  /* Prevent sub-pixel jitter */
  transform: translateZ(0);
}

/* Popup Actions */
.popup-actions {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin-top: 16px;
}

.popup-link-secondary {
  background: var(--bg-inner) !important;
  border-color: var(--border-color) !important;
  color: var(--text-secondary) !important;
}

.popup-link-secondary:hover {
  background: rgba(0, 40, 45, 0.5) !important;
  color: var(--text-primary) !important;
}

/* Clickable Source Badge */
.popup-source.clickable {
  cursor: pointer;
  text-decoration: none;
  transition: background 0.2s ease, opacity 0.2s ease;
}

.popup-source.clickable:hover {
  background: rgba(192, 32, 35, 0.1);
}

.popup-source .external-icon {
  opacity: 0.6;
  margin-left: 2px;
}

.popup-source.clickable:hover .external-icon {
  opacity: 1;
}

/* Content Links Section */
.popup-content-links {
  margin: 16px 0;
  padding: 12px;
  background: var(--bg-inner);
  border-radius: 8px;
  border: 1px solid var(--border-color);
}

.content-links-header {
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--text-secondary);
  margin-bottom: 10px;
}

.content-links-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 6px;
}

.content-link-btn {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  padding: 10px 6px;
  background: rgba(0, 20, 25, 0.4);
  border: 1px solid var(--border-color);
  border-radius: 6px;
  color: var(--text-secondary);
  font-size: 10px;
  text-decoration: none;
  transition: background 0.2s ease, border-color 0.2s ease, color 0.2s ease;
}

.content-link-btn:hover {
  background: rgba(192, 32, 35, 0.1);
  border-color: var(--primary-red);
  color: var(--primary-red);
}

.content-link-btn svg {
  opacity: 0.7;
}

.content-link-btn:hover svg {
  opacity: 1;
}

/* Responsive */
@media (max-width: 480px) {
  .filter-panel {
    left: 10px;
    right: 10px;
    max-width: none;
  }

  .logo-main {
    font-size: 18px;
    letter-spacing: 5px;
  }

  .logo-sub {
    font-size: 12px;
    letter-spacing: 4.8px;
  }

  .layer-toggle-panel {
    bottom: 10px;
    right: 70px;
    left: auto;
    min-width: 160px;
    width: 160px;
  }

  .historical-borders-panel {
    display: none;  /* Hide on mobile - not enough space */
  }

  .zoom-slider-top {
    right: 10px;
    bottom: 10px;
  }

  .base-layer-buttons {
    flex-direction: row;
  }

  .layer-toggle {
    padding: 4px 6px;
  }
}

/* Site Labels (CSS2DRenderer) - DEPRECATED, using hover tooltip instead */
.site-label {
  display: none;
}

/* Geographic Labels - Atlas Style Typography */
.geo-label {
  font-family: 'Times New Roman', 'Georgia', 'Palatino', serif;
  pointer-events: none;
  /* Subtle dark halo for readability */
  text-shadow:
    0 0 3px rgba(0, 0, 0, 0.8),
    0 0 6px rgba(0, 0, 0, 0.5);
  white-space: nowrap;
  user-select: none;
  z-index: 1 !important;
  opacity: 0;
  transition: opacity 0.15s ease-out;
  transform: translateZ(0);
  backface-visibility: hidden;
}

.geo-label.visible {
  opacity: 1;
}

/* CONTINENTS - Large, widely spaced, uppercase */
.geo-label-continent {
  font-size: 18px;
  font-weight: 400;
  color: rgba(210, 200, 180, 0.85);
  letter-spacing: 12px;
  text-transform: uppercase;
}

/* OCEANS - Large italic, blue, spaced */
.geo-label-ocean {
  font-size: 16px;
  font-weight: 400;
  color: rgba(120, 180, 220, 0.75);
  letter-spacing: 8px;
  text-transform: uppercase;
  font-style: italic;
}

/* Seas - Medium italic, lighter blue */
.geo-label-sea {
  font-size: 11px;
  font-weight: 400;
  color: rgba(140, 190, 230, 0.7);
  letter-spacing: 2px;
  font-style: italic;
}

/* COUNTRIES - Small caps style, cream/tan */
.geo-label-country {
  font-size: 11px;
  font-weight: 400;
  color: rgba(220, 210, 190, 0.8);
  letter-spacing: 3px;
  text-transform: uppercase;
  font-variant: small-caps;
}

/* Capitals - Regular, slightly warm */
.geo-label-capital {
  font-size: 10px;
  font-weight: 400;
  color: rgba(240, 230, 210, 0.75);
  letter-spacing: 0.5px;
}

/* MOUNTAINS - Italic, brown/sienna */
.geo-label-mountain {
  font-size: 11px;
  font-weight: 400;
  color: rgba(180, 140, 100, 0.8);
  letter-spacing: 2px;
  font-style: italic;
}

/* DESERTS - Italic, sandy/gold */
.geo-label-desert {
  font-size: 11px;
  font-weight: 400;
  color: rgba(210, 180, 120, 0.75);
  letter-spacing: 3px;
  font-style: italic;
  text-transform: uppercase;
}

/* Regions - Italic, muted green */
.geo-label-region {
  font-size: 10px;
  font-weight: 400;
  color: rgba(160, 180, 150, 0.6);
  font-style: italic;
}

/* LAKES - Blue, similar to seas */
.geo-label-lake {
  font-size: 11px;
  font-weight: 500;
  color: #42a5f5;
  font-style: italic;
  text-shadow: 0 0 3px rgba(0, 0, 0, 0.8), 0 0 6px rgba(0, 0, 0, 0.5);
}

/* RIVERS - Lighter blue, flowing style */
.geo-label-river {
  font-size: 10px;
  font-weight: 500;
  color: #64b5f6;
  font-style: italic;
  letter-spacing: 1px;
  text-shadow: 0 0 3px rgba(0, 0, 0, 0.8), 0 0 6px rgba(0, 0, 0, 0.5);
}

/* LEY LINES - Mystical purple */
.geo-label-leyLine {
  font-size: 11px;
  font-weight: 500;
  color: #ce93d8;
  font-style: italic;
  letter-spacing: 1px;
  text-shadow: 0 0 3px rgba(0, 0, 0, 0.8), 0 0 6px rgba(0, 0, 0, 0.5);
}

/* TRADE ROUTES - Bronze/gold historical feel */
.geo-label-tradeRoute {
  font-size: 11px;
  font-weight: 500;
  color: #ffb74d;
  letter-spacing: 1px;
  text-shadow: 0 0 3px rgba(0, 0, 0, 0.8), 0 0 6px rgba(0, 0, 0, 0.5);
}

/* Site Hover Tooltip */
.site-hover-tooltip {
  position: fixed;
  z-index: 50;
  background: var(--bg-card);
  border: 1px solid var(--border-color);
  border-radius: 6px;
  padding: 10px 14px;
  pointer-events: auto;
  cursor: pointer;
  backdrop-filter: blur(var(--blur-amount));
  -webkit-backdrop-filter: blur(var(--blur-amount));
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
  animation: tooltipFadeIn 0.2s ease-out;
  max-width: 280px;
  transition: border-color 0.15s ease, box-shadow 0.15s ease;
}

.site-hover-tooltip:hover {
  border-color: rgba(0, 240, 255, 0.5);
  box-shadow: 0 8px 32px rgba(0, 240, 255, 0.15);
}

/* list-highlighted tooltips use same styling as regular hover tooltips */

.tooltip-header {
  display: flex;
  align-items: center;
  gap: 8px;
  justify-content: space-between;
}

.tooltip-title {
  color: #fff;
  font-size: 13px;
  font-weight: 500;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  flex: 1;
  min-width: 0;
}

.tooltip-flag {
  height: 20px;
  width: auto;
  flex-shrink: 0;
  border-radius: 2px;
}

.tooltip-location {
  color: rgba(255, 255, 255, 0.6);
  font-size: 11px;
  margin-top: 2px;
}

.tooltip-badges {
  display: flex;
  flex-wrap: nowrap;
  gap: 6px;
  margin-top: 6px;
}

.tooltip-badge {
  font-size: 9px;
  padding: 2px 6px;
  border: 1px solid;
  border-radius: 3px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-weight: 500;
  white-space: nowrap;
  flex-shrink: 0;
}

@keyframes tooltipFadeIn {
  from {
    opacity: 0;
    transform: scale(var(--hud-scale, 1)) translateY(4px);
  }
  to {
    opacity: 1;
    transform: scale(var(--hud-scale, 1)) translateY(0);
  }
}

/* Cursor coordinates display */
.cursor-coords {
  position: fixed;
  top: 15px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 11px;
  color: var(--primary-red);
  font-family: 'Orbitron', monospace;
  letter-spacing: 1px;
  pointer-events: none;
  z-index: 100;
  white-space: nowrap;
  background: var(--bg-card);
  backdrop-filter: blur(var(--blur-amount));
  -webkit-backdrop-filter: blur(var(--blur-amount));
  padding: 6px 12px;
  border-radius: 4px;
  border: 1px solid rgba(192, 32, 35, 0.2);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  min-width: 220px;
  text-align: center;
}

/* Contribute picker hint below coordinates */
.contribute-picker-hint {
  position: fixed;
  top: 52px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 11px;
  color: rgba(255, 255, 255, 0.85);
  font-family: var(--font-secondary);
  background: rgba(0, 20, 25, 0.4);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  padding: 6px 12px;
  border-radius: 4px;
  border: 1px solid rgba(192, 32, 35, 0.5);
  z-index: 100;
  animation: picker-hint-pulse 2s ease-in-out infinite;
}

@keyframes picker-hint-pulse {
  0%, 100% { border-color: rgba(192, 32, 35, 0.3); box-shadow: 0 0 8px rgba(192, 32, 35, 0.1); }
  50% { border-color: rgba(192, 32, 35, 0.7); box-shadow: 0 0 12px rgba(192, 32, 35, 0.3); }
}

.picker-back-btn {
  background: transparent;
  border: none;
  color: rgba(255, 255, 255, 0.6);
  cursor: pointer;
  padding: 2px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: color 0.2s;
}

.picker-back-btn:hover {
  color: var(--primary-red);
}

/* Scale bar */
.scale-bar {
  position: fixed;
  bottom: 15px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  flex-direction: column;
  align-items: center;
  pointer-events: none;
  z-index: 100;
  background: var(--bg-card);
  backdrop-filter: blur(var(--blur-amount));
  -webkit-backdrop-filter: blur(var(--blur-amount));
  padding: 6px 12px;
  border-radius: 4px;
  border: 1px solid rgba(192, 32, 35, 0.2);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.scale-bar-line {
  height: 1px;
  background: var(--primary-red);
  position: relative;
}

.scale-bar-line::before,
.scale-bar-line::after {
  content: '';
  position: absolute;
  top: -3px;
  width: 1px;
  height: 7px;
  background: var(--primary-red);
}

.scale-bar-line::before { left: 0; }
.scale-bar-line::after { right: 0; }

.scale-bar-label {
  margin-top: 4px;
  font-size: 10px;
  color: var(--text-secondary);
  font-family: 'Orbitron', monospace;
  letter-spacing: 0.5px;
}

/* Tab content visibility - both views rendered, toggle visibility */
.tab-content .map-section {
  position: absolute;
  inset: 0;
  visibility: hidden;
  opacity: 0;
  transition: opacity 0.15s ease;
}

.tab-content .map-section.active {
  position: relative;
  visibility: visible;
  opacity: 1;
  flex: 1;
}

.tab-content .map-section.hidden {
  visibility: hidden;
  opacity: 0;
  pointer-events: none;
}

/* ==========================================================================
   Image Gallery
   ========================================================================== */

.popup-gallery-section {
  border-top: 1px solid var(--border-color);
  padding: 0;
  background: rgba(0, 15, 20, 0.5);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  /* Prevent hover effects from causing parent jitter */
  transform: translateZ(0);
  contain: layout;
}

.gallery-container {
  width: 100%;
  padding: 12px;
}

.gallery-grid {
  display: flex;
  gap: 10px;
  overflow-x: auto;
  overflow-y: hidden;
  padding-bottom: 4px;
  scroll-behavior: smooth;
}

.gallery-grid::-webkit-scrollbar {
  height: 6px;
}

.gallery-grid::-webkit-scrollbar-track {
  background: rgba(192, 32, 35, 0.05);
  border-radius: 3px;
}

.gallery-grid::-webkit-scrollbar-thumb {
  background: rgba(192, 32, 35, 0.3);
  border-radius: 3px;
}

.gallery-item {
  flex-shrink: 0;
  width: 140px;
  height: 105px;
  position: relative;
  border-radius: 6px;
  overflow: hidden;
  cursor: pointer;
  border: 1px solid var(--border-color);
  transition: border-color 0.3s ease;
  /* GPU layer to prevent layout shifts on hover */
  transform: translateZ(0);
}

/* Dark haze overlay - visible by default, fades on hover */
.gallery-item::after {
  content: '';
  position: absolute;
  inset: 0;
  background: rgba(0, 15, 20, 0.35);
  pointer-events: none;
  transition: opacity 0.3s ease;
}

.gallery-item:hover {
  border-color: var(--primary-red);
}

.gallery-item:hover::after {
  opacity: 0;
}

.gallery-item img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 5px; /* Slightly smaller than parent to ensure clean corners */
  display: block;
  animation: galleryFadeIn 0.3s ease-out;
}

@keyframes galleryFadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.gallery-item-overlay {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  transition: opacity 0.2s ease;
  z-index: 1;
}

.gallery-item:hover .gallery-item-overlay {
  opacity: 0;
}

.gallery-item-overlay svg {
  color: white;
}

.gallery-item-credit {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 4px 6px;
  background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
  font-size: 9px;
  color: rgba(255, 255, 255, 0.7);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.gallery-empty {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 20px 0;
  color: var(--text-secondary);
  font-size: 12px;
}

/* Offline notice styling for gallery tabs */
.gallery-offline-notice {
  flex-direction: column;
  text-align: center;
  gap: 8px;
}

.gallery-subtext {
  font-size: 10px;
  color: #666;
  font-style: italic;
}

/* Gallery Footer */
.gallery-footer {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 8px;
  padding: 0 4px;
}

.gallery-footer .connector-status {
  flex: 1;
  min-width: 0;
}

/* Development Warning Badge */
.gallery-dev-warning {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 3px 8px;
  background: transparent;
  border: none;
  font-size: 10px;
  color: rgba(255, 180, 50, 0.7);
  white-space: nowrap;
  flex-shrink: 0;
}

.gallery-dev-warning svg {
  flex-shrink: 0;
  opacity: 0.7;
  stroke: rgba(255, 180, 50, 0.7);
}

/* Gallery Text List (for books/texts from Smithsonian) */
.gallery-text-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding: 8px;
  overflow-y: auto;
  height: 121px; /* Same as gallery grid height */
}

.gallery-text-item {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 10px 12px;
  background: rgba(255, 255, 255, 0.03);
  border: 1px solid rgba(255, 255, 255, 0.08);
  border-radius: 6px;
  text-decoration: none;
  color: inherit;
  transition: all 0.15s ease;
}

.gallery-text-item:hover {
  background: rgba(255, 255, 255, 0.06);
  border-color: rgba(255, 255, 255, 0.15);
}

.gallery-text-icon {
  flex-shrink: 0;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
  color: var(--text-secondary);
}

.gallery-text-cover {
  flex-shrink: 0;
  width: 40px;
  height: 56px;
  border-radius: 3px;
  overflow: hidden;
  background: rgba(255, 255, 255, 0.05);
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
}

.gallery-text-cover img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.gallery-text-content {
  flex: 1;
  min-width: 0;
}

.gallery-text-title {
  font-size: 12px;
  font-weight: 500;
  color: var(--text-primary);
  line-height: 1.3;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.gallery-text-author {
  font-size: 11px;
  color: var(--text-secondary);
  margin-top: 2px;
}

.gallery-text-date {
  font-size: 10px;
  color: var(--text-muted);
  margin-top: 2px;
}

.gallery-text-source {
  font-size: 9px;
  color: var(--accent-primary);
  margin-top: 4px;
  opacity: 0.8;
  display: flex;
  align-items: center;
  gap: 4px;
}

.gallery-text-favicon {
  width: 12px;
  height: 12px;
  border-radius: 2px;
  flex-shrink: 0;
  image-rendering: -webkit-optimize-contrast;
}

.gallery-text-link {
  flex-shrink: 0;
  color: var(--text-muted);
  opacity: 0;
  transition: opacity 0.15s ease;
}

.gallery-text-item:hover .gallery-text-link {
  opacity: 0.6;
}

/* ==========================================================================
   Image Lightbox
   ========================================================================== */

.lightbox-overlay {
  position: fixed;
  inset: 0;
  z-index: 2000;
  background: rgba(0, 0, 0, 0.98);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 10px;
}

.lightbox-content {
  position: relative;
  width: 98vw;
  height: 98vh;
  max-width: 98vw;
  max-height: 98vh;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.lightbox-close {
  position: absolute;
  top: 8px;
  right: 8px;
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 20, 25, 0.8);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: white;
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
  z-index: 20;
}

.lightbox-close:hover {
  border-color: var(--primary-red);
  color: var(--primary-red);
}

.lightbox-nav {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 20, 25, 0.8);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: white;
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
  z-index: 10;
}

.lightbox-nav:hover {
  border-color: var(--primary-red);
  color: var(--primary-red);
}

.lightbox-prev {
  left: 20px;
}

.lightbox-next {
  right: 20px;
}

.lightbox-image-container {
  display: flex;
  align-items: center;
  justify-content: center;
  max-height: calc(98vh - 60px);
}

.lightbox-image {
  max-width: 100%;
  max-height: calc(98vh - 60px);
  object-fit: contain;
  border-radius: 4px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
}

.lightbox-caption {
  margin-top: 16px;
  text-align: center;
  max-width: 600px;
}

.lightbox-title {
  font-size: 14px;
  color: white;
  margin-bottom: 8px;
  font-weight: 500;
}

.lightbox-attribution {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  flex-wrap: wrap;
  font-size: 12px;
  color: rgba(255, 255, 255, 0.6);
}

.lightbox-attribution a {
  color: var(--primary-red);
  text-decoration: none;
  transition: color 0.2s;
}

.lightbox-attribution a:hover {
  color: #ff4040;
  text-decoration: underline;
}

.lightbox-license {
  padding: 2px 8px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 4px;
  font-size: 10px;
}

.lightbox-counter {
  margin-top: 8px;
  font-size: 11px;
  color: rgba(255, 255, 255, 0.4);
}

/* Responsive Lightbox */
@media (max-width: 768px) {
  .lightbox-overlay {
    padding: 20px;
  }

  .lightbox-nav {
    width: 40px;
    height: 40px;
  }

  .lightbox-prev {
    left: 8px;
  }

  .lightbox-next {
    right: 8px;
  }

  .lightbox-close {
    top: 10px;
    right: 10px;
  }
}

/* ==========================================================================
   3D Model Viewer (Sketchfab)
   ========================================================================== */

.model-viewer-overlay {
  position: fixed;
  inset: 0;
  z-index: 2000;
  background: rgba(0, 0, 0, 0.98);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 10px;
}

.model-viewer-content {
  position: relative;
  width: 98vw;
  height: 98vh;
  max-width: 98vw;
  max-height: 98vh;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.model-viewer-close {
  position: absolute;
  top: 8px;
  right: 8px;
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 20, 25, 0.8);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: white;
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease;
  z-index: 20;
}

.model-viewer-close:hover {
  border-color: var(--primary-red);
  color: var(--primary-red);
}

.model-viewer-nav {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 20, 25, 0.8);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: white;
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease;
  z-index: 10;
}

.model-viewer-nav:hover {
  border-color: var(--primary-red);
  color: var(--primary-red);
}

.model-viewer-prev {
  left: 20px;
}

.model-viewer-next {
  right: 20px;
}

.model-viewer-iframe-container {
  position: relative;
  width: 100%;
  flex: 1;
  max-height: calc(98vh - 50px);
  border-radius: 4px;
  overflow: hidden;
  background: #111;
}

.model-viewer-iframe-container iframe {
  width: 100%;
  height: 100%;
  border: none;
  transition: opacity 0.3s ease;
}

.model-viewer-loading {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 12px;
  background: #111;
  color: rgba(255, 255, 255, 0.6);
  font-size: 13px;
}

.model-viewer-spinner {
  width: 32px;
  height: 32px;
  border: 2px solid rgba(255, 255, 255, 0.1);
  border-top-color: var(--primary-red);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

.model-viewer-caption {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  flex-wrap: wrap;
  margin-top: 8px;
  padding: 0 20px;
}

.model-viewer-info {
  text-align: center;
}

.model-viewer-title {
  font-size: 13px;
  color: white;
  font-weight: 500;
  margin-bottom: 2px;
  max-width: 300px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.model-viewer-creator {
  font-size: 11px;
  color: rgba(255, 255, 255, 0.6);
}

.model-viewer-creator a {
  color: var(--primary-red);
  text-decoration: none;
  transition: color 0.2s;
}

.model-viewer-creator a:hover {
  color: #ff4040;
  text-decoration: underline;
}

.model-viewer-stats {
  display: flex;
  align-items: center;
  gap: 12px;
}

.model-viewer-stat {
  display: flex;
  align-items: center;
  gap: 3px;
  font-size: 11px;
  color: rgba(255, 255, 255, 0.5);
}

.model-viewer-stat svg {
  width: 12px;
  height: 12px;
  opacity: 0.7;
}

.model-viewer-sketchfab-link {
  display: flex;
  align-items: center;
  gap: 5px;
  padding: 4px 10px;
  background: rgba(28, 172, 214, 0.15);
  border: 1px solid rgba(28, 172, 214, 0.3);
  border-radius: 4px;
  color: #1cacd6;
  font-size: 11px;
  font-weight: 500;
  text-decoration: none;
  transition: background 0.2s, border-color 0.2s;
}

.model-viewer-sketchfab-link svg {
  width: 14px;
  height: 14px;
}

.model-viewer-sketchfab-link:hover {
  background: rgba(28, 172, 214, 0.25);
  border-color: rgba(28, 172, 214, 0.5);
}

.model-viewer-counter {
  font-size: 10px;
  color: rgba(255, 255, 255, 0.4);
}

/* Responsive Model Viewer */
@media (max-width: 768px) {
  .model-viewer-overlay {
    padding: 0;
  }

  .model-viewer-nav {
    width: 36px;
    height: 36px;
  }

  .model-viewer-prev {
    left: 8px;
  }

  .model-viewer-next {
    right: 8px;
  }

  .model-viewer-close {
    top: 10px;
    right: 10px;
  }

  .model-viewer-caption {
    flex-direction: column;
    gap: 8px;
  }

  .model-viewer-title {
    max-width: 90vw;
  }
}

/* ==========================================================================
   Gallery Upload Button
   ========================================================================== */

.image-upload {
  display: flex;
  align-items: center;
  gap: 8px;
}

.upload-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  background: transparent;
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: var(--text-secondary);
  font-size: 11px;
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
}

.upload-btn:hover {
  border-color: var(--primary-red);
  color: var(--primary-red);
  background: rgba(192, 32, 35, 0.1);
}

.upload-btn:disabled {
  opacity: 0.5;
  cursor: wait;
}

.upload-spinner {
  width: 14px;
  height: 14px;
  border: 2px solid rgba(192, 32, 35, 0.2);
  border-top-color: var(--primary-red);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

.upload-message {
  padding: 4px 10px;
  border-radius: 4px;
  font-size: 11px;
  animation: fadeIn 0.2s ease;
}

.upload-message.success {
  background: rgba(34, 197, 94, 0.15);
  color: #22c55e;
  border: 1px solid rgba(34, 197, 94, 0.3);
}

.upload-message.error {
  background: rgba(239, 68, 68, 0.15);
  color: #ef4444;
  border: 1px solid rgba(239, 68, 68, 0.3);
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-4px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Gallery Loading State */
.gallery-loading {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 8px;
  background: rgba(0, 20, 25, 0.6);
  color: var(--text-secondary);
  font-size: 10px;
}

.gallery-loading-spinner {
  width: 20px;
  height: 20px;
  border: 2px solid rgba(192, 32, 35, 0.2);
  border-top-color: var(--primary-red);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

.gallery-error {
  margin-top: 8px;
  padding: 6px 10px;
  background: rgba(239, 68, 68, 0.1);
  border: 1px solid rgba(239, 68, 68, 0.2);
  border-radius: 4px;
  color: #ef4444;
  font-size: 11px;
  text-align: center;
}

.gallery-empty-hint {
  font-size: 10px;
  color: var(--primary-red);
  opacity: 0.7;
}

/* ==========================================================================
   Enhanced Lightbox - Pan/Zoom at 90% viewport
   ========================================================================== */

.lightbox-content {
  width: 98vw;
  height: 98vh;
  max-width: 98vw;
  max-height: 98vh;
}

.lightbox-image-container {
  flex: 1;
  width: 100%;
  height: 100%;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
}

.lightbox-image-container.zoomed {
  cursor: grab;
}

.lightbox-image-container.zoomed.panning {
  cursor: grabbing;
}

.lightbox-image {
  transition: transform 0.15s ease-out;
  user-select: none;
  -webkit-user-drag: none;
}

.lightbox-zoom-controls {
  position: absolute;
  bottom: 80px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  background: rgba(0, 20, 25, 0.9);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border: 1px solid var(--border-color);
  border-radius: 4px;
  z-index: 10;
}

.lightbox-zoom-btn {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 20, 25, 0.8);
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: white;
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
}

.lightbox-zoom-btn:hover {
  border-color: var(--primary-red);
  color: var(--primary-red);
}

.lightbox-zoom-level {
  min-width: 50px;
  text-align: center;
  font-size: 12px;
  color: rgba(255, 255, 255, 0.7);
  font-variant-numeric: tabular-nums;
}

.lightbox-source-link {
  display: flex;
  align-items: center;
  gap: 4px;
}

/* ==========================================================================
   Gallery Source Badges (Wikipedia)
   ========================================================================== */

.gallery-item-badge {
  position: absolute;
  top: 4px;
  left: 4px;
  width: 18px;
  height: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 3px;
  font-size: 10px;
  font-weight: 700;
  z-index: 5;
  pointer-events: none;
}

.gallery-item-badge.wikipedia {
  background: rgba(255, 255, 255, 0.9);
  color: #333;
}

.gallery-item-badge.sketchfab {
  background: rgba(28, 172, 214, 0.9);
  color: white;
  padding: 3px 4px;
}

/* Gallery item favicon - shows connector source */
.gallery-item-favicon {
  position: absolute;
  bottom: 4px;
  right: 4px;
  width: 24px !important;
  height: 24px !important;
  border-radius: 3px;
  background: rgba(0, 0, 0, 0.75);
  padding: 3px;
  z-index: 10;
  image-rendering: -webkit-optimize-contrast;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
  object-fit: contain !important;
}

/* ==========================================================================
   Gallery Tabs (Photos/Maps/Artifacts) - Unified Gallery System
   ========================================================================== */

.gallery-tabs {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 8px 12px;
  background: rgba(0, 15, 20, 0.8);
  border-bottom: 1px solid var(--border-color);
  flex-shrink: 0;
  /* Prevent sub-pixel jitter */
  transform: translateZ(0);
}

.gallery-tab {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 12px;
  background: transparent;
  border: 1px solid transparent;
  border-radius: 4px;
  color: var(--text-secondary);
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease;
  /* Prevent sub-pixel jitter */
  transform: translateZ(0);
}

.gallery-tab:hover {
  color: var(--text-primary);
  background: rgba(255, 255, 255, 0.05);
}

.gallery-tab.active {
  color: var(--primary-red);
  background: rgba(192, 32, 35, 0.15);
  border-color: rgba(192, 32, 35, 0.3);
}

.gallery-tab svg {
  flex-shrink: 0;
}

.gallery-tab-count {
  font-size: 10px;
  padding: 2px 6px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 10px;
  color: inherit;
  opacity: 0.7;
  /* Prevent sub-pixel jitter when count changes */
  transform: translateZ(0);
  /* Reserve space for double-digit numbers to prevent layout shift */
  min-width: 24px;
  text-align: center;
  box-sizing: border-box;
  /* Smooth transition when count changes */
  transition: opacity 0.3s ease;
}

.gallery-tab.active .gallery-tab-count {
  background: rgba(192, 32, 35, 0.2);
  opacity: 1;
}

.gallery-tab-count.loading {
  opacity: 0.4;
  font-size: 8px;
  letter-spacing: 1px;
}

.gallery-tabs-spacer {
  flex: 1;
}

.gallery-expand-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 6px;
  background: transparent;
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: var(--text-secondary);
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
}

.gallery-expand-btn:hover {
  border-color: var(--primary-red);
  color: var(--primary-red);
  background: rgba(192, 32, 35, 0.1);
}

/* ==========================================================================
   Connector Status - Debug panel showing which sources returned results
   ========================================================================== */

.connector-status {
  border-top: 1px solid var(--border-color);
  background: rgba(0, 15, 20, 0.6);
  font-size: 11px;
}

.connector-status-header {
  display: flex;
  align-items: center;
  gap: 6px;
  width: 100%;
  padding: 8px 12px;
  background: transparent;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  text-align: left;
  transition: color 0.2s ease;
}

.connector-status-header:hover {
  color: var(--text-primary);
}

.connector-status-chevron {
  flex-shrink: 0;
  transition: transform 0.2s ease;
}

.connector-status-chevron.expanded {
  transform: rotate(90deg);
}

.connector-status-summary {
  flex: 1;
}

.connector-status-failed {
  color: var(--error-red, #e53935);
}

.connector-status-time {
  opacity: 0.6;
}

.connector-status-details {
  padding: 0 12px 12px 12px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  max-height: 200px;
  overflow-y: auto;
}

.connector-status-section {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.connector-status-section-title {
  font-size: 10px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-secondary);
  opacity: 0.7;
  margin-bottom: 2px;
}

.connector-status-item {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 4px 8px;
  background: rgba(255, 255, 255, 0.03);
  border-radius: 4px;
  font-size: 11px;
}

.connector-status-icon {
  width: 14px;
  height: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  font-weight: 700;
  border-radius: 50%;
  flex-shrink: 0;
}

.connector-status-item.success .connector-status-icon {
  background: rgba(76, 175, 80, 0.2);
  color: #4CAF50;
}

.connector-status-item.empty .connector-status-icon {
  background: rgba(255, 255, 255, 0.1);
  color: var(--text-secondary);
}

.connector-status-item.failed .connector-status-icon {
  background: rgba(229, 57, 53, 0.2);
  color: #e53935;
}

.connector-status-name {
  flex: 1;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.connector-status-count {
  font-weight: 600;
  color: var(--text-primary);
  min-width: 20px;
  text-align: right;
}

.connector-status-item.empty .connector-status-count {
  opacity: 0.5;
}

/* Gallery grid container - Fixed height for consistent layout */
.gallery-grid-container {
  height: auto;
  padding: 12px;
  overflow: hidden;
  position: relative;
}

/* Background haze overlay for gallery section */
.gallery-grid-container::after {
  content: '';
  position: absolute;
  inset: 0;
  background: rgba(0, 15, 20, 0.30);
  pointer-events: none;
  z-index: 1;
}

.popup-gallery-section.expanded .gallery-grid-container::after {
  display: none;
}

.gallery-grid-container .gallery-loading {
  height: 121px; /* Same as gallery grid (105px + 16px scrollbar space) */
  display: flex;
  align-items: center;
  justify-content: center;
}

.gallery-grid-container .gallery-empty {
  height: 121px; /* Same as gallery grid (105px + 16px scrollbar space) */
  display: flex;
  align-items: center;
  gap: 12px;
  color: var(--text-secondary);
  font-size: 12px;
}

.gallery-grid-container .gallery-grid {
  display: flex;
  gap: 12px;
  height: 121px; /* 105px image + 16px scrollbar space */
  overflow-x: auto;
  overflow-y: hidden;
  padding-bottom: 16px;
}

.gallery-grid-container .gallery-grid::-webkit-scrollbar {
  height: 6px;
}

.gallery-grid-container .gallery-grid::-webkit-scrollbar-track {
  background: rgba(192, 32, 35, 0.05);
  border-radius: 3px;
}

.gallery-grid-container .gallery-grid::-webkit-scrollbar-thumb {
  background: rgba(192, 32, 35, 0.3);
  border-radius: 3px;
}

/* Gallery expanded state */
.popup-gallery-section.expanded {
  position: absolute !important;
  inset: 0 !important;
  z-index: 100 !important;
  background: rgb(0, 15, 20) !important;
  border-radius: 8px !important;
  display: flex !important;
  flex-direction: column !important;
  overflow: hidden !important;
  border-top: none !important;
}

/* Expanded gallery header with site name */
.gallery-expanded-header {
  display: flex;
  align-items: baseline;
  gap: 6px;
  padding: 12px 16px 0 16px;
  flex-shrink: 0;
}

.gallery-expanded-title {
  font-family: 'Orbitron', sans-serif;
  font-size: 22px;
  font-weight: 700;
  color: #ffffff;
  text-shadow:
    -1px -1px 0 #000,
    1px -1px 0 #000,
    -1px 1px 0 #000,
    1px 1px 0 #000,
    0 0 8px rgba(0, 0, 0, 0.8);
  letter-spacing: 1px;
  margin: 0;
  line-height: 1.2;
}

.gallery-collapse-btn {
  position: absolute;
  top: 44px; /* Below window controls */
  right: 8px;
  z-index: 150; /* Above gallery content but below window controls */
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 20, 25, 0.85);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: var(--text-secondary);
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease;
}

.gallery-collapse-btn:hover {
  border-color: var(--primary-red);
  color: var(--primary-red);
  background: rgba(192, 32, 35, 0.1);
}

.popup-gallery-section.expanded .gallery-tabs {
  padding: 8px 16px;
  background: transparent;
}

.popup-gallery-section.expanded .gallery-grid-container {
  flex: 1;
  height: auto;
  padding: 16px;
  overflow: auto;
}

.popup-gallery-section.expanded .gallery-grid-container .gallery-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 12px;
  height: auto;
  overflow: visible;
  padding-bottom: 0;
}

.popup-gallery-section.expanded .gallery-grid-container .gallery-empty {
  justify-content: center;
  flex-direction: column;
  text-align: center;
}

.gallery-item-date {
  font-size: 9px;
  color: rgba(255,255,255,0.7);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.gallery-item-title {
  font-size: 10px;
  color: white;
  font-weight: 500;
  line-height: 1.3;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* Expanded gallery item sizing */
.popup-gallery-section.expanded .gallery-item {
  width: 100%;
  height: 0;
  padding-bottom: 75%; /* 4:3 aspect ratio */
}

.popup-gallery-section.expanded .gallery-item img:not(.gallery-item-favicon) {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
}

/* Expanded book list - same behavior as expanded photo grid */
.popup-gallery-section.expanded .gallery-grid-container .gallery-text-list {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 12px;
  height: auto;
  overflow: visible;
  overflow-y: visible;
  padding: 0;
  padding-bottom: 0;
}

.popup-gallery-section.expanded .gallery-grid-container .gallery-text-item {
  padding: 14px 16px;
}

.popup-gallery-section.expanded .gallery-grid-container .gallery-text-cover {
  width: 50px;
  height: 70px;
}

.popup-gallery-section.expanded .gallery-grid-container .gallery-text-title {
  font-size: 13px;
  -webkit-line-clamp: 3;
}

.popup-gallery-section.expanded .gallery-grid-container .gallery-text-author {
  font-size: 12px;
}

/* ==========================================================================
   Popup Links Section
   ========================================================================== */

.popup-links-section {
  flex-shrink: 0;
  margin-top: auto;
  padding-top: 12px;
  display: flex;
  gap: 8px;
  align-items: center;
}

.popup-links-spacer {
  flex: 1;
}

.popup-links-title {
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--text-secondary);
  margin-bottom: 10px;
}

.popup-links-grid {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.popup-link-item {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 36px;
  height: 36px;
  background: var(--bg-inner);
  border: 1px solid var(--border-color);
  border-radius: 6px;
  color: var(--text-secondary);
  text-decoration: none;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
}

.popup-link-item:hover {
  border-color: var(--primary-red);
  background: rgba(192, 32, 35, 0.1);
}

.popup-link-item.wikipedia svg {
  color: var(--text-secondary);
}

.popup-link-item.wikipedia:hover svg {
  color: var(--primary-red);
}

/* Admin button */
.popup-link-item.admin {
  background: rgba(0, 30, 25, 0.4);
  border-color: rgba(0, 60, 50, 0.3);
}

.popup-link-item.admin svg {
  color: rgba(60, 90, 80, 0.6);
}

.popup-link-item.admin:hover {
  background: rgba(0, 45, 38, 0.5);
  border-color: rgba(0, 80, 65, 0.4);
}

.popup-link-item.admin:hover svg {
  color: rgba(80, 120, 105, 0.8);
}

.popup-link-item.admin.active {
  background: rgba(0, 50, 42, 0.6);
  border-color: rgba(0, 90, 75, 0.5);
}

.popup-link-item.admin.active svg {
  color: rgba(90, 130, 115, 0.9);
}

/* ==========================================================================
   Admin Edit Mode
   ========================================================================== */

.popup-admin-edit {
  display: flex;
  flex-direction: column;
  gap: 12px;
  padding: 8px 0;
}

.admin-edit-field {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.admin-edit-field label {
  font-size: 11px;
  font-weight: 500;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.admin-edit-field input,
.admin-edit-field textarea,
.admin-edit-field select {
  background: rgba(0, 0, 0, 0.4);
  border: 1px solid var(--border-color);
  border-radius: 6px;
  padding: 8px 10px;
  font-size: 13px;
  color: var(--text-primary);
  font-family: inherit;
  transition: border-color 0.2s ease, background 0.2s ease;
}

.admin-edit-field input:focus,
.admin-edit-field textarea:focus,
.admin-edit-field select:focus {
  outline: none;
  border-color: rgba(255, 165, 0, 0.5);
  background: rgba(0, 0, 0, 0.5);
}

.admin-edit-field textarea {
  resize: vertical;
  min-height: 60px;
}

.admin-edit-field select {
  cursor: pointer;
}

.admin-edit-row {
  display: flex;
  gap: 12px;
}

.admin-edit-row .admin-edit-field {
  flex: 1;
}

.admin-edit-error {
  padding: 8px 12px;
  background: rgba(239, 68, 68, 0.15);
  border: 1px solid rgba(239, 68, 68, 0.3);
  border-radius: 6px;
  color: #ef4444;
  font-size: 12px;
}

.admin-edit-actions {
  display: flex;
  gap: 8px;
  justify-content: flex-end;
  padding-top: 8px;
  border-top: 1px solid var(--border-color);
  margin-top: 4px;
}

.admin-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
}

.admin-btn.cancel {
  background: transparent;
  border: 1px solid var(--border-color);
  color: var(--text-secondary);
}

.admin-btn.cancel:hover {
  background: rgba(255, 255, 255, 0.05);
  border-color: var(--text-secondary);
  color: var(--text-primary);
}

.admin-btn.save {
  background: rgba(255, 165, 0, 0.15);
  border: 1px solid rgba(255, 165, 0, 0.4);
  color: #ffa500;
}

.admin-btn.save:hover {
  background: rgba(255, 165, 0, 0.25);
  border-color: rgba(255, 165, 0, 0.6);
}

.admin-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* ==========================================================================
   View Tabs (Satellite / Ancient Maps)
   ========================================================================== */

.view-tabs {
  display: flex;
  gap: 2px;
  padding: 8px 8px 0 8px;
  background: rgba(0, 15, 20, 0.8);
  border-bottom: 1px solid var(--border-color);
  flex-shrink: 0;
}

.view-tab {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  padding: 10px 16px;
  background: transparent;
  border: 1px solid transparent;
  border-bottom: none;
  border-radius: 6px 6px 0 0;
  color: var(--text-secondary);
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
}

.view-tab:hover {
  color: var(--text-primary);
  background: rgba(255, 255, 255, 0.03);
}

.view-tab.active {
  background: rgba(0, 20, 25, 0.9);
  border-color: var(--border-color);
  color: var(--primary-red);
}

.view-tab svg {
  opacity: 0.7;
}

.view-tab.active svg {
  opacity: 1;
}

.tab-count {
  padding: 2px 6px;
  background: rgba(192, 32, 35, 0.2);
  border-radius: 10px;
  font-size: 10px;
  color: var(--primary-red);
}

/* ==========================================================================
   Ancient Maps Section
   ========================================================================== */

/* Hide inactive map sections */
.popup-maps-side .map-section {
  display: none;
  flex-direction: column;
  flex: 1;
  min-height: 0;
}

.popup-maps-side .map-section.active {
  display: flex;
}

.ancient-maps-section {
  background: rgba(0, 20, 25, 0.9);
}

.artifacts-section {
  background: rgba(0, 20, 25, 0.9);
}

/* Vertical grid scroll for maps */
.ancient-maps-scroll {
  flex: 1;
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  padding: 12px;
  overflow-y: auto;
  overflow-x: hidden;
  align-content: flex-start;
}

/* Responsive columns: minimum 2 per row */
.ancient-maps-scroll.cols-2 .ancient-map-item {
  width: calc(50% - 5px);
  padding-bottom: calc(50% - 5px); /* Square */
}

.ancient-maps-scroll.cols-3 .ancient-map-item {
  width: calc(33.333% - 7px);
  padding-bottom: calc(33.333% - 7px); /* Square */
}

/* Scrollbar styling */
.ancient-maps-scroll::-webkit-scrollbar {
  width: 6px;
}

.ancient-maps-scroll::-webkit-scrollbar-track {
  background: rgba(192, 32, 35, 0.05);
  border-radius: 3px;
}

.ancient-maps-scroll::-webkit-scrollbar-thumb {
  background: rgba(192, 32, 35, 0.3);
  border-radius: 3px;
}

.ancient-maps-scroll::-webkit-scrollbar-thumb:hover {
  background: rgba(192, 32, 35, 0.5);
}

.ancient-map-item {
  position: relative;
  height: 0;
  padding-bottom: 100%; /* 1:1 square */
  border-radius: 8px;
  overflow: hidden;
  cursor: pointer;
  border: 1px solid var(--border-color);
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
  background: rgba(0, 10, 15, 0.5);
}

.ancient-map-item:hover {
  border-color: var(--primary-red);
  box-shadow: 0 0 12px rgba(192, 32, 35, 0.4);
}

.ancient-map-item img {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.ancient-map-overlay {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 24px 10px 8px 10px;
  background: linear-gradient(transparent, rgba(0, 0, 0, 0.9));
  display: flex;
  flex-direction: column;
  gap: 3px;
  opacity: 0.9;
  transition: opacity 0.2s ease;
}

.ancient-map-item:hover .ancient-map-overlay {
  opacity: 1;
}

.ancient-map-date {
  font-size: 12px;
  font-weight: 600;
  color: var(--primary-red);
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
}

.ancient-map-title {
  font-size: 11px;
  color: rgba(255, 255, 255, 0.9);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
}

.ancient-maps-empty {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 12px;
  padding: 40px;
  color: var(--text-secondary);
  text-align: center;
}

.ancient-maps-empty p {
  font-size: 12px;
  margin: 0;
}

.ancient-maps-attribution {
  flex-shrink: 0;
  padding: 8px 12px;
  font-size: 10px;
  color: var(--text-secondary);
  text-align: center;
  border-top: 1px solid var(--border-color);
  background: rgba(0, 10, 15, 0.5);
}

.ancient-maps-attribution a {
  color: var(--primary-red);
  text-decoration: none;
}

.ancient-maps-attribution a:hover {
  text-decoration: underline;
}

/* ==========================================================================
   Map Lightbox with Site Marker
   ========================================================================== */

.map-lightbox-overlay {
  position: fixed;
  inset: 0;
  z-index: 2000;
  background: rgba(0, 0, 0, 0.95);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 40px;
}

.map-lightbox-content {
  position: relative;
  max-width: 95vw;
  max-height: 95vh;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.map-lightbox-image-container {
  position: relative;
  max-width: 100%;
  max-height: calc(95vh - 100px);
  display: flex;
  align-items: center;
  justify-content: center;
}

.map-lightbox-image {
  max-width: 100%;
  max-height: calc(95vh - 100px);
  object-fit: contain;
  border-radius: 4px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
}

.map-lightbox-marker {
  position: absolute;
  transform: translate(-50%, -100%);
  z-index: 10;
  pointer-events: none;
}

.map-lightbox-marker::before {
  content: '';
  display: block;
  width: 20px;
  height: 20px;
  background: var(--primary-red);
  border: 3px solid white;
  border-radius: 50% 50% 50% 0;
  transform: rotate(-45deg);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
}

.map-lightbox-marker::after {
  content: '';
  position: absolute;
  bottom: -4px;
  left: 50%;
  transform: translateX(-50%);
  width: 8px;
  height: 8px;
  background: rgba(192, 32, 35, 0.4);
  border-radius: 50%;
  animation: marker-shadow-pulse 2s ease-out infinite;
}

@keyframes marker-shadow-pulse {
  0% {
    transform: translateX(-50%) scale(1);
    opacity: 0.6;
  }
  100% {
    transform: translateX(-50%) scale(3);
    opacity: 0;
  }
}

.marker-label {
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  margin-bottom: 8px;
  padding: 6px 12px;
  background: rgba(0, 20, 25, 0.95);
  border: 1px solid var(--primary-red);
  border-radius: 4px;
  color: white;
  font-size: 12px;
  font-weight: 500;
  white-space: nowrap;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

.marker-label::after {
  content: '';
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  border: 6px solid transparent;
  border-top-color: var(--primary-red);
}

.map-lightbox-caption {
  margin-top: 16px;
  text-align: center;
  max-width: 800px;
}

.map-lightbox-title {
  font-size: 16px;
  color: white;
  font-weight: 500;
}

.map-lightbox-date {
  color: var(--primary-red);
}

.map-lightbox-creator {
  margin-top: 6px;
  font-size: 13px;
  color: rgba(255, 255, 255, 0.6);
}

.map-lightbox-source {
  display: inline-block;
  margin-top: 10px;
  padding: 6px 14px;
  background: rgba(192, 32, 35, 0.15);
  border: 1px solid rgba(192, 32, 35, 0.3);
  border-radius: 4px;
  color: var(--primary-red);
  font-size: 12px;
  text-decoration: none;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
}

.map-lightbox-source:hover {
  background: rgba(192, 32, 35, 0.25);
  border-color: var(--primary-red);
}

/* ==================== STANDALONE POPUP ==================== */

.standalone-popup-container {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #000810 0%, #001015 50%, #000a10 100%);
  padding: 20px;
  overflow: auto;
}

.standalone-popup-loading,
.standalone-popup-error {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 16px;
  color: var(--text-secondary);
}

.standalone-popup-error h2 {
  color: var(--text-primary);
  font-size: 18px;
  font-weight: 500;
}

.standalone-back-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 10px 20px;
  background: rgba(192, 32, 35, 0.15);
  border: 1px solid rgba(192, 32, 35, 0.3);
  border-radius: 6px;
  color: var(--primary-red);
  text-decoration: none;
  font-size: 14px;
  transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
}

.standalone-back-btn:hover {
  background: rgba(192, 32, 35, 0.25);
  border-color: var(--primary-red);
}

.site-popup.standalone {
  position: relative;
  height: min(90vh, 900px);
  max-height: min(calc(100vh - 40px), 900px);
  margin: 20px auto;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 0 0 1px rgba(0, 180, 180, 0.3);
}

/* =============================================================================
   MOBILE OVERLAY - Desktop Only Message
   ============================================================================= */

.mobile-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, #000000 0%, #0a1520 50%, #000000 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 99999;
  padding: 20px;
}

.mobile-overlay-content {
  text-align: center;
  max-width: 400px;
}

.mobile-logo-main {
  font-family: 'Orbitron', sans-serif;
  font-size: 28px;
  font-weight: 700;
  color: var(--primary-red);
  letter-spacing: 6px;
  margin-bottom: 8px;
  text-shadow:
    0 0 10px rgba(192, 32, 35, 0.5),
    0 0 20px rgba(192, 32, 35, 0.3),
    0 0 30px rgba(192, 32, 35, 0.2);
}

.mobile-logo-sub {
  font-family: 'Orbitron', sans-serif;
  font-size: 14px;
  font-weight: 500;
  color: var(--text-secondary);
  letter-spacing: 8px;
  margin-bottom: 48px;
}

.mobile-message {
  font-size: 18px;
  color: var(--text-primary);
  line-height: 1.6;
  margin-bottom: 24px;
}

.mobile-hint {
  font-size: 14px;
  color: var(--text-secondary);
  line-height: 1.5;
  padding: 16px 24px;
  background: rgba(0, 180, 180, 0.05);
  border: 1px solid rgba(0, 180, 180, 0.2);
  border-radius: 8px;
}

.mobile-actions {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
  margin-top: 24px;
}

.mobile-actions-row {
  display: flex;
  gap: 12px;
}

.mobile-action-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  flex: 1;
  padding: 12px 16px;
  font-family: 'Orbitron', sans-serif;
  font-size: 11px;
  font-weight: 500;
  letter-spacing: 2px;
  text-transform: uppercase;
  text-decoration: none;
  color: var(--primary-red);
  background: transparent;
  border: 1px solid var(--primary-red);
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.mobile-action-btn:hover {
  background: rgba(192, 32, 35, 0.15);
  color: #fff;
  box-shadow: 0 0 15px rgba(192, 32, 35, 0.3);
}

.mobile-action-btn:active {
  transform: scale(0.98);
  background: rgba(192, 32, 35, 0.25);
}

/* ============================================
   Atlas-Style Geographic Labels (CSS2D)
   Elegant cartographic typography
   ============================================ */

.atlas-label {
  font-family: 'Cormorant Garamond', Georgia, serif;
  color: #fff;
  font-weight: 600;
  text-shadow: 0 0 3px #000, 0 0 6px #000, 0 0 10px rgba(0,0,0,0.8);
  white-space: nowrap;
  user-select: none;
  pointer-events: none;
  letter-spacing: 0.2em;
  text-transform: uppercase;
  opacity: 0;
  transition: opacity 0.25s ease-out;
  will-change: opacity;
}

/* No shadows when satellite is off */
.labels-no-satellite .atlas-label {
  text-shadow: none;
}

.atlas-continent {
  font-size: 20px;
  letter-spacing: 0.35em;
}

.atlas-ocean {
  font-size: 18px;
  font-style: italic;
  letter-spacing: 0.4em;
  color: #7ec8e8;
}

.atlas-country {
  font-size: 14px;
  letter-spacing: 0.15em;
}

.atlas-capital {
  font-size: 12px;
  letter-spacing: 0.05em;
  text-transform: none;  /* Normal case, not uppercase */
  font-style: italic;
  color: #b8b8b8;  /* Light gray - below white countries */
}

.atlas-capital.national {
  font-size: 13px;
  font-weight: 600;
  color: #d0d0d0;  /* Lighter gray for national capitals */
}

.atlas-mountain {
  font-size: 11px;
  font-style: italic;
  letter-spacing: 0.12em;
  color: #c0a890;
}

.atlas-desert {
  font-size: 11px;
  font-style: italic;
  letter-spacing: 0.15em;
  color: #d4b070;
}

.atlas-sea {
  font-size: 12px;
  font-style: italic;
  letter-spacing: 0.2em;
  color: #90c8e8;
}

.atlas-city {
  font-size: 9px;
  letter-spacing: 0.03em;
  text-transform: none;  /* Normal case, not uppercase */
  color: #909090;  /* Medium gray - below capitals */
}

.atlas-lake {
  font-size: 11px;
  font-style: italic;
  letter-spacing: 0.12em;
  color: #70d0f8;
}

.atlas-river {
  font-size: 10px;
  font-style: italic;
  letter-spacing: 0.15em;
  color: #90d8f8;
}

/* =============================================================================
   AI AGENT STYLES
   ============================================================================= */

/* AI Agent Button - now icon-only, inherits from .action-btn */
.lyra-btn-icon {
  width: 16px;
  height: 16px;
  flex-shrink: 0;
}

/* PIN Auth Modal */
.pin-modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.85);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10001; /* Higher than connector-status-modal-overlay (10000) */
  padding: 20px;
  animation: fadeIn 0.2s ease;
}

.pin-modal {
  position: relative;
  background: var(--bg-card);
  backdrop-filter: blur(var(--blur-amount));
  -webkit-backdrop-filter: blur(var(--blur-amount));
  border-radius: 8px;
  border: 1px solid var(--border-color);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
  width: 100%;
  max-width: 340px;
  padding: 32px 24px;
  text-align: center;
}

.pin-modal .popup-close {
  position: absolute;
  top: 12px;
  right: 12px;
}

.pin-modal-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 16px;
}

.pin-modal-icon {
  color: var(--primary-red);
  opacity: 0.8;
}

.pin-modal h2 {
  color: var(--text-primary);
  font-size: 20px;
  font-weight: 600;
  margin: 0;
}

.pin-modal-description {
  color: var(--text-secondary);
  font-size: 13px;
  line-height: 1.5;
  margin: 0;
}

.pin-inputs {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin: 8px 0;
}

.pin-digit {
  width: 48px;
  height: 56px;
  background: var(--bg-input);
  border: 2px solid var(--border-color);
  border-radius: 8px;
  color: var(--text-primary);
  font-size: 24px;
  font-weight: 600;
  text-align: center;
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.pin-digit:focus {
  outline: none;
  border-color: var(--primary-red);
  box-shadow: 0 0 0 3px rgba(192, 32, 35, 0.2);
}

.pin-digit.error {
  border-color: var(--primary-red);
  animation: shake 0.3s ease;
}

.pin-digit:disabled {
  opacity: 0.5;
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-4px); }
  75% { transform: translateX(4px); }
}

.pin-error {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  color: var(--primary-red);
  font-size: 13px;
  margin-top: 12px;
  animation: fadeIn 0.2s ease;
}

.pin-error.locked {
  color: #f59e0b;
}

/* Turnstile section in PIN modal */
.pin-turnstile-section {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-bottom: 16px;
}

.pin-turnstile-section .turnstile-container {
  min-height: 65px;
}

.turnstile-verified {
  display: flex;
  align-items: center;
  gap: 6px;
  color: #4ade80;
  font-size: 12px;
  margin-top: 8px;
}

/* Locked state styles */
.pin-input-section.locked label {
  color: rgba(255, 255, 255, 0.4);
}

.pin-digit.locked {
  background: rgba(0, 0, 0, 0.4) !important;
  border-color: rgba(255, 255, 255, 0.1) !important;
  color: rgba(255, 255, 255, 0.3) !important;
  cursor: not-allowed;
}

.pin-digit:disabled:not(.locked) {
  opacity: 0.7;
}

.pin-verifying {
  display: flex;
  align-items: center;
  gap: 8px;
  color: var(--text-secondary);
  font-size: 13px;
}

.pin-spinner {
  width: 16px;
  height: 16px;
  border: 2px solid var(--border-color);
  border-top-color: var(--primary-red);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Enhanced PIN Modal */
.pin-modal-enhanced {
  max-width: 380px;
  padding: 28px 24px;
}

.pin-header {
  text-align: center;
  margin-bottom: 16px;
}

.pin-lyra-icon {
  width: 64px;
  height: 64px;
  border-radius: 50%;
  margin-bottom: 12px;
  object-fit: cover;
}

.pin-header h2 {
  font-size: 20px;
  font-weight: 600;
  color: var(--text-primary);
  margin: 0;
}

/* Admin mode PIN header */
.pin-header.admin {
  padding: 20px 0;
}

.pin-admin-icon {
  color: rgba(255, 255, 255, 0.7);
  margin-bottom: 12px;
}

.pin-admin-subtitle {
  font-size: 13px;
  color: rgba(255, 255, 255, 0.5);
  margin: 8px 0 0 0;
}

.pin-refresh-warning {
  font-size: 11px;
  color: rgba(255, 180, 100, 0.8);
  margin: 6px 0 0 0;
  font-style: italic;
}

.pin-experimental-badge {
  display: inline-block;
  background: linear-gradient(135deg, #ff6b35, #f7931e);
  color: white;
  font-size: 10px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  padding: 4px 10px;
  border-radius: 12px;
  margin-top: 8px;
}

.pin-welcome {
  font-size: 13px;
  color: rgba(255, 255, 255, 0.7);
  text-align: center;
  margin: 0 0 12px 0;
  line-height: 1.4;
}

.pin-fair-use {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 20px;
}

.pin-tagline {
  font-size: 14px;
  color: rgba(255, 255, 255, 0.9);
  text-align: center;
  margin: 0 0 12px 0;
  font-weight: 500;
}

.pin-rules {
  list-style: none;
  padding: 0;
  margin: 0;
  font-size: 13px;
  color: rgba(255, 255, 255, 0.6);
  text-align: left;
}

.pin-rules li {
  padding: 4px 0;
  padding-left: 16px;
  position: relative;
  text-align: left;
}

.pin-rules li::before {
  content: "\2022";
  position: absolute;
  left: 0;
  color: var(--primary-red);
}

.pin-input-section {
  margin-bottom: 20px;
}

.pin-input-section label {
  display: block;
  text-align: center;
  font-size: 13px;
  color: rgba(255, 255, 255, 0.6);
  margin-bottom: 12px;
}

.pin-capacity-error {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  color: #fbbf24;
  font-size: 13px;
  text-align: center;
  margin-top: 12px;
  animation: fadeIn 0.2s ease;
}

.pin-discord {
  text-align: center;
  padding-top: 20px;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.pin-discord p {
  font-size: 13px;
  color: rgba(255, 255, 255, 0.5);
  margin: 0 0 12px 0;
}

.pin-discord-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 10px 20px;
  background: #5865F2;
  color: white;
  border-radius: 8px;
  text-decoration: none;
  font-size: 14px;
  font-weight: 500;
  transition: background 0.2s;
}

.pin-discord-btn:hover {
  background: #4752c4;
}

/* Queue Waiting UI */
.queue-waiting {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  padding: 16px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 8px;
  margin: 12px 16px;
  animation: fadeIn 0.2s ease;
}

.queue-spinner {
  width: 16px;
  height: 16px;
  border: 2px solid rgba(255, 255, 255, 0.2);
  border-top-color: var(--primary-red);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

.queue-position {
  color: var(--primary-red);
  font-weight: 600;
}

/* AI Chat Modal */
.ai-chat-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1001;
  padding: 20px;
  animation: fadeIn 0.2s ease;
}

.ai-chat-modal {
  position: relative;
  background: var(--bg-card);
  backdrop-filter: blur(var(--blur-amount));
  -webkit-backdrop-filter: blur(var(--blur-amount));
  border-radius: 8px;
  border: 1px solid var(--border-color);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
  width: 100%;
  max-width: 600px;
  height: 70vh;
  max-height: 700px;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.ai-chat-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 20px;
  border-bottom: 1px solid var(--border-color);
  background: rgba(192, 32, 35, 0.05);
}

.ai-chat-title {
  display: flex;
  align-items: center;
  gap: 10px;
  color: var(--text-primary);
  font-size: 15px;
  font-weight: 600;
}

.ai-chat-title svg {
  color: var(--primary-red);
}

/* Lyra image styles */
.lyra-header-icon {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  object-fit: cover;
}

.lyra-disclaimer {
  font-size: 11px;
  color: rgba(255, 255, 255, 0.5);
  font-weight: 400;
  margin-left: 4px;
}

.lyra-welcome-image {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid rgba(192, 32, 35, 0.4);
  box-shadow: 0 4px 20px rgba(192, 32, 35, 0.3);
}

.lyra-avatar {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  object-fit: cover;
}

/* Header actions */
.ai-chat-header-actions {
  display: flex;
  align-items: center;
  gap: 8px;
}

.source-toggle-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 6px 10px;
  background: rgba(192, 32, 35, 0.1);
  border: 1px solid rgba(192, 32, 35, 0.2);
  border-radius: 4px;
  color: var(--text-secondary);
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s;
}

.source-toggle-btn:hover,
.source-toggle-btn.active {
  background: rgba(192, 32, 35, 0.2);
  color: var(--text-primary);
  border-color: rgba(192, 32, 35, 0.4);
}

.source-toggle-btn svg {
  opacity: 0.7;
}

/* Mode Toggle */
.ai-mode-toggle {
  display: flex;
  gap: 4px;
  background: rgba(0, 0, 0, 0.2);
  padding: 4px;
  border-radius: 8px;
}

.mode-btn {
  padding: 6px 12px;
  border: none;
  background: transparent;
  color: rgba(255, 255, 255, 0.6);
  border-radius: 6px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 13px;
  transition: all 0.2s;
}

.mode-btn:hover {
  background: rgba(255, 255, 255, 0.1);
  color: rgba(255, 255, 255, 0.9);
}

.mode-btn.active {
  background: var(--primary-red);
  color: white;
}

.mode-btn svg {
  opacity: 0.8;
}

.mode-btn.active svg {
  opacity: 1;
}

.mode-btn:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.mode-btn:disabled:hover {
  background: transparent;
  color: rgba(255, 255, 255, 0.6);
}

.mode-btn.active:disabled {
  opacity: 1;
  cursor: default;
}

/* Model Indicator */
.model-indicator {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 11px;
  color: rgba(255, 255, 255, 0.5);
  padding: 4px 8px;
  background: rgba(0, 0, 0, 0.2);
  border-radius: 4px;
}

.model-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: #4ade80;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.model-name {
  max-width: 100px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* New Conversation Button */
.new-conversation-btn {
  display: flex;
  align-items: center;
  gap: 5px;
  padding: 5px 10px;
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 4px;
  color: rgba(255, 255, 255, 0.7);
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s;
}

.new-conversation-btn:hover {
  background: rgba(255, 255, 255, 0.2);
  color: white;
  border-color: rgba(255, 255, 255, 0.3);
}

.new-conversation-btn svg {
  opacity: 0.8;
}

/* Mode description in welcome */
.mode-description {
  color: rgba(255, 255, 255, 0.7);
  font-size: 13px;
  margin-bottom: 12px;
  padding: 8px 12px;
  background: rgba(192, 32, 35, 0.1);
  border-radius: 6px;
  border-left: 3px solid var(--primary-red);
}

/* Source selector dropdown */
.source-selector {
  padding: 12px 16px;
  background: rgba(192, 32, 35, 0.05);
  border-bottom: 1px solid var(--border-color);
}

.source-selector-title {
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  color: var(--text-secondary);
  margin-bottom: 8px;
  letter-spacing: 0.5px;
}

.source-option {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 8px;
  margin: 2px 0;
  border-radius: 4px;
  cursor: pointer;
  font-size: 13px;
  color: var(--text-primary);
  transition: background 0.2s;
}

.source-option:hover {
  background: rgba(192, 32, 35, 0.1);
}

.source-option input[type="checkbox"] {
  accent-color: var(--primary-red);
  width: 14px;
  height: 14px;
}

.source-badge {
  font-size: 10px;
  padding: 2px 6px;
  background: rgba(192, 32, 35, 0.2);
  color: var(--primary-red);
  border-radius: 4px;
  margin-left: auto;
}

.ai-chat-messages {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 16px;
}

/* Welcome screen */
.ai-chat-welcome {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: 40px 20px;
  gap: 16px;
  flex: 1;
}

.ai-chat-welcome .welcome-icon {
  color: var(--primary-red);
  opacity: 0.6;
}

.ai-chat-welcome h3 {
  color: var(--text-primary);
  font-size: 18px;
  font-weight: 600;
  margin: 0;
}

.ai-chat-welcome p {
  color: var(--text-secondary);
  font-size: 13px;
  margin: 0;
  line-height: 1.5;
}

.example-queries {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-top: 8px;
  width: 100%;
  max-width: 320px;
}

.example-query {
  padding: 10px 14px;
  background: var(--bg-input);
  border: 1px solid var(--border-color);
  border-radius: 8px;
  color: var(--text-secondary);
  font-size: 12px;
  text-align: left;
  cursor: pointer;
  transition: background 0.2s ease, border-color 0.2s ease, color 0.2s ease;
}

.example-query:hover {
  background: rgba(192, 32, 35, 0.1);
  border-color: var(--primary-red);
  color: var(--text-primary);
}

/* Chat messages */
.ai-chat-message {
  display: flex;
  gap: 12px;
  animation: fadeIn 0.2s ease;
}

.ai-chat-message.user {
  flex-direction: row-reverse;
}

.message-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: var(--bg-input);
  border: 1px solid var(--border-color);
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-secondary);
  flex-shrink: 0;
}

.ai-chat-message.user .message-avatar {
  background: rgba(192, 32, 35, 0.15);
  border-color: var(--primary-red);
  color: var(--primary-red);
}

.ai-chat-message.assistant .message-avatar {
  background: rgba(0, 180, 180, 0.1);
  border-color: rgba(0, 180, 180, 0.3);
}

.message-body {
  flex: 1;
  max-width: calc(100% - 44px);
}

.message-content {
  padding: 12px 16px;
  border-radius: 12px;
  font-size: 13px;
  line-height: 1.6;
  color: var(--text-primary);
}

.ai-chat-message.user .message-content {
  background: rgba(192, 32, 35, 0.1);
  border: 1px solid rgba(192, 32, 35, 0.2);
  border-bottom-right-radius: 4px;
}

.ai-chat-message.assistant .message-content {
  background: rgba(0, 180, 180, 0.1);
  border: 1px solid rgba(0, 180, 180, 0.2);
  border-bottom-left-radius: 4px;
}

.cursor-blink {
  animation: blink 1s step-end infinite;
}

@keyframes blink {
  50% { opacity: 0; }
}

/* Sites found section */
.message-sites {
  margin-top: 10px;
  padding: 12px;
  background: rgba(192, 32, 35, 0.05);
  border: 1px solid rgba(192, 32, 35, 0.2);
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}

.sites-header {
  display: flex;
  align-items: center;
  gap: 6px;
  color: var(--primary-red);
  font-size: 12px;
  font-weight: 500;
}

.highlight-sites-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 12px;
  background: var(--primary-red);
  border: none;
  border-radius: 4px;
  color: white;
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  transition: background 0.2s ease, transform 0.1s ease;
}

.highlight-sites-btn:hover {
  background: var(--primary-red-hover);
}

.highlight-sites-btn:active {
  transform: scale(0.98);
}

/* Typing indicator */
.ai-typing-indicator {
  display: flex;
  gap: 4px;
  padding: 12px 16px;
  margin-left: 44px;
}

.ai-typing-indicator span {
  width: 8px;
  height: 8px;
  background: var(--primary-red);
  border-radius: 50%;
  animation: typing 1.4s ease-in-out infinite;
}

.ai-typing-indicator span:nth-child(2) {
  animation-delay: 0.2s;
}

.ai-typing-indicator span:nth-child(3) {
  animation-delay: 0.4s;
}

@keyframes typing {
  0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
  30% { transform: translateY(-4px); opacity: 1; }
}

/* Chat input */
.ai-chat-input-container {
  display: flex;
  gap: 10px;
  padding: 16px 20px;
  border-top: 1px solid var(--border-color);
  background: var(--bg-card);
}

.ai-chat-input {
  flex: 1;
  padding: 12px 16px;
  background: var(--bg-input);
  border: 1px solid var(--border-color);
  border-radius: 8px;
  color: var(--text-primary);
  font-size: 13px;
  transition: border-color 0.2s ease;
}

.ai-chat-input:focus {
  outline: none;
  border-color: var(--primary-red);
}

.ai-chat-input::placeholder {
  color: var(--text-muted);
}

.ai-chat-input:disabled {
  opacity: 0.6;
}

.ai-chat-send {
  width: 44px;
  height: 44px;
  background: var(--primary-red);
  border: none;
  border-radius: 4px;
  color: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.2s ease, transform 0.1s ease;
}

.ai-chat-send:hover:not(:disabled) {
  background: var(--primary-red-hover);
}

.ai-chat-send:active:not(:disabled) {
  transform: scale(0.95);
}

.ai-chat-send:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* Hardware Acceleration Warning Banner */
.hardware-warning-banner {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 10000;
  background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
  color: white;
  padding: 10px 20px;
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 14px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

.hardware-warning-banner .warning-icon {
  font-size: 18px;
}

.hardware-warning-banner .warning-text {
  flex: 1;
}

.hardware-warning-banner a {
  color: white;
  text-decoration: underline;
  margin-left: 8px;
}

.hardware-warning-banner a:hover {
  opacity: 0.9;
}

.hardware-warning-banner .warning-dismiss {
  background: none;
  border: none;
  color: white;
  font-size: 18px;
  cursor: pointer;
  padding: 4px 8px;
  opacity: 0.8;
  transition: opacity 0.15s ease;
}

.hardware-warning-banner .warning-dismiss:hover {
  opacity: 1;
}

/* Popup Hero Loading Shimmer */
.popup-hero-loading {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgb(0, 20, 30);
  overflow: hidden;
}

.popup-hero-shimmer {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.03) 50%, transparent 100%);
  animation: shimmer 1.5s infinite;
}

@keyframes shimmer {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

/* =========================================================================
   EMPIRE SESHAT DATA SECTIONS
   Rich historical data display for empire popups
   ========================================================================= */

.empire-seshat-content {
  display: flex;
  flex-direction: column;
  gap: 16px;
  padding: 12px 0;
}

/* Hide all scrollbars in empire content */
.empire-seshat-content *::-webkit-scrollbar {
  display: none;
}

.empire-seshat-content * {
  -ms-overflow-style: none;
  scrollbar-width: none;
}

/* Section Base Styles */
.empire-section {
  background: rgba(0, 30, 40, 0.4);
  border: 1px solid rgba(0, 180, 180, 0.15);
  border-radius: 8px;
  padding: 14px;
}

.empire-section-title {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  font-weight: 600;
  color: rgba(255, 255, 255, 0.95);
  margin-bottom: 12px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.empire-section-title svg {
  color: var(--primary-red);
  opacity: 0.9;
}

.empire-subsection-title {
  font-size: 11px;
  font-weight: 600;
  color: rgba(255, 255, 255, 0.6);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin: 14px 0 8px;
}

/* Stats Section */
.empire-stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
  gap: 6px;
}

.empire-stat-card {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
  padding: 8px 6px;
  background: rgba(0, 50, 60, 0.3);
  border: 1px solid rgba(0, 180, 180, 0.1);
  border-radius: 4px;
  text-align: center;
}

.empire-stat-icon {
  color: var(--primary-red);
  opacity: 0.8;
}

.empire-stat-value {
  font-size: 12px;
  font-weight: 600;
  color: rgba(255, 255, 255, 0.95);
}

.empire-stat-label {
  font-size: 9px;
  color: rgba(255, 255, 255, 0.5);
  text-transform: uppercase;
  letter-spacing: 0.3px;
}

/* Hierarchy Grid */
.empire-hierarchy-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
  gap: 8px;
}

.empire-hierarchy-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 10px;
  background: rgba(0, 50, 60, 0.25);
  border-radius: 4px;
}

.empire-hierarchy-label {
  font-size: 11px;
  color: rgba(255, 255, 255, 0.6);
}

.empire-hierarchy-value {
  font-size: 14px;
  font-weight: 600;
  color: var(--primary-red);
}

/* Tags (used across sections) */
.empire-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.empire-tag {
  display: inline-flex;
  align-items: center;
  padding: 4px 10px;
  font-size: 11px;
  font-weight: 500;
  border-radius: 12px;
  white-space: nowrap;
}

.empire-tag-infrastructure {
  background: rgba(0, 150, 136, 0.2);
  color: rgba(0, 200, 180, 0.9);
  border: 1px solid rgba(0, 150, 136, 0.3);
}

.empire-tag-fortification {
  background: rgba(120, 85, 72, 0.25);
  color: rgba(200, 170, 150, 0.95);
  border: 1px solid rgba(120, 85, 72, 0.4);
}

.empire-tag-weapon {
  background: rgba(192, 32, 35, 0.15);
  color: rgba(255, 100, 100, 0.95);
  border: 1px solid rgba(192, 32, 35, 0.35);
}

.empire-tag-armor {
  background: rgba(96, 125, 139, 0.25);
  color: rgba(176, 190, 197, 0.95);
  border: 1px solid rgba(96, 125, 139, 0.4);
}

.empire-tag-animal {
  background: rgba(139, 69, 19, 0.25);
  color: rgba(210, 160, 120, 0.95);
  border: 1px solid rgba(139, 69, 19, 0.4);
}

.empire-tag-naval {
  background: rgba(33, 150, 243, 0.2);
  color: rgba(100, 180, 255, 0.95);
  border: 1px solid rgba(33, 150, 243, 0.35);
}

.empire-tag-language {
  background: rgba(156, 39, 176, 0.2);
  color: rgba(200, 130, 210, 0.95);
  border: 1px solid rgba(156, 39, 176, 0.35);
}

.empire-tag-religion {
  background: rgba(255, 193, 7, 0.2);
  color: rgba(255, 215, 100, 0.95);
  border: 1px solid rgba(255, 193, 7, 0.35);
}

.empire-tag-info {
  background: rgba(0, 188, 212, 0.15);
  color: rgba(100, 220, 230, 0.95);
  border: 1px solid rgba(0, 188, 212, 0.3);
}

.empire-tag-monetary {
  background: rgba(255, 152, 0, 0.2);
  color: rgba(255, 190, 100, 0.95);
  border: 1px solid rgba(255, 152, 0, 0.35);
}

.empire-tag-trade {
  background: rgba(76, 175, 80, 0.2);
  color: rgba(130, 210, 140, 0.95);
  border: 1px solid rgba(76, 175, 80, 0.35);
}

/* Warfare Section */
.empire-warfare-content {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.empire-warfare-category {
  padding: 10px;
  background: rgba(0, 40, 50, 0.3);
  border-radius: 6px;
}

.empire-warfare-category-header {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 11px;
  font-weight: 600;
  color: rgba(255, 255, 255, 0.7);
  text-transform: uppercase;
  letter-spacing: 0.3px;
  margin-bottom: 8px;
}

.empire-warfare-category-header svg {
  color: var(--primary-red);
  opacity: 0.7;
}

/* Social Section */
.empire-social-content {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.empire-social-row {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.empire-social-label {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 11px;
  font-weight: 600;
  color: rgba(255, 255, 255, 0.6);
  text-transform: uppercase;
  letter-spacing: 0.3px;
}

.empire-social-label svg {
  color: var(--primary-red);
  opacity: 0.7;
}

.empire-centralization-badge {
  display: flex;
}

.empire-centralization {
  display: inline-flex;
  padding: 6px 14px;
  font-size: 12px;
  font-weight: 600;
  border-radius: 4px;
  background: rgba(0, 50, 60, 0.4);
  color: rgba(255, 255, 255, 0.9);
  border: 1px solid rgba(0, 180, 180, 0.2);
}

.empire-centralization-unitary-state {
  background: rgba(76, 175, 80, 0.2);
  color: rgba(130, 210, 140, 0.95);
  border-color: rgba(76, 175, 80, 0.35);
}

.empire-centralization-loose {
  background: rgba(255, 193, 7, 0.2);
  color: rgba(255, 215, 100, 0.95);
  border-color: rgba(255, 193, 7, 0.35);
}

.empire-centralization-nominal {
  background: rgba(255, 152, 0, 0.2);
  color: rgba(255, 190, 100, 0.95);
  border-color: rgba(255, 152, 0, 0.35);
}

.empire-centralization-none {
  background: rgba(158, 158, 158, 0.2);
  color: rgba(200, 200, 200, 0.9);
  border-color: rgba(158, 158, 158, 0.35);
}

/* Economy Section */
.empire-economy-content {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.empire-economy-category {
  padding: 10px;
  background: rgba(0, 40, 50, 0.3);
  border-radius: 6px;
}

.empire-economy-category-header {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 11px;
  font-weight: 600;
  color: rgba(255, 255, 255, 0.7);
  text-transform: uppercase;
  letter-spacing: 0.3px;
  margin-bottom: 8px;
}

.empire-economy-category-header svg {
  color: var(--primary-red);
  opacity: 0.7;
}

/* Crisis Section */
.empire-crisis-list {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.empire-crisis-item {
  padding: 12px;
  background: rgba(0, 40, 50, 0.3);
  border-radius: 6px;
  border-left: 3px solid rgba(255, 193, 7, 0.5);
}

.empire-crisis-item.empire-crisis-catastrophic {
  border-left-color: rgba(244, 67, 54, 0.7);
}

.empire-crisis-item.empire-crisis-severe {
  border-left-color: rgba(255, 152, 0, 0.7);
}

.empire-crisis-item.empire-crisis-moderate {
  border-left-color: rgba(255, 193, 7, 0.7);
}

.empire-crisis-item.empire-crisis-minor {
  border-left-color: rgba(76, 175, 80, 0.5);
}

.empire-crisis-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 6px;
}

.empire-crisis-icon {
  color: var(--primary-red);
  opacity: 0.8;
  display: flex;
  align-items: center;
}

.empire-crisis-name {
  font-size: 13px;
  font-weight: 600;
  color: rgba(255, 255, 255, 0.95);
  flex: 1;
}

.empire-crisis-dates {
  font-size: 11px;
  color: rgba(255, 255, 255, 0.5);
  white-space: nowrap;
}

.empire-crisis-description {
  font-size: 12px;
  color: rgba(255, 255, 255, 0.7);
  line-height: 1.5;
  margin-bottom: 8px;
}

.empire-crisis-meta {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.empire-crisis-type {
  font-size: 10px;
  padding: 3px 8px;
  background: rgba(0, 60, 70, 0.4);
  border-radius: 10px;
  color: rgba(255, 255, 255, 0.6);
  text-transform: capitalize;
}

.empire-crisis-severity {
  font-size: 10px;
  padding: 3px 8px;
  border-radius: 10px;
  text-transform: capitalize;
  font-weight: 600;
}

.empire-crisis-severity.empire-crisis-catastrophic {
  background: rgba(244, 67, 54, 0.2);
  color: rgba(255, 100, 100, 0.95);
}

.empire-crisis-severity.empire-crisis-severe {
  background: rgba(255, 152, 0, 0.2);
  color: rgba(255, 190, 100, 0.95);
}

.empire-crisis-severity.empire-crisis-moderate {
  background: rgba(255, 193, 7, 0.2);
  color: rgba(255, 215, 100, 0.95);
}

.empire-crisis-severity.empire-crisis-minor {
  background: rgba(76, 175, 80, 0.2);
  color: rgba(130, 210, 140, 0.95);
}

/* Transitions List */
.empire-transitions-list {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.empire-transition-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 10px;
  background: rgba(0, 40, 50, 0.3);
  border-radius: 4px;
  font-size: 12px;
}

.empire-transition-year {
  font-weight: 600;
  color: var(--primary-red);
  min-width: 80px;
}

.empire-transition-type {
  color: rgba(255, 255, 255, 0.6);
  text-transform: capitalize;
}

.empire-transition-polities {
  color: rgba(255, 255, 255, 0.8);
  flex: 1;
  text-align: right;
}

/* Succession Section */
.empire-succession-content {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

.empire-succession-group {
  padding: 10px;
  background: rgba(0, 40, 50, 0.3);
  border-radius: 6px;
}

.empire-succession-label {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 11px;
  font-weight: 600;
  color: rgba(255, 255, 255, 0.6);
  text-transform: uppercase;
  letter-spacing: 0.3px;
  margin-bottom: 8px;
}

.empire-succession-label svg {
  color: var(--primary-red);
  opacity: 0.7;
}

.empire-succession-list {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.empire-succession-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 10px;
  background: rgba(0, 50, 60, 0.3);
  border-radius: 4px;
}

.empire-succession-relation {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 10px;
  color: rgba(255, 255, 255, 0.5);
  text-transform: capitalize;
  min-width: 80px;
}

.empire-succession-relation svg {
  color: var(--primary-red);
  opacity: 0.6;
}

.empire-succession-name {
  font-size: 12px;
  color: rgba(255, 255, 255, 0.9);
  flex: 1;
}

/* Source Attribution */
.empire-source-attribution {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px;
  margin-top: 4px;
  background: rgba(0, 30, 40, 0.3);
  border-radius: 6px;
  font-size: 11px;
}

.empire-source-label {
  color: rgba(255, 255, 255, 0.5);
}

.empire-source-link {
  color: var(--primary-red);
  text-decoration: none;
  transition: opacity 0.15s ease;
}

.empire-source-link:hover {
  opacity: 0.8;
  text-decoration: underline;
}

.empire-source-separator {
  color: rgba(255, 255, 255, 0.3);
}

/* =========================================================================
   EMPIRE SESHAT TABS
   Tabbed navigation for Seshat data sections
   ========================================================================= */

.empire-seshat-tabs {
  display: flex;
  gap: 2px;
  padding: 0 4px;
  margin-bottom: 12px;
  border-bottom: 1px solid rgba(0, 180, 180, 0.15);
}

.empire-seshat-tab {
  flex: 1;
  padding: 10px 8px;
  background: transparent;
  border: none;
  border-bottom: 2px solid transparent;
  color: rgba(255, 255, 255, 0.5);
  font-size: 11px;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.3px;
  cursor: pointer;
  transition: all 0.2s ease;
  white-space: nowrap;
}

.empire-seshat-tab:hover {
  color: rgba(255, 255, 255, 0.75);
  background: rgba(0, 180, 180, 0.05);
}

.empire-seshat-tab.active {
  color: var(--primary-red);
  border-bottom-color: var(--primary-red);
  background: rgba(192, 32, 35, 0.08);
}

.empire-seshat-tab-content {
  min-height: 100px;
}

/* =========================================================================
   EMPIRE OVERVIEW TAB
   Wikipedia description and loading states
   ========================================================================= */

.empire-overview-content {
  padding: 4px;
}

.empire-wiki-description {
  font-size: 13px;
  line-height: 1.6;
  color: rgba(255, 255, 255, 0.85);
  margin: 0 0 12px 0;
}

.empire-wikipedia-link {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  font-size: 12px;
  color: var(--primary-red);
  text-decoration: none;
  transition: opacity 0.15s ease;
}

.empire-wikipedia-link:hover {
  opacity: 0.8;
  text-decoration: underline;
}

.empire-loading {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  padding: 32px;
  color: rgba(255, 255, 255, 0.5);
  font-size: 12px;
}

.empire-loading-spinner {
  width: 18px;
  height: 18px;
  border: 2px solid rgba(255, 255, 255, 0.1);
  border-top-color: var(--primary-red);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

.empire-no-description {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 32px;
  color: rgba(255, 255, 255, 0.4);
  font-size: 12px;
  font-style: italic;
}

.empire-no-data {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
  padding: 16px;
  color: rgba(255, 255, 255, 0.4);
  font-size: 12px;
  font-style: italic;
}

.empire-no-data-title {
  font-style: normal;
  color: rgba(255, 255, 255, 0.6);
  font-size: 11px;
}

.empire-available-periods {
  display: flex;
  flex-direction: column;
  gap: 6px;
  width: 100%;
}

.empire-period-btn {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 12px;
  background: rgba(0, 50, 60, 0.4);
  border: 1px solid rgba(0, 180, 180, 0.2);
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.empire-period-btn:hover {
  background: rgba(0, 80, 90, 0.5);
  border-color: var(--primary-red);
}

.empire-period-name {
  font-style: normal;
  font-size: 12px;
  font-weight: 500;
  color: rgba(255, 255, 255, 0.85);
}

.empire-period-years {
  font-style: normal;
  font-size: 10px;
  color: rgba(255, 255, 255, 0.5);
}

/* =========================================================================
   EMPIRE PERIOD SLIDER
   Time period selector in empire minimap section
   ========================================================================= */

.empire-period-slider {
  padding: 12px 16px;
  background: rgba(0, 20, 30, 0.8);
  border-top: 1px solid rgba(0, 180, 180, 0.15);
}

.empire-period-slider-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.empire-period-label {
  font-size: 10px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: rgba(255, 255, 255, 0.5);
}

.empire-period-year {
  font-size: 13px;
  font-weight: 600;
  color: var(--primary-red);
}

.empire-period-slider-track {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.empire-period-range {
  -webkit-appearance: none;
  appearance: none;
  width: 100%;
  height: 4px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 2px;
  outline: none;
  cursor: pointer;
}

.empire-period-range::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 14px;
  height: 14px;
  background: var(--primary-red);
  border-radius: 50%;
  cursor: pointer;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}

.empire-period-range::-webkit-slider-thumb:hover {
  transform: scale(1.15);
  box-shadow: 0 0 8px rgba(192, 32, 35, 0.5);
}

.empire-period-range::-moz-range-thumb {
  width: 14px;
  height: 14px;
  background: var(--primary-red);
  border: none;
  border-radius: 50%;
  cursor: pointer;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}

.empire-period-range::-moz-range-thumb:hover {
  transform: scale(1.15);
  box-shadow: 0 0 8px rgba(192, 32, 35, 0.5);
}

.empire-period-ticks {
  display: flex;
  justify-content: space-between;
  font-size: 9px;
  color: rgba(255, 255, 255, 0.4);
}

/* =========================================================================
   EMPIRE PERIOD TIMELINE
   Visual timeline with clickable period segments
   ========================================================================= */

.empire-period-timeline {
  padding: 10px 12px;
  background: rgba(0, 20, 30, 0.6);
  border-top: 1px solid rgba(0, 180, 180, 0.15);
}

/* Empire popup year slider row */
.empire-year-slider-row {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 10px;
}

.empire-popup-year-slider {
  flex: 1;
  height: 4px;
  -webkit-appearance: none;
  appearance: none;
  background: rgba(0, 180, 180, 0.2);
  border-radius: 2px;
  cursor: pointer;
}

.empire-popup-year-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: var(--primary-red);
  cursor: pointer;
  border: 2px solid rgba(255, 255, 255, 0.3);
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);
}

.empire-popup-year-slider::-webkit-slider-thumb:hover {
  transform: scale(1.1);
}

.empire-popup-year-slider::-moz-range-thumb {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: var(--primary-red);
  cursor: pointer;
  border: 2px solid rgba(255, 255, 255, 0.3);
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);
}

.empire-year-slider-row .empire-year-display {
  font-size: 12px;
  font-weight: 500;
  color: rgba(255, 255, 255, 0.8);
  min-width: 70px;
  text-align: right;
  white-space: nowrap;
}

.empire-period-segments {
  display: flex;
  gap: 2px;
}

.empire-period-segment {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding: 8px 6px;
  background: transparent;
  border: none;
  border-bottom: 2px solid transparent;
  cursor: pointer;
  transition: all 0.2s ease;
  overflow: hidden;
  min-width: 0;
  font-family: inherit;
}

.empire-period-segment:hover {
  background: rgba(0, 180, 180, 0.08);
}

.empire-period-segment.active {
  background: rgba(192, 32, 35, 0.12);
  border-bottom-color: var(--primary-red);
}

.empire-period-segment .segment-name {
  font-size: 10px;
  font-weight: 500;
  color: rgba(255, 255, 255, 0.6);
  text-align: center;
  line-height: 1.3;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100%;
  text-transform: uppercase;
  letter-spacing: 0.3px;
}

.empire-period-segment .segment-years {
  font-size: 9px;
  color: rgba(255, 255, 255, 0.4);
  margin-top: 3px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100%;
}

.empire-period-segment:hover .segment-name {
  color: rgba(255, 255, 255, 0.85);
}

.empire-period-segment:hover .segment-years {
  color: rgba(255, 255, 255, 0.6);
}

.empire-period-segment.active .segment-name {
  color: var(--primary-red);
}

.empire-period-segment.active .segment-years {
  color: rgba(255, 255, 255, 0.7);
}

/* =============================================================================
   News Feed Panel - slides in from right edge
   ============================================================================= */

.news-feed-panel {
  position: fixed;
  top: 0;
  right: 0;
  z-index: 150;
  width: 340px;
  height: 100vh;
  display: flex;
  flex-direction: column;
  background: var(--bg-card-solid);
  backdrop-filter: blur(var(--blur-amount));
  -webkit-backdrop-filter: blur(var(--blur-amount));
  border-left: 1px solid var(--border-color);
  overflow: hidden;
  animation: news-feed-slide-in 0.25s ease-out;
}

@keyframes news-feed-slide-in {
  from { transform: translateX(100%); }
  to { transform: translateX(0); }
}

/* Shift globe center when news feed is docked (half of panel width) */
body.news-feed-open .globe-container,
body.news-feed-open .mapbox-globe-container {
  transform: translateX(-170px);
}

/* Shift right-side UI elements left when news feed is open */
body.news-feed-open .info-panel-top-right {
  right: 360px;
  transition: right 0.25s ease-out;
}

body.news-feed-open .social-contribute-wrapper {
  right: calc(360px + 172px * var(--hud-scale, 1));
  transition: right 0.25s ease-out;
}

body.news-feed-open .zoom-slider-top {
  right: 360px;
}

body.news-feed-open .layer-toggle-panel {
  right: calc(360px + 72px * var(--hud-scale, 1));
}

body.news-feed-open .historical-borders-panel {
  right: calc(360px + 72px * var(--hud-scale, 1) + 192px);
}

body.news-feed-open .empire-borders-window {
  right: calc(360px + 264px * var(--hud-scale, 1));
}

/* Tooltip offset is applied via globeOffsetX prop in JS to avoid jump during transition */

.news-feed-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 16px;
  border-bottom: 1px solid var(--border-color);
  flex-shrink: 0;
}

.news-feed-title {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  font-weight: 600;
  color: var(--text-primary);
  letter-spacing: 0.5px;
}

.news-feed-title svg {
  color: var(--primary-red);
  opacity: 0.8;
}

.news-feed-badge {
  background: rgba(192, 32, 35, 0.2);
  color: var(--primary-red);
  font-size: 9px;
  font-weight: 500;
  padding: 2px 6px;
  border-radius: 3px;
  min-width: 18px;
  text-align: center;
}

.news-feed-live {
  margin-left: auto;
  display: flex;
  align-items: center;
  gap: 4px;
}
.news-feed-live-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: #00cc66;
  box-shadow: 0 0 6px rgba(0, 204, 102, 0.6);
  animation: news-live-pulse 2s ease infinite;
}
.news-feed-live.offline .news-feed-live-dot {
  background: #666;
  box-shadow: none;
  animation: none;
}
.news-feed-live-text {
  font-family: 'Orbitron', sans-serif;
  font-size: 9px;
  font-weight: 700;
  letter-spacing: 1.5px;
  color: #00cc66;
}
.news-feed-live.offline .news-feed-live-text {
  color: #666;
}

.news-feed-actions {
  display: flex;
  gap: 4px;
}

.news-feed-btn {
  background: transparent;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  padding: 4px;
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: color 0.2s, background 0.2s;
}

.news-feed-btn:hover {
  color: var(--text-primary);
  background: rgba(255, 255, 255, 0.05);
}

.news-feed-content {
  overflow-y: auto;
  flex: 1;
  min-height: 0;
}

.news-feed-item {
  padding: 12px 16px;
  border-bottom: 1px solid rgba(0, 180, 180, 0.08);
  cursor: pointer;
  transition: background 0.15s;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.news-feed-item:hover {
  background: rgba(255, 255, 255, 0.03);
}

.news-feed-item.expanded {
  background: rgba(0, 30, 35, 0.3);
}

/* ======= Shared news card content (used by both page & sidebar) ======= */

.news-card-meta {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 11px;
  color: var(--text-secondary, rgba(255, 255, 255, 0.5));
}

.news-card-channel {
  color: var(--primary-red, #c02023);
  opacity: 0.8;
}

.news-card-post-text {
  font-size: 14px;
  color: rgba(232, 232, 232, 0.85);
  line-height: 1.5;
  transition: color 0.3s ease;
}

.news-card-thumb {
  display: block;
  position: relative;
  width: 100%;
  aspect-ratio: 16 / 9;
  overflow: hidden;
  border-radius: 8px;
}

.news-card-thumb img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.news-card-thumb::before {
  content: '';
  position: absolute;
  inset: 0;
  background: rgba(0, 15, 20, 0.35);
  z-index: 1;
  pointer-events: none;
  transition: opacity 0.3s ease;
}

.news-card-play {
  position: absolute;
  top: 50%;
  left: 50%;
  z-index: 2;
  transform: translate(-50%, -50%);
  color: rgba(255, 255, 255, 0.8);
  filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.5));
  opacity: 0;
  transition: opacity 0.2s;
}

.news-card-thumb:hover .news-card-play {
  opacity: 1;
}

.news-card-duration {
  position: absolute;
  bottom: 6px;
  right: 6px;
  z-index: 2;
  background: rgba(0, 0, 0, 0.85);
  color: #fff;
  font-size: 11px;
  font-weight: 600;
  padding: 1px 5px;
  border-radius: 3px;
  letter-spacing: 0.3px;
  line-height: 1.4;
  font-variant-numeric: tabular-nums;
}

.news-card-timestamp {
  position: absolute;
  bottom: 6px;
  left: 6px;
  z-index: 2;
  background: #8a1618;
  color: #fff;
  font-size: 11px;
  font-weight: 600;
  padding: 1px 5px;
  border-radius: 3px;
  letter-spacing: 0.3px;
  line-height: 1.4;
  font-variant-numeric: tabular-nums;
}

.news-card-expanded {
  margin-top: 10px;
  padding-top: 10px;
  border-top: 1px solid rgba(0, 180, 180, 0.08);
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.news-card-facts {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.news-card-facts li {
  font-size: 11px;
  color: rgba(255, 255, 255, 0.6);
  padding-left: 12px;
  position: relative;
  line-height: 1.4;
}

.news-card-facts li::before {
  content: '';
  position: absolute;
  left: 0;
  top: 6px;
  width: 4px;
  height: 4px;
  border-radius: 50%;
  background: var(--primary-red, #c02023);
  opacity: 0.5;
}

.news-card-watch {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 11px;
  color: var(--primary-red, #c02023);
  text-decoration: none;
  padding: 6px 12px;
  border: 1px solid rgba(192, 32, 35, 0.3);
  border-radius: 4px;
  transition: all 0.2s;
  width: fit-content;
}

.news-card-watch:hover {
  background: rgba(192, 32, 35, 0.1);
  border-color: rgba(192, 32, 35, 0.5);
}

.news-card-ts {
  color: var(--text-secondary, rgba(255, 255, 255, 0.5));
  font-size: 10px;
}

.news-card-video-title {
  font-size: 10px;
  color: var(--text-secondary, rgba(255, 255, 255, 0.5));
  font-style: italic;
  opacity: 0.7;
}

/* Compact overrides for sidebar panel */
.news-feed-panel .news-card-meta { font-size: 10px; }
.news-feed-panel .news-card-post-text { font-size: 12px; }
.news-feed-panel .news-card-duration { font-size: 10px; padding: 1px 4px; }
.news-feed-panel .news-card-timestamp { font-size: 10px; padding: 1px 4px; }
.news-feed-panel .news-card-facts li { font-size: 10px; padding-left: 10px; }
.news-feed-panel .news-card-facts li::before { width: 3px; height: 3px; top: 5px; }
.news-feed-panel .news-card-expanded { margin-top: 8px; padding-top: 8px; }
.news-feed-panel .news-card-watch { padding: 5px 10px; }
.news-feed-panel .news-card-play { width: 24px; height: 24px; }

.news-feed-map-link {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  font-size: 11px;
  color: var(--primary-red);
  background: none;
  border: 1px solid rgba(192, 32, 35, 0.3);
  border-radius: 4px;
  padding: 3px 8px;
  cursor: pointer;
  transition: all 0.2s;
  width: fit-content;
  font-family: inherit;
}

.news-feed-map-link:hover {
  background: rgba(192, 32, 35, 0.1);
  border-color: rgba(192, 32, 35, 0.5);
  color: var(--primary-red-hover);
}

.news-feed-item:hover .news-card-post-text {
  color: #fff;
}

.news-feed-item:hover .news-card-thumb::before {
  opacity: 0.15;
}

.news-feed-item.has-site:hover {
  border-color: rgba(192, 32, 35, 0.3);
}

.news-feed-site-block {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.news-feed-site-badges {
  display: flex;
  align-items: center;
  gap: 4px;
  flex-wrap: wrap;
  padding-left: 2px;
}

.news-feed-site-row {
  display: flex;
  align-items: center;
  gap: 4px;
  flex-wrap: wrap;
}

.news-feed-site-badge {
  font-size: 8px;
  height: 14px;
  line-height: 12px;
  padding: 0 5px;
  border: 1px solid;
  border-radius: 3px;
  text-transform: uppercase;
  letter-spacing: 0.4px;
  font-weight: 500;
  white-space: nowrap;
  box-sizing: border-box;
}

.news-feed-site-flag {
  height: 14px;
  width: auto;
  border-radius: 1px;
}

.news-feed-site-unmatched {
  opacity: 0.7;
}

.news-feed-site-unmatched-name {
  font-size: 11px;
  font-style: italic;
  color: var(--text-secondary);
}


.news-feed-loading,
.news-feed-empty,
.news-feed-error {
  padding: 20px 16px;
  text-align: center;
  font-size: 12px;
  color: var(--text-secondary);
}

.news-feed-error {
  color: var(--primary-red);
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
}

.news-feed-error button {
  background: transparent;
  border: 1px solid rgba(192, 32, 35, 0.3);
  color: var(--primary-red);
  padding: 4px 12px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 11px;
}

.news-feed-load-more {
  display: block;
  width: 100%;
  padding: 10px;
  background: transparent;
  border: none;
  border-top: 1px solid rgba(0, 180, 180, 0.08);
  color: var(--primary-red);
  font-size: 12px;
  cursor: pointer;
  transition: background 0.2s;
}

.news-feed-load-more:hover {
  background: rgba(192, 32, 35, 0.08);
}

/* Minimized news feed */
.news-feed-minimized {
  position: absolute;
  top: 20px;
  right: 20px;
  z-index: 100;
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 12px;
  background: var(--bg-card);
  backdrop-filter: blur(var(--blur-amount));
  -webkit-backdrop-filter: blur(var(--blur-amount));
  border: 1px solid var(--border-color);
  border-radius: 8px;
  cursor: pointer;
  color: var(--text-primary);
  transition: background 0.2s;
}

.news-feed-minimized:hover {
  background: var(--bg-card-solid);
}

.news-feed-minimized svg {
  color: var(--primary-red);
  opacity: 0.8;
}

/* Lyra intro section in docked panel */
.news-feed-lyra {
  display: flex;
  align-items: stretch;
  gap: 10px;
  padding: 12px 16px;
  border-bottom: 1px solid var(--border-color);
  flex-shrink: 0;
}

.news-feed-lyra-avatar {
  width: 52px;
  height: 52px;
  border-radius: 50%;
  border: 2px solid rgba(192, 32, 35, 0.4);
  flex-shrink: 0;
  object-fit: cover;
}

.news-feed-lyra-bubble {
  position: relative;
  background: rgba(0, 180, 180, 0.08);
  border: 1px solid rgba(0, 180, 180, 0.15);
  border-radius: 8px;
  padding: 8px 10px;
  font-size: 11px;
  line-height: 1.45;
  color: rgba(255, 255, 255, 0.75);
}

.news-feed-lyra-bubble::before {
  content: '';
  position: absolute;
  left: -6px;
  top: 12px;
  width: 0;
  height: 0;
  border-top: 5px solid transparent;
  border-bottom: 5px solid transparent;
  border-right: 6px solid rgba(0, 180, 180, 0.15);
}

/* Open in new tab link */
.news-feed-open-tab {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  margin: 0 16px;
  padding: 7px 0;
  font-size: 11px;
  color: var(--text-secondary);
  text-decoration: none;
  border-bottom: 1px solid rgba(0, 180, 180, 0.08);
  transition: color 0.2s;
  flex-shrink: 0;
}

.news-feed-open-tab:hover {
  color: var(--primary-red);
}

/* =============================================================================
   News Page - dedicated full-page grid layout (/news.html)
   ============================================================================= */

.news-page {
  min-height: 100vh;
  height: 100vh;
  overflow-y: auto;
  background: var(--bg-main, #0a1520);
  color: var(--text-primary, #e8e8e8);
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
}

/* Header  single sticky line: brand + divider + Lyra + stats */
.news-page-header {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 20px;
  background: var(--bg-main, #0a1520);
  position: sticky;
  top: 0;
  z-index: 10;
}

.news-page-brand {
  display: flex;
  align-items: center;
  gap: 7px;
  text-decoration: none;
  flex-shrink: 0;
}

.news-page-logo {
  width: 22px;
  height: 22px;
}

.news-page-brand-text {
  font-family: 'Orbitron', sans-serif;
  font-size: 15px;
  font-weight: 700;
  letter-spacing: 2px;
  color: var(--primary-red, #c02023);
}

.news-page-divider {
  width: 1px;
  height: 24px;
  background: var(--border-color, rgba(0, 180, 180, 0.12));
  flex-shrink: 0;
}

.news-page-avatar {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  border: 2px solid rgba(192, 32, 35, 0.5);
  flex-shrink: 0;
  object-fit: cover;
}

.news-page-lyra-label {
  display: flex;
  flex-wrap: wrap;
  align-items: baseline;
  gap: 4px 8px;
  flex: 1;
  min-width: 0;
  container-type: inline-size;
}

@container (max-width: 460px) {
  .news-page-stats {
    font-size: 10px;
  }
}

.news-page-lyra-name {
  font-size: 15px;
  font-weight: 600;
  letter-spacing: 0.5px;
  color: var(--text-primary, #e8e8e8);
  font-family: 'Orbitron', sans-serif;
  white-space: nowrap;
}

.news-page-stats {
  display: flex;
  align-items: center;
  gap: 5px;
  font-size: 13px;
  color: rgba(255, 255, 255, 0.35);
  white-space: nowrap;
}
.news-page-stats-item strong {
  color: var(--primary-red, #c02023);
  font-weight: 700;
}
.news-page-stats-sep {
  color: rgba(255, 255, 255, 0.2);
}

.news-page-lyra-badge {
  font-size: 9px;
  font-weight: 600;
  letter-spacing: 0.5px;
  text-transform: uppercase;
  color: var(--primary-red, #c02023);
  background: rgba(192, 32, 35, 0.12);
  border: 1px solid rgba(192, 32, 35, 0.25);
  padding: 2px 8px;
  border-radius: 3px;
  white-space: nowrap;
  flex-shrink: 0;
}


/* Pull-to-refresh zone */
.news-page-pull-zone {
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  height: 0;
  transition: height 0.25s ease;
}

.news-page-pull-spinner {
  display: flex;
  align-items: center;
  gap: 8px;
  color: var(--text-secondary, rgba(255, 255, 255, 0.4));
  transition: color 0.2s;
}

.news-page-pull-spinner.ready {
  color: var(--primary-red, #c02023);
}

.news-page-pull-spinner.spinning {
  color: var(--primary-red, #c02023);
}

.news-page-pull-spinner.done {
  color: #00cc66;
}

.news-page-pull-spinner.done svg {
  animation: none;
}

.news-page-pull-spinner.spinning svg {
  animation: news-pull-spin 0.7s linear infinite;
}

@keyframes news-pull-spin {
  to { transform: rotate(360deg); }
}

.news-page-pull-text {
  font-family: 'Inter', sans-serif;
  font-size: 11px;
  font-weight: 500;
  letter-spacing: 0.3px;
  white-space: nowrap;
}

/* Online LED */
.news-page-live {
  display: flex;
  align-items: center;
  gap: 5px;
  flex-shrink: 0;
  margin-left: auto;
  padding: 3px 8px;
}

.news-page-live-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: #00cc66;
  box-shadow: 0 0 6px rgba(0, 204, 102, 0.6);
  animation: news-live-pulse 2s ease infinite;
}

.news-page-live.offline .news-page-live-dot {
  background: #666;
  box-shadow: none;
  animation: none;
}

.news-page-live-text {
  font-family: 'Orbitron', sans-serif;
  font-size: 9px;
  font-weight: 700;
  letter-spacing: 1.5px;
  color: #00cc66;
}

.news-page-live.offline .news-page-live-text {
  color: #666;
}

@keyframes news-live-pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.3; }
}

/* New item slide-in */
@keyframes news-card-enter {
  from {
    opacity: 0;
    transform: translateY(-16px) scale(0.97);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.news-page-card.new-item {
  animation: news-card-enter 0.5s ease-out;
}

/* Filter section  sticks right below header */
.news-page-filters {
  position: sticky;
  top: 46px;
  z-index: 8;
  background: var(--bg-main, #0a1520);
  border-top: 1px solid var(--border-color, rgba(0, 180, 180, 0.12));
  border-bottom: 1px solid var(--border-color, rgba(0, 180, 180, 0.12));
}

.news-page-filters-toggle {
  display: flex;
  align-items: center;
  gap: 6px;
  width: 100%;
  padding: 6px 20px;
  background: none;
  border: none;
  color: var(--text-secondary, rgba(255, 255, 255, 0.5));
  font-family: 'Inter', sans-serif;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  cursor: pointer;
}

.news-page-filters-toggle:hover {
  color: var(--text-primary, #e8e8e8);
}

.news-page-filters-toggle svg {
  transition: transform 0.2s;
}

.news-page-filters-toggle svg.rotated {
  transform: rotate(90deg);
}

.news-page-filters-count {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 1px 6px;
  border-radius: 3px;
  border: 1px solid rgba(192, 32, 35, 0.4);
  background: transparent;
  color: var(--primary-red, #c02023);
  font-size: 10px;
  font-weight: 600;
  line-height: 1;
}

.news-page-filters-body {
  display: flex;
  flex-direction: column;
  gap: 1px;
  padding-bottom: 6px;
}

.news-page-filter-row {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  padding: 3px 20px;
}

.news-page-filter-label {
  width: 60px;
  flex-shrink: 0;
  font-family: 'Inter', sans-serif;
  font-size: 10px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.3px;
  color: var(--text-secondary, rgba(255, 255, 255, 0.5));
  padding-top: 6px;
}

/* Chip container  standalone or inside filter rows */
.news-page-chips {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
}

.news-page-chips::-webkit-scrollbar {
  display: none;
}

.news-page-chip {
  flex-shrink: 0;
  padding: 4px 12px;
  border-radius: 14px;
  border: 1px solid var(--border-color, rgba(0, 180, 180, 0.12));
  background: transparent;
  color: var(--text-secondary, rgba(255, 255, 255, 0.5));
  font-size: 11px;
  font-family: 'Inter', sans-serif;
  cursor: pointer;
  transition: all 0.2s;
  white-space: nowrap;
}

.news-page-chip:hover {
  border-color: rgba(192, 32, 35, 0.4);
  color: var(--text-primary, #e8e8e8);
}

.news-page-chip.active {
  border-color: var(--primary-red, #c02023);
  background: rgba(192, 32, 35, 0.12);
  color: var(--primary-red, #c02023);
  font-weight: 600;
}

.news-page-chip-flag {
  width: 14px;
  height: 10px;
  object-fit: cover;
  border-radius: 1px;
  vertical-align: middle;
  margin-right: 4px;
}

/* Error / empty */
.news-page-error {
  text-align: center;
  padding: 32px 24px;
  color: var(--primary-red, #c02023);
  font-size: 14px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
}

.news-page-error button {
  background: transparent;
  border: 1px solid rgba(192, 32, 35, 0.3);
  color: var(--primary-red, #c02023);
  padding: 6px 16px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
}

.news-page-empty {
  text-align: center;
  padding: 48px 24px;
  color: var(--text-secondary, rgba(255, 255, 255, 0.5));
  font-size: 14px;
}

.news-page-loading {
  text-align: center;
  padding: 24px;
  color: var(--text-secondary, rgba(255, 255, 255, 0.5));
  font-size: 13px;
}

/* Grid */
.news-page-grid {
  display: flex;
  gap: 12px;
  padding: 12px 20px;
}

.news-page-column {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

/* Card */
.news-page-card {
  background: var(--bg-card, rgba(8, 18, 26, 0.7));
  border: 1px solid var(--border-color, rgba(0, 180, 180, 0.12));
  border-radius: 8px;
  overflow: hidden;
  cursor: pointer;
  transition: transform 0.25s ease, border-color 0.25s ease, box-shadow 0.25s ease;
  transform: translateZ(0);
}

.news-page-card:hover {
  border-color: rgba(0, 180, 180, 0.3);
  transform: translateY(-3px) scale(1.01);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(0, 180, 180, 0.1);
}

.news-page-card.expanded {
  border-color: rgba(192, 32, 35, 0.3);
}

/* Card body */
.news-page-card-body {
  padding: 12px 14px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

/* Hover effects on page cards */
.news-page-card:hover .news-card-post-text {
  color: #fff;
}

.news-page-card:hover .news-card-thumb::before {
  opacity: 0.15;
}

.news-page-card-site-name {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  font-size: 11px;
  color: rgba(255, 255, 255, 0.6);
}

/* Responsive: smaller screens */
@media (max-width: 640px) {
  .news-page-header {
    padding: 6px 10px;
    gap: 6px;
  }

  .news-page-logo {
    width: 18px;
    height: 18px;
  }

  .news-page-brand-text {
    font-size: 10px;
    letter-spacing: 1.5px;
  }

  .news-page-divider {
    height: 20px;
  }

  .news-page-avatar {
    width: 26px;
    height: 26px;
  }

  .news-page-lyra-name {
    font-size: 12px;
  }

  .news-page-stats {
    font-size: 8px;
  }

  .news-page-lyra-badge {
    display: none;
  }

  .news-page-live-text {
    display: none;
  }

  .news-page-filters {
    top: 38px;
  }

  .news-page-filters-toggle {
    padding: 5px 10px;
  }

  .news-page-filter-row {
    flex-direction: column;
    gap: 4px;
    padding: 4px 10px;
  }

  .news-page-filter-label {
    width: auto;
    padding-top: 0;
  }

  .news-page-grid {
    padding: 8px;
    gap: 8px;
  }
}

/* =============================================================================
   Lyra Profile - Gamified RPG Agent Dossier (draggable floating window)
   ============================================================================= */

.lyra-modal {
  display: flex;
  flex-direction: column;
  background: #0b1118;
  border: 3px solid #c02023;
  border-radius: 4px;
  box-shadow:
    0 0 0 1px #0b1118,
    0 0 0 4px rgba(192, 32, 35, 0.25),
    0 12px 40px rgba(0, 0, 0, 0.6);
  overflow: clip;
}

.lyra-modal-dragging {
  user-select: none;
}

.lyra-modal-dragging .lyra-poster-body {
  pointer-events: none;
}

/* Thin drag bar at top */
.lyra-poster-dragbar {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  padding: 4px 6px;
  background: rgba(192, 32, 35, 0.15);
  border-bottom: 2px solid rgba(192, 32, 35, 0.3);
  cursor: grab;
  flex-shrink: 0;
}

.lyra-poster-dragbar:active {
  cursor: grabbing;
}

/* Three-column body */
.lyra-modal .resize-handle.resize-n { top: 0; }
.lyra-modal .resize-handle.resize-s { bottom: 0; }
.lyra-modal .resize-handle.resize-e { right: 0; }
.lyra-modal .resize-handle.resize-w { left: 0; }
.lyra-modal .resize-handle.resize-ne { top: 0; right: 0; }
.lyra-modal .resize-handle.resize-nw { top: 0; left: 0; }
.lyra-modal .resize-handle.resize-se { bottom: 0; right: 0; }
.lyra-modal .resize-handle.resize-sw { bottom: 0; left: 0; }

.lyra-poster-body {
  flex: 1;
  min-height: 0;
  display: flex;
  gap: 0;
  overflow: hidden;
  border-radius: 0 0 4px 4px;
  background:
    radial-gradient(ellipse at 50% 20%, rgba(192, 32, 35, 0.04) 0%, transparent 50%),
    repeating-linear-gradient(
      0deg,
      transparent,
      transparent 28px,
      rgba(192, 32, 35, 0.03) 28px,
      rgba(192, 32, 35, 0.03) 29px
    );
}

/* LEFT column: portrait + stats + NFT */
.lyra-poster-left {
  width: 185px;
  flex-shrink: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 14px 12px 14px 16px;
  gap: 8px;
  border-right: 1px solid rgba(192, 32, 35, 0.15);
}

/* Banner */
.lyra-poster-banner {
  font-family: 'Orbitron', sans-serif;
  font-size: 13px;
  font-weight: 800;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: #c02023;
  text-align: center;
  padding: 4px 0;
  border-top: 2px double #c02023;
  border-bottom: 2px double #c02023;
  width: 100%;
  text-shadow: 0 0 20px rgba(192, 32, 35, 0.3);
}

/* Portrait */
.lyra-poster-portrait {
  position: relative;
  width: 120px;
  height: 120px;
  border: 3px solid rgba(192, 32, 35, 0.5);
  outline: 2px solid rgba(192, 32, 35, 0.15);
  outline-offset: 3px;
  overflow: visible;
  flex-shrink: 0;
}

.lyra-poster-portrait img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  filter: saturate(0.85) contrast(1.1);
}

.lyra-poster-led {
  position: absolute;
  bottom: 6px;
  right: 6px;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: #00e060;
  border: 1.5px solid rgba(0, 0, 0, 0.6);
  box-shadow:
    0 0 6px rgba(0, 224, 96, 0.7),
    0 0 14px rgba(0, 224, 96, 0.3),
    inset 0 0 3px rgba(255, 255, 255, 0.3);
  animation: lyra-led-glow 2.5s ease-in-out infinite;
}

.lyra-poster-led.offline {
  background: #c83c3c;
  box-shadow:
    0 0 6px rgba(200, 60, 60, 0.5),
    0 0 14px rgba(200, 60, 60, 0.2);
  animation: none;
}

/* Name - two lines, same visual width */
.lyra-poster-name {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 100%;
}

.lyra-poster-name-first,
.lyra-poster-name-last {
  font-family: 'Orbitron', sans-serif;
  font-weight: 700;
  color: #e8e8e8;
  text-align: center;
  display: block;
}

.lyra-poster-name-first {
  font-size: 28px;
  letter-spacing: 12px;
  text-indent: 12px;
}

.lyra-poster-name-last {
  font-size: 11.8px;
  letter-spacing: 3.4px;
  text-indent: 3.4px;
}

/* Tag (under name) */
.lyra-poster-tag {
  font-size: 8px;
  font-weight: 600;
  padding: 4px 0;
  border-radius: 2px;
  letter-spacing: 0.5px;
  text-transform: uppercase;
  white-space: nowrap;
  background: rgba(192, 32, 35, 0.15);
  color: #c02023;
  border: 1px solid rgba(192, 32, 35, 0.3);
  width: 120px;
  text-align: center;
  box-sizing: border-box;
}

/* NFT link */
.lyra-poster-nft {
  font-size: 12px;
  font-weight: 600;
  color: #e8a020;
  text-decoration: none;
  padding: 5px 0;
  border: 1px solid rgba(232, 160, 32, 0.3);
  border-radius: 2px;
  transition: color 0.15s, background-color 0.15s, border-color 0.15s;
  letter-spacing: 0.5px;
  width: 120px;
  text-align: center;
  box-sizing: border-box;
}

.lyra-poster-nft:hover {
  background: rgba(232, 160, 32, 0.1);
  border-color: rgba(232, 160, 32, 0.5);
  color: #f0b830;
}

/* Status section */
.lyra-poster-status {
  width: 120px;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.lyra-poster-status-online {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  font-family: 'Orbitron', sans-serif;
  font-size: 10px;
  font-weight: 700;
  color: rgba(0, 200, 80, 0.8);
  letter-spacing: 2px;
}

.lyra-poster-status-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: rgba(0, 200, 80, 0.8);
  box-shadow: 0 0 6px rgba(0, 200, 80, 0.5);
  animation: lyra-pulse 2s ease-in-out infinite;
}

@keyframes lyra-pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.4; }
}

@keyframes lyra-led-glow {
  0%, 100% {
    box-shadow:
      0 0 6px rgba(0, 224, 96, 0.7),
      0 0 14px rgba(0, 224, 96, 0.3),
      inset 0 0 3px rgba(255, 255, 255, 0.3);
  }
  50% {
    box-shadow:
      0 0 3px rgba(0, 224, 96, 0.4),
      0 0 8px rgba(0, 224, 96, 0.15),
      inset 0 0 2px rgba(255, 255, 255, 0.15);
  }
}

.lyra-poster-status-offline {
  color: rgba(200, 60, 60, 0.8);
}
.lyra-poster-status-offline .lyra-poster-status-dot {
  background: rgba(200, 60, 60, 0.8);
  box-shadow: 0 0 6px rgba(200, 60, 60, 0.5);
  animation: none;
}

.lyra-poster-status-stats {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.lyra-poster-status-row {
  display: flex;
  align-items: baseline;
  gap: 4px;
}

.lyra-poster-status-val {
  font-family: 'Orbitron', sans-serif;
  font-size: 12px;
  font-weight: 700;
  color: rgba(255, 255, 255, 0.8);
}

.lyra-poster-status-label {
  font-size: 9px;
  color: rgba(255, 255, 255, 0.35);
}

/* CENTER column: lore + abilities + discord */
.lyra-poster-center {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: 10px;
  padding: 14px 12px;
  overflow: hidden;
}

/* Sections */
.lyra-poster-section {
  display: flex;
  flex-direction: column;
  gap: 5px;
}

.lyra-poster-section p {
  margin: 0;
  font-size: 13px;
  line-height: 1.5;
  color: rgba(255, 255, 255, 0.6);
}

.lyra-poster-section-title {
  font-family: 'Orbitron', sans-serif;
  font-size: 11px;
  font-weight: 700;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  color: rgba(192, 32, 35, 0.7);
  padding-bottom: 4px;
  border-bottom: 1px solid rgba(192, 32, 35, 0.2);
}

/* Abilities */
.lyra-poster-abilities {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.lyra-poster-ability {
  display: flex;
  flex-direction: column;
  gap: 1px;
  padding: 4px 6px;
  background: rgba(0, 180, 180, 0.04);
  border-left: 2px solid rgba(0, 180, 180, 0.3);
  border-radius: 0 2px 2px 0;
}

.lyra-poster-ability-name {
  font-size: 13px;
  font-weight: 600;
  color: #00b4b4;
}

.lyra-poster-ability-desc {
  font-size: 11px;
  color: rgba(255, 255, 255, 0.45);
  line-height: 1.35;
}

/* Discord link */
.lyra-poster-discord {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 5px 14px;
  font-size: 13px;
  font-weight: 600;
  color: #7289da;
  text-decoration: none;
  border: 2px solid rgba(114, 137, 218, 0.3);
  border-radius: 3px;
  transition: color 0.15s, background-color 0.15s, border-color 0.15s;
  width: fit-content;
}

.lyra-poster-discord:hover {
  background: rgba(114, 137, 218, 0.1);
  border-color: rgba(114, 137, 218, 0.5);
  color: #8ea1e1;
}

/* RIGHT column: channels + stamp */
.lyra-poster-right {
  width: 185px;
  flex-shrink: 0;
  display: flex;
  flex-direction: column;
  padding: 14px 16px 14px 12px;
  gap: 6px;
  border-left: 1px solid rgba(192, 32, 35, 0.15);
}

/* Channel list (only scrollable area) */
.lyra-poster-channel-list {
  flex: 1;
  min-height: 0;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  gap: 1px;
}

/* Thin custom scrollbar for channel list */
.lyra-poster-channel-list::-webkit-scrollbar {
  width: 4px;
}

.lyra-poster-channel-list::-webkit-scrollbar-track {
  background: transparent;
}

.lyra-poster-channel-list::-webkit-scrollbar-thumb {
  background: rgba(192, 32, 35, 0.25);
  border-radius: 2px;
}

.lyra-poster-channel-list::-webkit-scrollbar-thumb:hover {
  background: rgba(192, 32, 35, 0.4);
}

.lyra-poster-channel {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 2px 4px;
  text-decoration: none;
  color: rgba(255, 255, 255, 0.5);
  font-size: 10px;
  border-radius: 2px;
  transition: color 0.15s, background 0.15s;
  flex-shrink: 0;
}

.lyra-poster-channel:hover {
  color: #e8e8e8;
  background: rgba(192, 32, 35, 0.08);
}

.lyra-poster-yt-icon {
  flex-shrink: 0;
  color: rgba(255, 0, 0, 0.4);
}

.lyra-poster-channel:hover .lyra-poster-yt-icon {
  color: rgba(255, 0, 0, 0.8);
}


/* Lyra modal responsive  full-screen single-column on narrow devices */
@media (max-width: 700px) {
  .lyra-modal {
    /* Override inline fixed pos/size */
    left: 0 !important;
    top: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    border-radius: 0;
    border-width: 0;
    box-shadow: none;
  }

  .lyra-poster-dragbar {
    padding: 6px 10px;
  }

  .lyra-poster-body {
    flex-direction: column;
    overflow-y: auto;
    overflow-x: hidden;
  }

  .lyra-poster-left {
    width: 100%;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: center;
    padding: 12px 16px;
    border-right: none;
    border-bottom: 1px solid rgba(192, 32, 35, 0.15);
    gap: 10px;
  }

  .lyra-poster-banner {
    width: 100%;
    font-size: 11px;
    letter-spacing: 2px;
    padding: 3px 0;
  }

  .lyra-poster-portrait {
    width: 80px;
    height: 80px;
  }

  .lyra-poster-name {
    width: auto;
    align-items: flex-start;
  }

  .lyra-poster-name-first {
    font-size: 22px;
    letter-spacing: 8px;
    text-indent: 8px;
  }

  .lyra-poster-name-last {
    font-size: 10px;
    letter-spacing: 2.5px;
    text-indent: 2.5px;
  }

  .lyra-poster-tag {
    width: auto;
    padding: 3px 10px;
  }

  .lyra-poster-nft {
    width: auto;
    padding: 4px 10px;
    font-size: 11px;
  }

  .lyra-poster-status {
    width: auto;
    flex-direction: row;
    align-items: center;
    gap: 10px;
  }

  .lyra-poster-status-stats {
    flex-direction: row;
    gap: 10px;
  }

  .lyra-poster-center {
    padding: 12px 16px;
    gap: 8px;
  }

  .lyra-poster-section p {
    font-size: 12px;
    line-height: 1.45;
  }

  .lyra-poster-ability-name {
    font-size: 12px;
  }

  .lyra-poster-ability-desc {
    font-size: 10px;
  }

  .lyra-poster-right {
    width: 100%;
    padding: 12px 16px;
    border-left: none;
    border-top: 1px solid rgba(192, 32, 35, 0.15);
  }

  .lyra-poster-channel-list {
    flex-direction: row;
    flex-wrap: wrap;
    gap: 4px;
    overflow: visible;
  }

  .lyra-poster-channel {
    font-size: 10px;
    padding: 3px 6px;
    background: rgba(192, 32, 35, 0.06);
    border-radius: 3px;
  }

  /* Hide resize handles on touch */
  .lyra-modal .resize-handle {
    display: none;
  }
}

/* Clickable avatar style (used in panel + page) */
.lyra-avatar-clickable {
  cursor: pointer;
  transition: transform 0.15s, box-shadow 0.15s;
}

.lyra-avatar-clickable:hover {
  transform: scale(1.1);
  box-shadow: 0 0 0 3px rgba(192, 32, 35, 0.4);
}

/* Highlight row for "sites discovered" stat */
.lyra-poster-status-highlight {
  margin-top: 4px;
  padding-top: 4px;
  border-top: 1px solid rgba(192, 32, 35, 0.2);
}

.lyra-poster-status-highlight .lyra-poster-status-val {
  color: #c02023;
}

/* Discoveries button in dossier */
.lyra-poster-discoveries-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  margin-top: 6px;
  padding: 6px 0;
  font-size: 11px;
  font-weight: 600;
  color: rgba(255, 255, 255, 0.7);
  text-decoration: none;
  background: rgba(192, 32, 35, 0.15);
  border: 1px solid rgba(192, 32, 35, 0.3);
  border-radius: 2px;
  transition: all 0.15s;
  width: 120px;
  text-align: center;
}

.lyra-poster-discoveries-btn:hover {
  background: rgba(192, 32, 35, 0.25);
  border-color: rgba(192, 32, 35, 0.5);
  color: rgba(255, 255, 255, 0.9);
}

/* =============================================================================
   Lyra Discoveries Page
   ============================================================================= */

.lyra-discoveries-page {
  min-height: 100vh;
  height: 100vh;
  overflow-y: auto;
  background: linear-gradient(180deg, #0a1a1f 0%, #0d1f25 100%);
  color: rgba(255, 255, 255, 0.85);
  font-family: 'Inter', system-ui, sans-serif;
  padding-bottom: 40px;
}

.lyra-discoveries-filters {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 20px;
  background: rgba(0, 0, 0, 0.2);
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.lyra-discoveries-filter-label {
  font-size: 12px;
  color: rgba(255, 255, 255, 0.5);
  white-space: nowrap;
}

.lyra-discoveries-filter-chips {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
}

.lyra-discoveries-grid {
  display: flex;
  gap: 16px;
  padding: 20px;
  max-width: 1600px;
  margin: 0 auto;
}

.lyra-discoveries-column {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.lyra-discovery-card {
  background: rgba(255, 255, 255, 0.03);
  border: 1px solid rgba(255, 255, 255, 0.06);
  border-radius: 8px;
  padding: 16px;
  transition: border-color 0.15s, background-color 0.15s;
}

.lyra-discovery-card:hover {
  background: rgba(255, 255, 255, 0.05);
  border-color: rgba(192, 32, 35, 0.3);
}

.lyra-discovery-header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 8px;
  margin-bottom: 10px;
}

.lyra-discovery-header-badges {
  display: flex;
  align-items: center;
  gap: 6px;
  flex-shrink: 0;
}

.lyra-discovery-name-block {
  min-width: 0;
}

.lyra-discovery-name {
  margin: 0;
  font-size: 16px;
  font-weight: 600;
  color: rgba(255, 255, 255, 0.9);
  line-height: 1.3;
  font-family: 'Orbitron', sans-serif;
}

.lyra-discovery-extracted-name {
  display: block;
  font-size: 11px;
  color: rgba(255, 255, 255, 0.3);
  font-style: italic;
  margin-top: 2px;
}

/* .lyra-discovery-score removed  replaced by .lyra-discovery-percentage */

.lyra-discovery-mentions {
  padding: 2px 8px;
  font-size: 11px;
  font-weight: 700;
  color: #c02023;
  background: rgba(192, 32, 35, 0.15);
  border: 1px solid rgba(192, 32, 35, 0.3);
  border-radius: 4px;
  font-family: 'Orbitron', sans-serif;
}

/* Facts list with left border accent */
.lyra-discovery-facts {
  margin: 0 0 12px;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.lyra-discovery-fact {
  font-size: 13px;
  line-height: 1.5;
  color: rgba(255, 255, 255, 0.7);
  padding-left: 10px;
  border-left: 2px solid rgba(192, 32, 35, 0.4);
}

.lyra-discovery-expand {
  background: transparent;
  border: none;
  color: rgba(0, 240, 255, 0.7);
  font-size: 12px;
  cursor: pointer;
  padding: 4px 0;
  text-align: left;
  transition: color 0.15s;
}

.lyra-discovery-expand:hover {
  color: rgba(0, 240, 255, 1);
}

.lyra-discovery-description {
  margin: 0 0 10px;
  font-size: 13px;
  line-height: 1.5;
  color: rgba(255, 255, 255, 0.6);
}

.lyra-discovery-meta {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
  margin-bottom: 10px;
}

.lyra-discovery-country {
  display: flex;
  align-items: center;
  gap: 5px;
  font-size: 12px;
  color: rgba(255, 255, 255, 0.5);
}

.lyra-discovery-flag {
  width: 16px;
  height: 12px;
  object-fit: cover;
  border-radius: 2px;
}

.lyra-discovery-badge {
  padding: 2px 8px;
  font-size: 10px;
  font-weight: 500;
  border: 1px solid;
  border-radius: 3px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Video chips container */
.lyra-discovery-videos {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-bottom: 10px;
}

.lyra-discovery-video-chip {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  padding: 4px 10px;
  font-size: 11px;
  font-weight: 500;
  color: #ff4444;
  background: rgba(255, 68, 68, 0.1);
  border: 1px solid rgba(255, 68, 68, 0.2);
  border-radius: 4px;
  text-decoration: none;
  transition: all 0.15s;
}

.lyra-discovery-video-chip:hover {
  background: rgba(255, 68, 68, 0.2);
  border-color: rgba(255, 68, 68, 0.4);
}

.lyra-video-channel {
  max-width: 100px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.lyra-video-timestamp {
  color: rgba(255, 255, 255, 0.5);
  font-size: 10px;
}

/* Suggestions chips */
.lyra-discovery-suggestions {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 6px;
  margin-bottom: 10px;
}

.lyra-suggestions-label {
  font-size: 11px;
  color: rgba(255, 255, 255, 0.4);
}

.lyra-suggestion-chip {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 3px 8px;
  font-size: 11px;
  color: rgba(0, 240, 255, 0.85);
  background: rgba(0, 240, 255, 0.08);
  border: 1px solid rgba(0, 240, 255, 0.2);
  border-radius: 3px;
  text-decoration: none;
  transition: all 0.15s;
}

.lyra-suggestion-chip:hover {
  background: rgba(0, 240, 255, 0.15);
  border-color: rgba(0, 240, 255, 0.4);
}

.lyra-suggestion-flag {
  width: 12px;
  height: 9px;
  border-radius: 1px;
}

/* Hero styles removed  replaced by .lyra-discovery-image full-width thumbnail */

/* Stats row removed  video/channel counts now in collapsible header */

/* Filter groups */
.lyra-filter-group {
  display: flex;
  align-items: center;
  gap: 8px;
}

/* Status pills */
.lyra-status-pill {
  padding: 2px 8px;
  font-size: 10px;
  font-weight: 600;
  border-radius: 10px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  white-space: nowrap;
}

.lyra-status-matched {
  color: #22c55e;
  background: rgba(34, 197, 94, 0.15);
  border: 1px solid rgba(34, 197, 94, 0.3);
}

.lyra-status-enriched {
  color: #8b5cf6;
  background: rgba(139, 92, 246, 0.15);
  border: 1px solid rgba(139, 92, 246, 0.3);
}

.lyra-status-pending {
  color: #6b7280;
  background: rgba(107, 114, 128, 0.15);
  border: 1px solid rgba(107, 114, 128, 0.3);
}

.lyra-status-rejected {
  color: #ef4444;
  background: rgba(239, 68, 68, 0.15);
  border: 1px solid rgba(239, 68, 68, 0.3);
}

.lyra-status-added {
  color: #22c55e;
  background: rgba(34, 197, 94, 0.15);
  border: 1px solid rgba(34, 197, 94, 0.3);
}

/* Country row */
.lyra-discovery-country-row {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 13px;
  color: rgba(255, 255, 255, 0.7);
  margin-bottom: 6px;
}

/* Coordinates */
.lyra-discovery-coords {
  font-size: 12px;
  color: rgba(255, 255, 255, 0.35);
  font-family: 'Orbitron', sans-serif;
  letter-spacing: 0.3px;
  margin-bottom: 10px;
}

/* Description with clamp */
.lyra-discovery-description-section {
  margin-bottom: 10px;
}

.lyra-description-clamped {
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* Full-width thumbnail image */
.lyra-discovery-image-wrap {
  margin: 0 -16px 12px;
  overflow: hidden;
}

.lyra-discovery-image {
  width: 100%;
  height: auto;
  max-height: 200px;
  object-fit: cover;
  display: block;
}

/* Score section */
.lyra-score-section {
  margin-bottom: 12px;
  padding-top: 10px;
  border-top: 1px solid rgba(255, 255, 255, 0.05);
}

.lyra-score-header {
  display: flex;
  align-items: baseline;
  gap: 8px;
  margin-bottom: 8px;
}

.lyra-discovery-percentage {
  font-family: 'Orbitron', sans-serif;
  font-size: 20px;
  font-weight: 700;
}

.lyra-score-sublabel {
  font-size: 11px;
  color: rgba(255, 255, 255, 0.35);
}

.lyra-score-breakdown {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
}

.lyra-score-bar {
  display: inline-flex;
  align-items: center;
  gap: 3px;
  padding: 2px 7px;
  border-radius: 3px;
  font-size: 10px;
  background: rgba(107, 114, 128, 0.15);
  border: 1px solid rgba(107, 114, 128, 0.2);
  color: rgba(255, 255, 255, 0.35);
}

.lyra-score-bar-filled {
  background: rgba(34, 197, 94, 0.12);
  border-color: rgba(34, 197, 94, 0.25);
  color: rgba(34, 197, 94, 0.85);
}

.lyra-score-label {
  font-weight: 500;
}

.lyra-score-points {
  font-family: 'Orbitron', sans-serif;
  font-size: 9px;
  opacity: 0.7;
}

/* Collapsible sections */
.lyra-collapsible {
  margin-bottom: 6px;
}

.lyra-collapsible-header {
  display: flex;
  align-items: center;
  gap: 6px;
  width: 100%;
  padding: 6px 0;
  background: transparent;
  border: none;
  color: rgba(255, 255, 255, 0.5);
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  text-align: left;
  transition: color 0.15s;
}

.lyra-collapsible-header:hover {
  color: rgba(255, 255, 255, 0.8);
}

.lyra-collapsible-arrow {
  font-size: 10px;
  width: 12px;
  text-align: center;
  flex-shrink: 0;
}

/* Wikipedia link */
.lyra-wiki-link {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  font-size: 11px;
  color: rgba(255, 255, 255, 0.5);
  text-decoration: none;
  margin-bottom: 10px;
  transition: color 0.15s;
}

.lyra-wiki-link:hover {
  color: rgba(255, 255, 255, 0.8);
  text-decoration: underline;
}

/* Hero source label removed */

.lyra-discovery-youtube {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  font-size: 12px;
  font-weight: 500;
  color: #ff4444;
  background: rgba(255, 68, 68, 0.1);
  border: 1px solid rgba(255, 68, 68, 0.2);
  border-radius: 4px;
  text-decoration: none;
  transition: all 0.15s;
}

.lyra-discovery-youtube:hover {
  background: rgba(255, 68, 68, 0.2);
  border-color: rgba(255, 68, 68, 0.4);
}

/* Mobile responsive */
@media (max-width: 600px) {
  .lyra-discoveries-filters {
    flex-direction: column;
    align-items: flex-start;
    gap: 8px;
    padding: 10px 16px;
  }

  .lyra-discoveries-grid {
    padding: 12px;
    gap: 12px;
  }

  .lyra-discovery-card {
    padding: 12px;
  }

  .lyra-discovery-name {
    font-size: 14px;
  }

  .lyra-poster-discoveries-btn {
    width: auto;
    padding: 4px 10px;
    font-size: 10px;
  }

  .lyra-discovery-image-wrap {
    margin: 0 -12px 10px;
  }

  .lyra-video-channel {
    max-width: 70px;
  }

  .lyra-filter-group {
    flex-wrap: wrap;
  }
}

/* Scroll to top button */
.lyra-scroll-top {
  position: fixed;
  bottom: 24px;
  right: 24px;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  border: 1px solid rgba(0, 240, 255, 0.3);
  background: rgba(10, 26, 31, 0.85);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  color: rgba(0, 240, 255, 0.8);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 100;
  transition: all 0.2s;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
}

.lyra-scroll-top:hover {
  border-color: rgba(0, 240, 255, 0.6);
  color: rgba(0, 240, 255, 1);
  box-shadow: 0 4px 16px rgba(0, 240, 255, 0.15);
}
